# 社区团购管理系统 - 管理员端使用说明

## 📦 项目结构

```
community-group-buy-admin/
├── src/
│   ├── api/                    # API接口封装
│   │   ├── user.js            # 用户API (7个接口)
│   │   └── feedback.js        # 反馈API (4个接口)
│   ├── utils/
│   │   └── request.js         # Axios配置（拦截器、Token携带）
│   ├── stores/
│   │   └── user.js            # 用户状态管理（Pinia）
│   ├── views/                  # 页面组件
│   │   ├── LoginView.vue      # 登录页
│   │   ├── LayoutView.vue     # 主布局（顶部导航+侧边栏）
│   │   ├── UserManageView.vue # 用户管理页
│   │   └── FeedbackManageView.vue # 反馈管理页
│   ├── router/
│   │   └── index.js           # 路由配置（含路由守卫）
│   ├── App.vue
│   └── main.js
├── package.json
└── vite.config.js
```

---

## 🚀 快速开始

### 1. 安装依赖（已完成）

```bash
cd community-group-buy-admin
npm install element-plus @element-plus/icons-vue axios
```

### 2. 启动开发服务器

```bash
npm run dev
```

服务器将在 `http://localhost:5173` 启动

---

## 🔧 前置要求

### 1. 后端服务必须启动

确保UserService后端服务正在运行：
- **端口**: 8061
- **Base URL**: http://localhost:8061

启动后端：
```bash
cd E:\E\BYSJ\community-group-buy-backend\UserService
mvn spring-boot:run
```

### 2. 数据库中需要有管理员账号

需要在数据库 `sys_user` 表中有一个 `role=3` 的管理员账号。

**方式1：通过注册接口创建**
```bash
POST http://localhost:8061/api/user/register
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123",
  "phone": "13800000000",
  "role": 3,
  "realName": "系统管理员"
}
```

**方式2：手动在数据库中创建**
```sql
INSERT INTO sys_user (username, password, phone, role, status, create_time, update_time)
VALUES ('admin', 'SHA256加密后的密码', '13800000000', 3, 1, NOW(), NOW());
```

注意：密码需要使用SHA256加密。
- `admin123` 的SHA256值是：`240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9`

---

## 📱 功能说明

### 1. 登录页面 (`/login`)

**功能**：
- 管理员身份验证
- 自动验证用户角色（必须是role=3）
- 记住登录状态（Token存储在localStorage）

**测试账号**：
- 用户名: `admin`
- 密码: `admin123`

**API调用**：
- `POST /api/user/login`

---

### 2. 用户管理页 (`/users`) 🆕

**功能**：
- ✅ 查看所有用户列表
- ✅ 搜索用户（用户名/手机号）
- ✅ 按角色筛选（全部/普通用户/团长/管理员）
- ✅ 按状态筛选（全部/正常/禁用）
- ✅ **创建新用户** 🆕 (v1.1.0)
- ✅ **编辑用户信息** 🆕 (v1.1.0)
- ✅ **修改用户角色** 🆕 (v1.1.0)
- ✅ 启用/禁用用户
- ✅ 查看用户详情

**API调用**：
- `GET /api/user/search?keyword=xxx` - 搜索用户
- `GET /api/user/role/{role}` - 按角色查询
- `POST /api/user/admin/create` - 管理员创建用户 🆕
- `PUT /api/user/update/{userId}` - 更新用户信息 🆕
- `PUT /api/user/role/{userId}` - 更改用户角色 🆕
- `PUT /api/user/status` - 更改用户状态
- `GET /api/user/info/{userId}` - 获取用户详情

**操作说明**：
1. **搜索用户**：在搜索框输入用户名或手机号，点击搜索或按回车
2. **角色筛选**：选择角色下拉框，自动筛选
3. **状态筛选**：选择状态下拉框，自动筛选
4. **创建用户** 🆕：点击"创建用户"按钮，填写表单（用户名、密码、手机号、角色），点击"确定创建"
5. **编辑用户** 🆕：点击"编辑"按钮，修改信息（密码可选、手机号、姓名、角色），点击"保存修改"
6. **查看详情**：点击"详情"按钮，弹窗显示完整信息
7. **启用/禁用**：点击对应按钮，二次确认后执行

---

### 3. 反馈管理页 (`/feedback`)

**功能**：
- ✅ 查看所有用户反馈
- ✅ 按状态筛选（全部/待处理/已回复/已关闭）
- ✅ 分页显示
- ✅ 查看反馈详情
- ✅ 回复用户反馈

**API调用**：
- `GET /api/feedback/admin/all?page=1&size=10` - 获取所有反馈
- `GET /api/feedback/admin/status/{status}?page=1&size=10` - 按状态查询
- `GET /api/feedback/detail/{feedbackId}` - 获取详情
- `PUT /api/feedback/reply` - 回复反馈

**操作说明**：
1. **状态筛选**：选择状态下拉框，自动筛选
2. **调整分页**：修改"每页显示数量"，自动刷新
3. **查看详情**：点击"详情"按钮，弹窗显示完整信息
4. **回复反馈**：点击"回复"按钮（仅待处理状态），输入回复内容后提交

---

## 🎨 技术特点

### 1. 自动Token管理

- ✅ 登录后自动保存Token到localStorage
- ✅ 每次请求自动在Header中携带Token
- ✅ Token失效（401）自动跳转登录页

### 2. 统一错误处理

- ✅ 401 - 自动清除登录信息并跳转登录页
- ✅ 403 - 提示无权限
- ✅ 404 - 提示资源不存在
- ✅ 500 - 提示服务器错误
- ✅ 业务错误 - 显示后端返回的错误信息

### 3. 路由守卫

- ✅ 未登录访问受保护页面 → 跳转登录页
- ✅ 已登录访问登录页 → 跳转用户管理页

### 4. 用户体验

- ✅ Loading状态提示
- ✅ 操作成功/失败提示
- ✅ 危险操作二次确认
- ✅ 表格数据实时刷新

---

## 🧪 测试流程

### 1. 登录测试

```
1. 访问 http://localhost:5173
2. 自动跳转到 /login
3. 输入：admin / admin123
4. 点击登录
5. 验证：成功跳转到 /users 页面
```

### 2. 用户管理测试

```
1. 查看用户列表（应显示所有用户）
2. 搜索功能：输入用户名，点击搜索
3. 角色筛选：选择"普通用户"，验证只显示普通用户
4. 状态筛选：选择"正常"，验证只显示正常用户
5. 点击"详情"按钮，验证弹窗显示完整信息
6. 点击"禁用"按钮，验证确认对话框
7. 确认后，验证用户状态变为"禁用"
8. 刷新页面，验证状态保持
```

### 3. 反馈管理测试

```
1. 查看反馈列表（如果没有数据，需要先用普通用户提交反馈）
2. 状态筛选：选择"待处理"，验证筛选正确
3. 点击"详情"按钮，验证详情显示
4. 点击"回复"按钮（待处理状态）
5. 输入回复内容，点击提交
6. 验证：反馈状态变为"已回复"
7. 测试分页：修改每页显示数量
```

### 4. 退出登录测试

```
1. 点击右上角"退出登录"按钮
2. 验证：确认对话框
3. 确认后，验证：跳转到登录页
4. 验证：Token已清除（尝试直接访问 /users 会跳转到登录页）
```

---

## 🔍 API接口对照表

### 用户相关接口

| 功能 | 方法 | 接口 | 页面位置 |
|------|------|------|---------|
| 登录 | POST | `/api/user/login` | 登录页 |
| 搜索用户 | GET | `/api/user/search?keyword=xxx` | 用户管理 |
| 按角色查询 | GET | `/api/user/role/{role}` | 用户管理 |
| 获取用户详情 | GET | `/api/user/info/{userId}` | 用户详情弹窗 |
| 更改用户状态 | PUT | `/api/user/status` | 用户管理 |

### 反馈相关接口

| 功能 | 方法 | 接口 | 页面位置 |
|------|------|------|---------|
| 获取所有反馈 | GET | `/api/feedback/admin/all?page=1&size=10` | 反馈管理 |
| 按状态查询 | GET | `/api/feedback/admin/status/{status}?page=1&size=10` | 反馈管理 |
| 获取反馈详情 | GET | `/api/feedback/detail/{feedbackId}` | 反馈详情弹窗 |
| 回复反馈 | PUT | `/api/feedback/reply` | 回复对话框 |

---

## 📝 数据字典

### 用户角色 (role)

| 值 | 说明 | 标签颜色 |
|----|------|---------|
| 1 | 普通用户 | 蓝色(info) |
| 2 | 团长 | 橙色(warning) |
| 3 | 管理员 | 红色(danger) |

### 用户状态 (status)

| 值 | 说明 | 标签颜色 |
|----|------|---------|
| 0 | 禁用 | 红色(danger) |
| 1 | 正常 | 绿色(success) |

### 反馈类型 (feedbackType)

| 值 | 说明 | 标签颜色 |
|----|------|---------|
| 1 | 商品质量 | 橙色(warning) |
| 2 | 配送问题 | 红色(danger) |
| 3 | 服务态度 | 蓝色(info) |
| 4 | 系统Bug | 红色(danger) |
| 5 | 功能建议 | 绿色(success) |
| 6 | 其他 | 灰色(info) |

### 反馈状态 (status)

| 值 | 说明 | 标签颜色 |
|----|------|---------|
| 1 | 待处理 | 橙色(warning) |
| 2 | 已回复 | 绿色(success) |
| 3 | 已关闭 | 灰色(info) |

---

## ⚠️ 常见问题

### 1. 登录后提示"只有管理员才能登录此系统"

**原因**：使用的账号role不是3（管理员）

**解决**：
- 方式1：在数据库中将该用户的role改为3
- 方式2：使用真正的管理员账号登录

### 2. 登录成功但列表为空

**原因**：数据库中没有数据

**解决**：
- 用户管理页为空：需要先注册一些用户
- 反馈管理页为空：需要先让普通用户提交反馈

### 3. 提示"网络连接失败"

**原因**：后端服务未启动或端口不对

**解决**：
1. 检查UserService是否启动（端口8061）
2. 检查浏览器控制台的Network错误
3. 确认request.js中的baseURL是否正确

### 4. 401错误自动跳转登录页

**原因**：Token过期或无效

**解决**：
- 这是正常行为，重新登录即可
- Token有效期在后端JwtUtil中配置（默认7天）

---

## 🎯 下一步计划

### 短期优化
- [ ] 添加用户统计信息（总数、各角色数量）
- [ ] 添加反馈统计信息（各状态数量）
- [ ] 优化表格样式和布局
- [ ] 添加导出功能（用户列表、反馈列表）

### 中期功能
- [ ] 用户详情编辑功能
- [ ] 批量操作（批量启用/禁用）
- [ ] 高级搜索（多条件组合）
- [ ] 操作日志记录

### 长期规划
- [ ] 集成其他模块（商品、订单、配送等）
- [ ] 数据可视化（Dashboard）
- [ ] 权限细化（不同管理员不同权限）
- [ ] 系统设置页面

---

## 📚 相关文档

- **API文档**: `docs/社区团购系统/API_UserService.md`
- **数据库设计**: `docs/社区团购系统/数据库设计说明文档.md`
- **UserService开发报告**: `docs/社区团购系统/UserService开发完成报告.md`
- **前端功能规划**: `docs/社区团购系统/前端功能规划_用户模块.md`

---

**文档创建时间**: 2025-10-12  
**作者**: AI Assistant  
**版本**: v1.0.0

