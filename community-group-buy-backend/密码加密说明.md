# å¯†ç åŠ å¯†è¯´æ˜

## ğŸ“‹ é—®é¢˜è¯´æ˜

åœ¨ç¤¾åŒºå›¢è´­ç³»ç»Ÿä¸­ï¼Œå¯†ç åœ¨æ•°æ®åº“ä¸­æ˜¯**SHA256åŠ å¯†å­˜å‚¨**çš„ï¼Œä¸èƒ½ç›´æ¥å­˜å‚¨æ˜æ–‡å¯†ç ã€‚

---

## ğŸ” å¯†ç åŠ å¯†é€»è¾‘

### ä»£ç é€»è¾‘ï¼ˆUserService.javaï¼‰

```java
// æ³¨å†Œæ—¶
user.setPassword(SecurityUtil.sha256(request.getPassword()));

// ç™»å½•æ—¶
String encryptedPassword = SecurityUtil.sha256(request.getPassword());
if (!encryptedPassword.equals(user.getPassword())) {
    throw new BusinessException("å¯†ç é”™è¯¯");
}
```

### åŠ å¯†æ–¹æ³•ï¼ˆSecurityUtil.javaï¼‰

```java
public static String sha256(String text) {
    return SecureUtil.sha256(text);  // Hutoolçš„SHA256åŠ å¯†
}
```

---

## âœ… å½“å‰ç®¡ç†å‘˜è´¦å·

| å­—æ®µ | å€¼ |
|------|------|
| ç”¨æˆ·å | 1 |
| æ˜æ–‡å¯†ç  | 123123 |
| SHA256å¯†ç  | 96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e |
| è§’è‰² | 3ï¼ˆç®¡ç†å‘˜ï¼‰ |
| çŠ¶æ€ | 1ï¼ˆæ­£å¸¸ï¼‰ |

---

## ğŸ› ï¸ ä¿®å¤æ­¥éª¤

### æ–¹æ³•1ï¼šæ‰§è¡ŒSQLæ–‡ä»¶ï¼ˆæ¨èï¼‰

```bash
# åœ¨MySQLä¸­æ‰§è¡Œ
mysql -u root -p community_group_buy < fix_admin_password.sql
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ‰§è¡ŒSQL

```sql
UPDATE sys_user 
SET password = '96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e'
WHERE username = '1';
```

### æ–¹æ³•3ï¼šä½¿ç”¨æ³¨å†Œæ¥å£

```bash
POST http://localhost:8061/api/user/register
Content-Type: application/json

{
  "username": "1",
  "password": "123123",
  "phone": "13800000001",
  "role": 3,
  "realName": "ç®¡ç†å‘˜"
}
```

æ³¨æ„ï¼šå¦‚æœç”¨æˆ·åå·²å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆ é™¤æ—§è®°å½•ã€‚

---

## ğŸ“ å¸¸ç”¨å¯†ç çš„SHA256å€¼

| æ˜æ–‡å¯†ç  | SHA256å€¼ |
|---------|---------|
| 123123 | 96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e |
| admin123 | 240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9 |
| 123456 | 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92 |
| password | 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 |

---

## ğŸ”§ å¦‚ä½•è®¡ç®—SHA256å€¼

### æ–¹æ³•1ï¼šä½¿ç”¨åœ¨çº¿å·¥å…·
è®¿é—®ï¼šhttps://emn178.github.io/online-tools/sha256.html
è¾“å…¥æ˜æ–‡å¯†ç ï¼Œè·å–SHA256å€¼

### æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œ

**Linux/Mac:**
```bash
echo -n "123123" | sha256sum
```

**Windows PowerShell:**
```powershell
$string = "123123"
$sha256 = [System.Security.Cryptography.SHA256]::Create()
$bytes = [System.Text.Encoding]::UTF8.GetBytes($string)
$hash = $sha256.ComputeHash($bytes)
[BitConverter]::ToString($hash).Replace("-","").ToLower()
```

### æ–¹æ³•3ï¼šä½¿ç”¨Javaä»£ç 

```java
import cn.hutool.crypto.SecureUtil;

public class PasswordGenerator {
    public static void main(String[] args) {
        String password = "123123";
        String sha256 = SecureUtil.sha256(password);
        System.out.println("æ˜æ–‡: " + password);
        System.out.println("SHA256: " + sha256);
    }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¯†ç å¿…é¡»SHA256åŠ å¯†
- âŒ **é”™è¯¯**ï¼šåœ¨æ•°æ®åº“ä¸­ç›´æ¥å­˜å‚¨æ˜æ–‡ `123123`
- âœ… **æ­£ç¡®**ï¼šå­˜å‚¨SHA256å€¼ `96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e`

### 2. æ‰‹æœºå·å¿…é¡»AESåŠ å¯†
```java
String encryptedPhone = SecurityUtil.encryptAES(phone);
```

### 3. è§’è‰²å€¼
- 1 = æ™®é€šç”¨æˆ·
- 2 = å›¢é•¿
- 3 = ç®¡ç†å‘˜

### 4. çŠ¶æ€å€¼
- 0 = ç¦ç”¨
- 1 = æ­£å¸¸

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æ‰§è¡Œä¿®å¤SQL
```bash
mysql -u root -p community_group_buy < fix_admin_password.sql
```

### 2. é‡å¯UserServiceï¼ˆå¯é€‰ï¼‰
å¦‚æœåç«¯æœ‰ç¼“å­˜ï¼Œå»ºè®®é‡å¯ï¼š
```bash
cd E:\E\BYSJ\community-group-buy-backend\UserService
mvn spring-boot:run
```

### 3. æµ‹è¯•ç™»å½•
```bash
# ä½¿ç”¨curlæµ‹è¯•
curl -X POST http://localhost:8061/api/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "1",
    "password": "123123"
  }'
```

### 4. å‰ç«¯ç™»å½•
- è®¿é—®ï¼šhttp://localhost:5173
- ç”¨æˆ·åï¼š1
- å¯†ç ï¼š123123

---

## ğŸ¯ é¢„æœŸç»“æœ

### æˆåŠŸçš„å“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 604800,
    "userInfo": {
      "userId": 1,
      "username": "1",
      "role": 3,
      "roleName": "ç®¡ç†å‘˜",
      "status": 1
    }
  }
}
```

### å¤±è´¥çš„å“åº”ï¼ˆå¯†ç é”™è¯¯ï¼‰
```json
{
  "code": 1001,
  "message": "å¯†ç é”™è¯¯",
  "data": null
}
```

---

## ğŸ“š ç›¸å…³ä»£ç ä½ç½®

- **å¯†ç åŠ å¯†å·¥å…·**: `common/src/main/java/com/bcu/edu/common/utils/SecurityUtil.java`
- **ç”¨æˆ·æœåŠ¡é€»è¾‘**: `UserService/src/main/java/com/bcu/edu/service/UserService.java`
  - æ³¨å†Œï¼šç¬¬57è¡Œ
  - ç™»å½•ï¼šç¬¬85è¡Œ
- **å‰ç«¯ç™»å½•é¡µ**: `community-group-buy-admin/src/views/LoginView.vue`

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-10-12  
**æœ€åæ›´æ–°**: 2025-10-12  
**çŠ¶æ€**: âœ… å·²éªŒè¯

