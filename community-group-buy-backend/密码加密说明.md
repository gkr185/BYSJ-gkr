# 密码加密说明

## 📋 问题说明

在社区团购系统中，密码在数据库中是**SHA256加密存储**的，不能直接存储明文密码。

---

## 🔐 密码加密逻辑

### 代码逻辑（UserService.java）

```java
// 注册时
user.setPassword(SecurityUtil.sha256(request.getPassword()));

// 登录时
String encryptedPassword = SecurityUtil.sha256(request.getPassword());
if (!encryptedPassword.equals(user.getPassword())) {
    throw new BusinessException("密码错误");
}
```

### 加密方法（SecurityUtil.java）

```java
public static String sha256(String text) {
    return SecureUtil.sha256(text);  // Hutool的SHA256加密
}
```

---

## ✅ 当前管理员账号

| 字段 | 值 |
|------|------|
| 用户名 | 1 |
| 明文密码 | 123123 |
| SHA256密码 | 96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e |
| 角色 | 3（管理员） |
| 状态 | 1（正常） |

---

## 🛠️ 修复步骤

### 方法1：执行SQL文件（推荐）

```bash
# 在MySQL中执行
mysql -u root -p community_group_buy < fix_admin_password.sql
```

### 方法2：手动执行SQL

```sql
UPDATE sys_user 
SET password = '96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e'
WHERE username = '1';
```

### 方法3：使用注册接口

```bash
POST http://localhost:8061/api/user/register
Content-Type: application/json

{
  "username": "1",
  "password": "123123",
  "phone": "13800000001",
  "role": 3,
  "realName": "管理员"
}
```

注意：如果用户名已存在，需要先删除旧记录。

---

## 📝 常用密码的SHA256值

| 明文密码 | SHA256值 |
|---------|---------|
| 123123 | 96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e |
| admin123 | 240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9 |
| 123456 | 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92 |
| password | 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 |

---

## 🔧 如何计算SHA256值

### 方法1：使用在线工具
访问：https://emn178.github.io/online-tools/sha256.html
输入明文密码，获取SHA256值

### 方法2：使用命令行

**Linux/Mac:**
```bash
echo -n "123123" | sha256sum
```

**Windows PowerShell:**
```powershell
$string = "123123"
$sha256 = [System.Security.Cryptography.SHA256]::Create()
$bytes = [System.Text.Encoding]::UTF8.GetBytes($string)
$hash = $sha256.ComputeHash($bytes)
[BitConverter]::ToString($hash).Replace("-","").ToLower()
```

### 方法3：使用Java代码

```java
import cn.hutool.crypto.SecureUtil;

public class PasswordGenerator {
    public static void main(String[] args) {
        String password = "123123";
        String sha256 = SecureUtil.sha256(password);
        System.out.println("明文: " + password);
        System.out.println("SHA256: " + sha256);
    }
}
```

---

## ⚠️ 注意事项

### 1. 密码必须SHA256加密
- ❌ **错误**：在数据库中直接存储明文 `123123`
- ✅ **正确**：存储SHA256值 `96cae35ce8a9b0244178bf28e4966c2ce1b8385723a96a6b838858cdd6ca0a1e`

### 2. 手机号必须AES加密
```java
String encryptedPhone = SecurityUtil.encryptAES(phone);
```

### 3. 角色值
- 1 = 普通用户
- 2 = 团长
- 3 = 管理员

### 4. 状态值
- 0 = 禁用
- 1 = 正常

---

## 🧪 测试验证

### 1. 执行修复SQL
```bash
mysql -u root -p community_group_buy < fix_admin_password.sql
```

### 2. 重启UserService（可选）
如果后端有缓存，建议重启：
```bash
cd E:\E\BYSJ\community-group-buy-backend\UserService
mvn spring-boot:run
```

### 3. 测试登录
```bash
# 使用curl测试
curl -X POST http://localhost:8061/api/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "1",
    "password": "123123"
  }'
```

### 4. 前端登录
- 访问：http://localhost:5173
- 用户名：1
- 密码：123123

---

## 🎯 预期结果

### 成功的响应
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 604800,
    "userInfo": {
      "userId": 1,
      "username": "1",
      "role": 3,
      "roleName": "管理员",
      "status": 1
    }
  }
}
```

### 失败的响应（密码错误）
```json
{
  "code": 1001,
  "message": "密码错误",
  "data": null
}
```

---

## 📚 相关代码位置

- **密码加密工具**: `common/src/main/java/com/bcu/edu/common/utils/SecurityUtil.java`
- **用户服务逻辑**: `UserService/src/main/java/com/bcu/edu/service/UserService.java`
  - 注册：第57行
  - 登录：第85行
- **前端登录页**: `community-group-buy-admin/src/views/LoginView.vue`

---

**文档创建时间**: 2025-10-12  
**最后更新**: 2025-10-12  
**状态**: ✅ 已验证

