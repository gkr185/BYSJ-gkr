# ç”¨æˆ·å‚å›¢æµç¨‹å®Œæ•´æµ‹è¯•æŒ‡å—

**åˆ›å»ºæ—¥æœŸ**: 2025-11-07  
**ç‰ˆæœ¬**: v1.0  
**é€‚ç”¨èŒƒå›´**: ç”¨æˆ·ç«¯å‚å›¢å…¨æµç¨‹ï¼ˆä»å•†å“é¡µåˆ°æ”¯ä»˜å®Œæˆï¼‰

---

## ğŸ“‹ ç›®å½•

1. [æµ‹è¯•å‡†å¤‡](#1-æµ‹è¯•å‡†å¤‡)
2. [å®Œæ•´æµç¨‹æµ‹è¯•](#2-å®Œæ•´æµç¨‹æµ‹è¯•)
3. [å¼‚å¸¸åœºæ™¯æµ‹è¯•](#3-å¼‚å¸¸åœºæ™¯æµ‹è¯•)
4. [APIè°ƒç”¨éªŒè¯](#4-apiè°ƒç”¨éªŒè¯)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#5-å¸¸è§é—®é¢˜æ’æŸ¥)

---

## 1. æµ‹è¯•å‡†å¤‡

### 1.1 ç¯å¢ƒå‡†å¤‡

#### åç«¯æœåŠ¡å¯åŠ¨

ç¡®ä¿ä»¥ä¸‹æœåŠ¡å·²å¯åŠ¨å¹¶æ­£å¸¸è¿è¡Œï¼š

```bash
# 1. UserService (ç«¯å£: 8081)
cd community-group-buy-backend/UserService
mvn spring-boot:run

# 2. ProductService (ç«¯å£: 8082)
cd community-group-buy-backend/ProductService
mvn spring-boot:run

# 3. GroupBuyService (ç«¯å£: 8083)
cd community-group-buy-backend/GroupBuyService
mvn spring-boot:run

# 4. OrderService (ç«¯å£: 8084)
cd community-group-buy-backend/OrderService
mvn spring-boot:run

# 5. PaymentService (ç«¯å£: 8085)
cd community-group-buy-backend/PaymentService
mvn spring-boot:run

# 6. Gateway (ç«¯å£: 8080)
cd community-group-buy-backend/gateway-service
mvn spring-boot:run
```

#### å‰ç«¯æœåŠ¡å¯åŠ¨

```bash
cd community-group-buy-frontend
npm run dev
# å‰ç«¯ç«¯å£: http://localhost:5173
```

### 1.2 æµ‹è¯•è´¦æˆ·å‡†å¤‡

#### å‡†å¤‡æ™®é€šç”¨æˆ·è´¦æˆ·

- **ç”¨æˆ·å**: `testuser001`
- **å¯†ç **: `123456`
- **è§’è‰²**: æ™®é€šç”¨æˆ·ï¼ˆrole=1ï¼‰
- **éœ€æ±‚**: æœ‰æ”¶è´§åœ°å€ã€è´¦æˆ·æœ‰ä½™é¢ï¼ˆè‡³å°‘100å…ƒï¼‰

#### å‡†å¤‡å›¢é•¿è´¦æˆ·ï¼ˆå¯é€‰ï¼Œç”¨äºåˆ›å»ºå›¢ï¼‰

- **ç”¨æˆ·å**: `leader001`
- **å¯†ç **: `123456`
- **è§’è‰²**: å›¢é•¿ï¼ˆrole=2ï¼‰
- **ç¤¾åŒº**: å·²å…³è”ç¤¾åŒº

### 1.3 æ•°æ®å‡†å¤‡

#### ç¡®ä¿æ•°æ®åº“ä¸­æœ‰ä»¥ä¸‹æ•°æ®

1. **å•†å“æ•°æ®** (`product_service_db.product`)
   - è‡³å°‘1ä¸ªå•†å“ï¼Œstatus=1ï¼ˆä¸Šæ¶ï¼‰

2. **æ‹¼å›¢æ´»åŠ¨** (`groupbuy_service_db.group_buy`)
   - è‡³å°‘1ä¸ªè¿›è¡Œä¸­çš„æ´»åŠ¨ï¼ˆstatus=1ï¼Œåœ¨æ—¶é—´èŒƒå›´å†…ï¼‰
   - å…³è”ä¸Šè¿°å•†å“

3. **è¿›è¡Œä¸­çš„å›¢** (`groupbuy_service_db.group_buy_team`)
   - è‡³å°‘1ä¸ªæ‹¼å›¢ä¸­çš„å›¢ï¼ˆteam_status=0ï¼Œæœªæ»¡å‘˜ï¼‰
   - å…³è”ä¸Šè¿°æ´»åŠ¨

#### SQLç¤ºä¾‹ï¼ˆä»…ä¾›å‚è€ƒï¼‰

```sql
-- æŸ¥çœ‹æ‹¼å›¢æ´»åŠ¨
SELECT * FROM group_buy WHERE status = 1 AND NOW() BETWEEN start_time AND end_time;

-- æŸ¥çœ‹è¿›è¡Œä¸­çš„å›¢
SELECT * FROM group_buy_team WHERE team_status = 0 AND current_num < required_num;

-- æŸ¥çœ‹ç”¨æˆ·ä½™é¢
SELECT * FROM user_account WHERE user_id = ä½ çš„ç”¨æˆ·ID;
```

---

## 2. å®Œæ•´æµç¨‹æµ‹è¯•

### æ­¥éª¤1: ç”¨æˆ·ç™»å½•

#### æ“ä½œæ­¥éª¤

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://localhost:5173`
2. ç‚¹å‡»å³ä¸Šè§’"ç™»å½•"æŒ‰é’®
3. è¾“å…¥æµ‹è¯•è´¦æˆ·ç”¨æˆ·åå’Œå¯†ç 
4. ç‚¹å‡»"ç™»å½•"

#### é¢„æœŸç»“æœ

âœ… ç™»å½•æˆåŠŸï¼Œé¡µé¢è·³è½¬åˆ°é¦–é¡µ  
âœ… å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·å  
âœ… æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºç™»å½•æ—¥å¿—

#### éªŒè¯ç‚¹

```javascript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œæ£€æŸ¥ï¼š
// 1. localStorageä¸­æ˜¯å¦ä¿å­˜äº†token
localStorage.getItem('user_token')

// 2. localStorageä¸­æ˜¯å¦ä¿å­˜äº†ç”¨æˆ·ä¿¡æ¯
JSON.parse(localStorage.getItem('user_info'))

// 3. Pinia storeçŠ¶æ€
// åœ¨æ§åˆ¶å°è¾“å…¥: useUserStore().isLogin
// åº”è¿”å›: true
```

---

### æ­¥éª¤2: æµè§ˆå•†å“å¹¶è¿›å…¥æ‹¼å›¢é¡µé¢

#### æ“ä½œæ­¥éª¤

1. åœ¨é¦–é¡µæˆ–å•†å“åˆ—è¡¨é¡µï¼Œæ‰¾åˆ°æœ‰æ‹¼å›¢æ´»åŠ¨çš„å•†å“
2. ç‚¹å‡»å•†å“çš„"æ‹¼å›¢è´­ä¹°"æŒ‰é’®ï¼ˆæˆ–ç›´æ¥è®¿é—® `/groupbuy/product/:productId`ï¼‰

#### é¢„æœŸç»“æœ

âœ… è·³è½¬åˆ°æ‹¼å›¢è¯¦æƒ…é¡µ (`GroupBuyProductDetailView.vue`)  
âœ… é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºå•†å“æ‘˜è¦ï¼ˆå›¾ç‰‡ã€åç§°ã€æ‹¼å›¢ä»·ï¼‰  
âœ… é¡µé¢æ˜¾ç¤ºæ‹¼å›¢æ´»åŠ¨åˆ—è¡¨  
âœ… æ¯ä¸ªæ´»åŠ¨ä¸‹æ˜¾ç¤º"è¿›è¡Œä¸­çš„å›¢"åˆ—è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰

#### APIè°ƒç”¨éªŒè¯

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° â†’ Network æ ‡ç­¾ï¼Œæ£€æŸ¥ä»¥ä¸‹è¯·æ±‚ï¼š

```
âœ… GET /api/product/{productId}           - è·å–å•†å“è¯¦æƒ…
âœ… GET /api/groupbuy/product/{productId}/activities?communityId=xxx - è·å–æ‹¼å›¢æ´»åŠ¨
```

#### ç•Œé¢æ£€æŸ¥

- [ ] å•†å“å°é¢å›¾æ˜¾ç¤ºæ­£å¸¸
- [ ] æ‹¼å›¢ä»·æ ¼æ˜¾ç¤ºæ­£ç¡®ï¼ˆçº¢è‰²å¤§å­—ï¼‰
- [ ] æ´»åŠ¨æ—¶é—´æ˜¾ç¤ºæ­£ç¡®
- [ ] å›¢åˆ—è¡¨å±•ç¤ºæ­£å¸¸
- [ ] å›¢å¡ç‰‡æ˜¾ç¤ºï¼šå›¢é•¿ä¿¡æ¯ã€ç¤¾åŒºä¿¡æ¯ã€è¿›åº¦æ¡ã€å€’è®¡æ—¶
- [ ] æœ¬ç¤¾åŒºçš„å›¢æœ‰"æœ¬ç¤¾åŒº"æ ‡ç­¾ï¼ˆç»¿è‰²ï¼‰

---

### æ­¥éª¤3: ç‚¹å‡»"å‚ä¸æ‹¼å›¢"

#### æ“ä½œæ­¥éª¤

1. åœ¨æ‹¼å›¢è¯¦æƒ…é¡µï¼Œé€‰æ‹©ä¸€ä¸ªæœªæ»¡å‘˜çš„å›¢
2. ç‚¹å‡»è¯¥å›¢çš„"å‚ä¸æ‹¼å›¢"æŒ‰é’®

#### é¢„æœŸç»“æœ

âœ… å¼¹å‡º"é€‰æ‹©æ”¶è´§åœ°å€"å¯¹è¯æ¡†  
âœ… å¯¹è¯æ¡†æ˜¾ç¤ºç”¨æˆ·çš„æ”¶è´§åœ°å€åˆ—è¡¨  
âœ… é»˜è®¤åœ°å€è‡ªåŠ¨é€‰ä¸­ï¼ˆæœ‰çº¢è‰²è¾¹æ¡†ï¼‰  
âœ… å¯¹è¯æ¡†åº•éƒ¨æ˜¾ç¤ºæ‹¼å›¢ä¿¡æ¯æ‘˜è¦ï¼ˆæ‹¼å›¢ä»·æ ¼ã€æˆå›¢äººæ•°ã€å½“å‰è¿›åº¦ï¼‰

#### APIè°ƒç”¨éªŒè¯

```
âœ… GET /api/address/list/{userId}  - åŠ è½½ç”¨æˆ·åœ°å€åˆ—è¡¨
```

#### ç•Œé¢æ£€æŸ¥

- [ ] åœ°å€åˆ—è¡¨æ˜¾ç¤ºå®Œæ•´ï¼ˆæ”¶è´§äººã€ç”µè¯ã€åœ°å€ï¼‰
- [ ] é»˜è®¤åœ°å€æœ‰"é»˜è®¤"æ ‡ç­¾ï¼ˆçº¢è‰²ï¼‰
- [ ] åœ°å€å¡ç‰‡å¯ä»¥é€‰æ‹©ï¼ˆå•é€‰æ¡†ï¼‰
- [ ] "æ·»åŠ æ–°åœ°å€"æŒ‰é’®å¯è§
- [ ] æ‹¼å›¢ä¿¡æ¯æ‘˜è¦æ˜¾ç¤ºæ­£ç¡®
- [ ] "ç¡®è®¤å‚å›¢"æŒ‰é’®å¯ç”¨

---

### æ­¥éª¤4: é€‰æ‹©åœ°å€å¹¶ç¡®è®¤å‚å›¢

#### æ“ä½œæ­¥éª¤

1. åœ¨åœ°å€åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ï¼ˆæˆ–ä½¿ç”¨é»˜è®¤åœ°å€ï¼‰
2. ç‚¹å‡»"ç¡®è®¤å‚å›¢"æŒ‰é’®

#### é¢„æœŸç»“æœ

âœ… æŒ‰é’®æ˜¾ç¤º"å‚å›¢ä¸­..."ï¼ˆloadingçŠ¶æ€ï¼‰  
âœ… å‚å›¢æˆåŠŸåæ˜¾ç¤ºæç¤ºï¼š"å‚å›¢æˆåŠŸï¼å›¢å·ï¼šT20251107xxx"  
âœ… å¯¹è¯æ¡†è‡ªåŠ¨å…³é—­  
âœ… é¡µé¢è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ (`/payment`)

#### APIè°ƒç”¨éªŒè¯

```
âœ… POST /api/groupbuy/team/join
   è¯·æ±‚ä½“: {
     "teamId": å›¢ID,
     "addressId": åœ°å€ID,
     "quantity": 1
   }
   
   å“åº”: {
     "code": 200,
     "data": {
       "orderId": è®¢å•ID,
       "teamId": å›¢ID,
       "teamNo": "T20251107xxx",
       "currentNum": 2,
       "requiredNum": 3,
       "remainNum": 1,
       "payAmount": 19.90,
       "expireTime": "2025-11-08 20:00:00"
     }
   }
```

#### å¼‚å¸¸æƒ…å†µ

å¦‚æœå‚å›¢å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
- [ ] åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
- [ ] å›¢æ˜¯å¦å·²æ»¡å‘˜
- [ ] ç”¨æˆ·æ˜¯å¦å·²å‚åŠ è¯¥å›¢ï¼ˆé‡å¤å‚å›¢ï¼‰
- [ ] è®¢å•æœåŠ¡æ˜¯å¦æ­£å¸¸

---

### æ­¥éª¤5: æ”¯ä»˜é¡µé¢

#### é¢„æœŸç»“æœ

âœ… è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ (`/payment`)  
âœ… URLåŒ…å«æŸ¥è¯¢å‚æ•°ï¼š`orderId`ã€`amount`ã€`type=groupbuy`  
âœ… é¡µé¢æ˜¾ç¤ºè®¢å•ä¿¡æ¯ï¼ˆè®¢å•ç¼–å·ã€è®¢å•ç±»å‹ã€åº”ä»˜é‡‘é¢ï¼‰  
âœ… æ˜¾ç¤ºè´¦æˆ·ä½™é¢  
âœ… æ˜¾ç¤ºæ”¯ä»˜æ–¹å¼ï¼ˆå½“å‰ä»…æ”¯æŒä½™é¢æ”¯ä»˜ï¼‰

#### APIè°ƒç”¨éªŒè¯

```
âœ… GET /api/order/{orderId}        - è·å–è®¢å•è¯¦æƒ…
âœ… GET /api/account/{userId}       - è·å–è´¦æˆ·ä½™é¢
```

#### ç•Œé¢æ£€æŸ¥

- [ ] è®¢å•ç¼–å·æ˜¾ç¤ºæ­£ç¡®
- [ ] è®¢å•ç±»å‹æ ‡ç­¾æ˜¾ç¤º"æ‹¼å›¢è®¢å•"ï¼ˆçº¢è‰²ï¼‰
- [ ] åº”ä»˜é‡‘é¢æ˜¾ç¤ºæ­£ç¡®ï¼ˆçº¢è‰²å¤§å­—ï¼‰
- [ ] è´¦æˆ·ä½™é¢æ˜¾ç¤ºæ­£ç¡®ï¼ˆç»¿è‰²ï¼‰
- [ ] å¦‚æœä½™é¢ä¸è¶³ï¼Œæ˜¾ç¤º"ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼"æç¤º
- [ ] æ”¯ä»˜æ–¹å¼é€‰ä¸­"ä½™é¢æ”¯ä»˜"
- [ ] "ç«‹å³æ”¯ä»˜"æŒ‰é’®å¯ç”¨ï¼ˆä½™é¢å……è¶³æ—¶ï¼‰

---

### æ­¥éª¤6: ç¡®è®¤æ”¯ä»˜

#### æ“ä½œæ­¥éª¤

1. æ£€æŸ¥è®¢å•ä¿¡æ¯å’Œé‡‘é¢
2. ç‚¹å‡»"ç«‹å³æ”¯ä»˜"æŒ‰é’®
3. åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡»"ç¡®è®¤æ”¯ä»˜"

#### é¢„æœŸç»“æœ

âœ… å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼š"ç¡®è®¤æ”¯ä»˜ Â¥19.90 å—ï¼Ÿ"  
âœ… ç‚¹å‡»ç¡®è®¤åï¼ŒæŒ‰é’®æ˜¾ç¤º"æ”¯ä»˜ä¸­..."  
âœ… æ”¯ä»˜æˆåŠŸåæ˜¾ç¤ºæç¤ºï¼š"æ”¯ä»˜æˆåŠŸï¼"  
âœ… 1.5ç§’åè‡ªåŠ¨è·³è½¬åˆ°"æˆ‘çš„æ‹¼å›¢"é¡µé¢ (`/user/groups`)

#### APIè°ƒç”¨éªŒè¯

```
âœ… POST /api/payment/create
   è¯·æ±‚ä½“: {
     "orderId": è®¢å•ID,
     "payType": 3,
     "amount": æ”¯ä»˜é‡‘é¢
   }
   
   å“åº”: {
     "code": 200,
     "message": "æ”¯ä»˜æˆåŠŸ",
     "data": {
       "payId": æ”¯ä»˜ID,
       "payType": 3,
       "payStatus": 1
     }
   }
```

#### åç«¯è‡ªåŠ¨è§¦å‘çš„æµç¨‹

æ”¯ä»˜æˆåŠŸåï¼Œ**PaymentService** ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. âœ… è°ƒç”¨ `UserService.deduct()` - æ‰£æ¬¾
2. âœ… è°ƒç”¨ `OrderService.updatePayStatus()` - æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€
3. âœ… è°ƒç”¨ `OrderService.isGroupBuyOrder()` - åˆ¤æ–­æ˜¯å¦ä¸ºæ‹¼å›¢è®¢å•
4. âœ… è°ƒç”¨ `GroupBuyService.paymentCallback()` - æ‹¼å›¢æ”¯ä»˜å›è°ƒ
   - æ›´æ–°å‚å›¢çŠ¶æ€ï¼ˆUNPAID â†’ PAIDï¼‰
   - å›¢äººæ•°+1
   - æ£€æŸ¥æ˜¯å¦æˆå›¢
   - å¦‚æœæˆå›¢ï¼Œæ‰¹é‡æ›´æ–°è®¢å•çŠ¶æ€

#### åç«¯æ—¥å¿—éªŒè¯

æŸ¥çœ‹ `PaymentService` æ—¥å¿—ï¼š

```log
âœ… ç”¨æˆ·Xä½™é¢æ”¯ä»˜æˆåŠŸï¼Œé‡‘é¢ï¼š19.90ï¼Œè®¢å•IDï¼šxxx
âœ… è®¢å•æ”¯ä»˜çŠ¶æ€æ›´æ–°æˆåŠŸï¼Œè®¢å•IDï¼šxxx
âœ… è®¢å•ç±»å‹åˆ¤æ–­ï¼šæ‹¼å›¢è®¢å•
âœ… æ‹¼å›¢æ”¯ä»˜å›è°ƒæˆåŠŸï¼Œè®¢å•IDï¼šxxx
```

æŸ¥çœ‹ `GroupBuyService` æ—¥å¿—ï¼š

```log
âœ… æ”¯ä»˜å›è°ƒï¼šè®¢å•ID=xxx
âœ… å‚å›¢è®°å½•å·²æ›´æ–°ä¸ºå·²æ”¯ä»˜ï¼ŒmemberId=xxx
âœ… å›¢äººæ•°å·²æ›´æ–°ï¼š2 â†’ 3
âœ… æ£€æŸ¥æˆå›¢ï¼šå½“å‰3äººï¼Œéœ€è¦3äºº â†’ å·²æˆå›¢ï¼
âœ… æˆå›¢æˆåŠŸï¼teamId=xxxï¼Œè®¢å•æ•°ï¼š3
```

---

### æ­¥éª¤7: æŸ¥çœ‹æ‹¼å›¢è®°å½•

#### é¢„æœŸç»“æœ

âœ… è·³è½¬åˆ°"æˆ‘çš„æ‹¼å›¢"é¡µé¢ (`/user/groups`)  
âœ… é¡µé¢æ˜¾ç¤ºåˆšæ‰å‚åŠ çš„æ‹¼å›¢è®°å½•  
âœ… å›¢çŠ¶æ€æ˜¾ç¤ºæ­£ç¡®ï¼ˆæ‹¼å›¢ä¸­ æˆ– å·²æˆå›¢ï¼‰  
âœ… å¯ä»¥æŸ¥çœ‹å›¢è¯¦æƒ…ã€å›¢å‘˜ä¿¡æ¯

#### APIè°ƒç”¨éªŒè¯

```
âœ… GET /api/groupbuy/teams/my  - è·å–æˆ‘çš„æ‹¼å›¢è®°å½•
```

#### ç•Œé¢æ£€æŸ¥

- [ ] æ‹¼å›¢è®°å½•å¡ç‰‡æ˜¾ç¤ºå®Œæ•´ï¼ˆå•†å“å›¾ã€å›¢å·ã€çŠ¶æ€ã€è¿›åº¦ï¼‰
- [ ] å›¢çŠ¶æ€æ ‡ç­¾é¢œè‰²æ­£ç¡®ï¼ˆæ‹¼å›¢ä¸­=é»„è‰²ï¼Œå·²æˆå›¢=ç»¿è‰²ï¼‰
- [ ] å•†å“å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸
- [ ] å›¢å‘˜ä¿¡æ¯æ˜¾ç¤ºæ­£å¸¸ï¼ˆå¤´åƒã€ç”¨æˆ·åï¼‰
- [ ] å¯ä»¥æŸ¥çœ‹è®¢å•è¯¦æƒ…

---

## 3. å¼‚å¸¸åœºæ™¯æµ‹è¯•

### 3.1 ä½™é¢ä¸è¶³åœºæ™¯

#### æµ‹è¯•æ­¥éª¤

1. å°†æµ‹è¯•è´¦æˆ·ä½™é¢è®¾ç½®ä¸º < æ‹¼å›¢ä»·æ ¼
2. é‡å¤ä¸Šè¿°æµç¨‹åˆ°æ”¯ä»˜é¡µé¢
3. ç‚¹å‡»"ç«‹å³æ”¯ä»˜"

#### é¢„æœŸç»“æœ

âœ… æ”¯ä»˜é¡µé¢æ˜¾ç¤º"ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆå……å€¼"è­¦å‘Š  
âœ… "ç«‹å³æ”¯ä»˜"æŒ‰é’®è¢«ç¦ç”¨  
âœ… ç‚¹å‡»"ç«‹å³å……å€¼"å¯è·³è½¬åˆ°ä½™é¢é¡µé¢

#### SQLæ“ä½œï¼ˆä»…æµ‹è¯•ç”¨ï¼‰

```sql
-- æŸ¥çœ‹å½“å‰ä½™é¢
SELECT * FROM user_account WHERE user_id = ä½ çš„ç”¨æˆ·ID;

-- ä¸´æ—¶è®¾ç½®ä½™é¢ä¸è¶³ï¼ˆæµ‹è¯•åè®°å¾—æ¢å¤ï¼‰
UPDATE user_account SET balance = 5.00 WHERE user_id = ä½ çš„ç”¨æˆ·ID;
```

---

### 3.2 é‡å¤å‚å›¢åœºæ™¯

#### æµ‹è¯•æ­¥éª¤

1. å‚å›¢æˆåŠŸåï¼ˆä¸æ”¯ä»˜ï¼‰
2. åˆ·æ–°æ‹¼å›¢é¡µé¢ï¼Œå†æ¬¡ç‚¹å‡»åŒä¸€ä¸ªå›¢çš„"å‚ä¸æ‹¼å›¢"

#### é¢„æœŸç»“æœ

âœ… åç«¯è¿”å›é”™è¯¯ï¼š"æ‚¨å·²å‚åŠ è¯¥æ‹¼å›¢"  
âœ… å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º

#### APIå“åº”éªŒè¯

```json
{
  "code": 409,
  "message": "æ‚¨å·²å‚åŠ è¯¥æ‹¼å›¢",
  "data": null
}
```

---

### 3.3 å›¢å·²æ»¡å‘˜åœºæ™¯

#### æµ‹è¯•æ­¥éª¤

1. é€‰æ‹©ä¸€ä¸ªå³å°†æ»¡å‘˜çš„å›¢ï¼ˆä¾‹å¦‚2/3äººï¼‰
2. ç”¨å¦ä¸€ä¸ªè´¦æˆ·å‚å›¢å¹¶æ”¯ä»˜ï¼ˆä½¿å›¢æ»¡å‘˜ï¼‰
3. ç”¨å½“å‰è´¦æˆ·å†æ¬¡å‚å›¢

#### é¢„æœŸç»“æœ

âœ… åç«¯è¿”å›é”™è¯¯ï¼š"è¯¥æ‹¼å›¢å·²æ»¡å‘˜"  
âœ… å‰ç«¯æ˜¾ç¤ºé”™è¯¯æç¤º

---

### 3.4 æœªç™»å½•åœºæ™¯

#### æµ‹è¯•æ­¥éª¤

1. é€€å‡ºç™»å½•ï¼ˆç‚¹å‡»å³ä¸Šè§’"é€€å‡º"ï¼‰
2. è®¿é—®æ‹¼å›¢é¡µé¢ï¼Œç‚¹å‡»"å‚ä¸æ‹¼å›¢"

#### é¢„æœŸç»“æœ

âœ… æ˜¾ç¤ºæç¤ºï¼š"è¯·å…ˆç™»å½•"  
âœ… è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢

---

### 3.5 æ— æ”¶è´§åœ°å€åœºæ™¯

#### æµ‹è¯•æ­¥éª¤

1. åˆ é™¤æµ‹è¯•è´¦æˆ·çš„æ‰€æœ‰æ”¶è´§åœ°å€
2. ç‚¹å‡»"å‚ä¸æ‹¼å›¢"

#### é¢„æœŸç»“æœ

âœ… åœ°å€é€‰æ‹©å¯¹è¯æ¡†æ˜¾ç¤º"æš‚æ— æ”¶è´§åœ°å€"  
âœ… æ˜¾ç¤º"æ·»åŠ æ”¶è´§åœ°å€"æŒ‰é’®  
âœ… ç‚¹å‡»æŒ‰é’®å¯è·³è½¬åˆ°åœ°å€ç®¡ç†é¡µé¢

---

## 4. APIè°ƒç”¨éªŒè¯

### å®Œæ•´APIè°ƒç”¨é“¾è·¯

```
ç”¨æˆ·å‚å›¢æµç¨‹ï¼š

1. ã€å‰ç«¯ã€‘GET /api/groupbuy/product/{productId}/activities
   â†“
2. ã€å‰ç«¯ã€‘ç‚¹å‡»"å‚ä¸æ‹¼å›¢"
   â†“
3. ã€å‰ç«¯ã€‘GET /api/address/list/{userId}
   â†“
4. ã€å‰ç«¯ã€‘POST /api/groupbuy/team/join
   â†“ ã€åç«¯ã€‘GroupBuyServiceå†…éƒ¨æµç¨‹ï¼š
   â”œâ”€ SELECT ... FOR UPDATE (åŠ è¡Œé”)
   â”œâ”€ éªŒè¯å›¢çŠ¶æ€
   â”œâ”€ Feign â†’ POST /api/order/feign/create (åˆ›å»ºè®¢å•)
   â””â”€ INSERT group_buy_member (è®°å½•å‚å›¢)
   â†“
5. ã€å‰ç«¯ã€‘GET /api/order/{orderId}
   â†“
6. ã€å‰ç«¯ã€‘GET /api/account/{userId}
   â†“
7. ã€å‰ç«¯ã€‘POST /api/payment/create
   â†“ ã€åç«¯ã€‘PaymentServiceå†…éƒ¨æµç¨‹ï¼š
   â”œâ”€ Feign â†’ POST /api/account/feign/deduct (æ‰£æ¬¾)
   â”œâ”€ UPDATE payment_record (æ›´æ–°æ”¯ä»˜è®°å½•)
   â”œâ”€ Feign â†’ POST /api/order/feign/updatePayStatus (æ›´æ–°è®¢å•æ”¯ä»˜çŠ¶æ€)
   â”œâ”€ Feign â†’ GET /api/order/feign/isGroupBuyOrder (åˆ¤æ–­è®¢å•ç±»å‹)
   â””â”€ Feign â†’ POST /api/groupbuy/payment/callback (æ‹¼å›¢æ”¯ä»˜å›è°ƒ)
       â†“ ã€åç«¯ã€‘GroupBuyServiceå›è°ƒæµç¨‹ï¼š
       â”œâ”€ SELECT ... FOR UPDATE (åŠ è¡Œé”)
       â”œâ”€ UPDATE group_buy_member (æ›´æ–°å‚å›¢çŠ¶æ€)
       â”œâ”€ UPDATE group_buy_team (å›¢äººæ•°+1)
       â”œâ”€ æ£€æŸ¥æˆå›¢æ¡ä»¶
       â””â”€ å¦‚æœæˆå›¢ï¼š
           â”œâ”€ UPDATE group_buy_team (æ›´æ–°å›¢çŠ¶æ€)
           â”œâ”€ UPDATE group_buy_member (æ‰¹é‡æ›´æ–°æˆå‘˜çŠ¶æ€)
           â””â”€ Feign â†’ POST /api/order/feign/batchUpdateStatus (æ‰¹é‡æ›´æ–°è®¢å•çŠ¶æ€)
```

### ä½¿ç”¨Postmanæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

#### 1. å‚å›¢æ¥å£æµ‹è¯•

```http
POST http://localhost:8080/api/groupbuy/team/join
Authorization: Bearer {ä½ çš„token}
Content-Type: application/json

{
  "teamId": 1,
  "addressId": 1,
  "quantity": 1
}
```

#### 2. æ”¯ä»˜æ¥å£æµ‹è¯•

```http
POST http://localhost:8080/api/payment/create
Authorization: Bearer {ä½ çš„token}
Content-Type: application/json

{
  "orderId": 8002,
  "payType": 3,
  "amount": 19.90
}
```

---

## 5. å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: ç‚¹å‡»"å‚ä¸æ‹¼å›¢"æ˜¾ç¤º"è¯·å…ˆç™»å½•"ï¼ˆä½†å·²ç™»å½•ï¼‰

**åŸå› **: `userStore.isLoggedIn` å±æ€§åé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**: 
- ç¡®è®¤ä½¿ç”¨ `userStore.isLogin`ï¼ˆæ­£ç¡®ï¼‰è€Œä¸æ˜¯ `userStore.isLoggedIn`
- å·²åœ¨ä»£ç ä¸­ä¿®å¤

**éªŒè¯æ–¹æ³•**:
```javascript
// æµè§ˆå™¨æ§åˆ¶å°
import { useUserStore } from '@/stores/user'
const userStore = useUserStore()
console.log(userStore.isLogin)  // åº”è¿”å› true
```

---

### é—®é¢˜2: åœ°å€åˆ—è¡¨ä¸ºç©º

**å¯èƒ½åŸå› **:
1. ç”¨æˆ·ç¡®å®æ²¡æœ‰æ”¶è´§åœ°å€
2. APIè°ƒç”¨å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥Networkè¯·æ±‚æ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥å“åº”æ•°æ®æ ¼å¼
3. ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼š
```sql
SELECT * FROM user_address WHERE user_id = ä½ çš„ç”¨æˆ·ID;
```

---

### é—®é¢˜3: å‚å›¢æˆåŠŸä½†æœªè·³è½¬æ”¯ä»˜é¡µé¢

**å¯èƒ½åŸå› **:
1. APIè¿”å›æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ
2. è·¯ç”±è·³è½¬å‚æ•°é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ `joinTeam` APIå“åº”ï¼š
```javascript
// ç¡®è®¤è¿”å›æ•°æ®åŒ…å« orderId å’Œ payAmount
{
  "code": 200,
  "data": {
    "orderId": è®¢å•ID,
    "payAmount": é‡‘é¢
  }
}
```

2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

---

### é—®é¢˜4: æ”¯ä»˜æˆåŠŸä½†å›¢çŠ¶æ€æœªæ›´æ–°

**å¯èƒ½åŸå› **:
1. PaymentServiceæ”¯ä»˜å›è°ƒæœªè§¦å‘
2. GroupBuyServiceå›è°ƒå¤„ç†å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æŸ¥çœ‹PaymentServiceæ—¥å¿—ï¼š
```log
æ”¯ä»˜æˆåŠŸåå¤„ç†å¼€å§‹ï¼Œè®¢å•IDï¼šxxx
æ‹¼å›¢æ”¯ä»˜å›è°ƒæˆåŠŸï¼Œè®¢å•IDï¼šxxx
```

2. æŸ¥çœ‹GroupBuyServiceæ—¥å¿—ï¼š
```log
æ”¯ä»˜å›è°ƒï¼šè®¢å•ID=xxx
å‚å›¢è®°å½•å·²æ›´æ–°ä¸ºå·²æ”¯ä»˜
```

3. æ£€æŸ¥æ•°æ®åº“ï¼š
```sql
-- æ£€æŸ¥å‚å›¢çŠ¶æ€
SELECT * FROM group_buy_member WHERE order_id = è®¢å•ID;
-- statusåº”è¯¥ä»0å˜ä¸º1

-- æ£€æŸ¥å›¢äººæ•°
SELECT * FROM group_buy_team WHERE team_id = å›¢ID;
-- current_numåº”è¯¥+1
```

---

### é—®é¢˜5: ä½™é¢æ‰£æ¬¾å¤±è´¥

**å¯èƒ½åŸå› **:
1. UserServiceæœªå¯åŠ¨
2. ä½™é¢ä¸è¶³
3. Feignè°ƒç”¨å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥UserServiceæ˜¯å¦è¿è¡Œ
2. æŸ¥çœ‹PaymentServiceæ—¥å¿—ï¼š
```log
è°ƒç”¨UserServiceæ‰£æ¬¾å¤±è´¥: ä½™é¢ä¸è¶³
```

3. æ£€æŸ¥æ•°æ®åº“ä½™é¢ï¼š
```sql
SELECT * FROM user_account WHERE user_id = ä½ çš„ç”¨æˆ·ID;
```

---

### é—®é¢˜6: æˆå›¢åè®¢å•çŠ¶æ€æœªæ›´æ–°

**å¯èƒ½åŸå› **:
1. OrderService Feignè°ƒç”¨å¤±è´¥
2. æ‰¹é‡æ›´æ–°å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æŸ¥çœ‹GroupBuyServiceæ—¥å¿—ï¼š
```log
æˆå›¢æˆåŠŸï¼teamId=xxxï¼Œè®¢å•æ•°ï¼š3
æ‰¹é‡æ›´æ–°è®¢å•çŠ¶æ€ï¼šå¾…å‘è´§
```

2. æ£€æŸ¥æ•°æ®åº“ï¼š
```sql
-- æ£€æŸ¥è®¢å•çŠ¶æ€
SELECT * FROM orders WHERE order_id IN (è®¢å•IDåˆ—è¡¨);
-- order_statusåº”è¯¥ä»0å˜ä¸º1ï¼ˆå¾…å‘è´§ï¼‰
```

---

## 6. æ€§èƒ½å’Œå¹¶å‘æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

### å¹¶å‘å‚å›¢æµ‹è¯•

ä½¿ç”¨JMeteræˆ–ç±»ä¼¼å·¥å…·ï¼Œæ¨¡æ‹Ÿå¤šä¸ªç”¨æˆ·åŒæ—¶å‚å›¢ï¼š

1. åˆ›å»ºä¸€ä¸ª3äººå›¢
2. åŒæ—¶å‘èµ·5ä¸ªå‚å›¢è¯·æ±‚
3. é¢„æœŸç»“æœï¼š
   - å‰3ä¸ªè¯·æ±‚æˆåŠŸ
   - å2ä¸ªè¯·æ±‚å¤±è´¥ï¼ˆå›¢å·²æ»¡ï¼‰
   - å›¢äººæ•°å‡†ç¡®ä¸º3
   - æ— æ•°æ®ä¸ä¸€è‡´

### è¡Œé”éªŒè¯

æŸ¥çœ‹æ•°æ®åº“é”ç­‰å¾…æƒ…å†µï¼š

```sql
-- MySQLæŸ¥çœ‹é”ç­‰å¾…
SHOW ENGINE INNODB STATUS;
```

---

## 7. æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•
- [ ] æ‹¼å›¢é¡µé¢æ­£å¸¸æ˜¾ç¤ºæ´»åŠ¨å’Œå›¢åˆ—è¡¨
- [ ] å¯ä»¥é€‰æ‹©æ”¶è´§åœ°å€
- [ ] å‚å›¢æ¥å£è°ƒç”¨æˆåŠŸ
- [ ] æ”¯ä»˜é¡µé¢æ˜¾ç¤ºæ­£ç¡®
- [ ] æ”¯ä»˜æˆåŠŸ
- [ ] è®¢å•çŠ¶æ€æ­£ç¡®æ›´æ–°
- [ ] å‚å›¢çŠ¶æ€æ­£ç¡®æ›´æ–°
- [ ] æˆå›¢é€»è¾‘æ­£ç¡®è§¦å‘

### å¼‚å¸¸æµ‹è¯•
- [ ] ä½™é¢ä¸è¶³åœºæ™¯æ­£å¸¸æç¤º
- [ ] é‡å¤å‚å›¢è¢«æ­£ç¡®æ‹¦æˆª
- [ ] å›¢æ»¡å‘˜è¢«æ­£ç¡®æ‹¦æˆª
- [ ] æœªç™»å½•æ­£ç¡®è·³è½¬ç™»å½•
- [ ] æ— åœ°å€æç¤ºæ·»åŠ åœ°å€

### APIæµ‹è¯•
- [ ] æ‰€æœ‰APIè°ƒç”¨è¿”å›æ­£ç¡®
- [ ] Feignè°ƒç”¨é“¾è·¯å®Œæ•´
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®
- [ ] å“åº”æ—¶é—´åˆç†

### æ•°æ®ä¸€è‡´æ€§
- [ ] è®¢å•æ•°æ®æ­£ç¡®
- [ ] å‚å›¢è®°å½•æ­£ç¡®
- [ ] å›¢äººæ•°æ­£ç¡®
- [ ] ä½™é¢æ‰£æ¬¾æ­£ç¡®
- [ ] æˆå›¢åæ‰¹é‡æ›´æ–°æ­£ç¡®

---

## 8. æ€»ç»“

æœ¬æµ‹è¯•æŒ‡å—è¦†ç›–äº†ç”¨æˆ·å‚å›¢çš„å®Œæ•´æµç¨‹ï¼Œä»ç™»å½•åˆ°æ”¯ä»˜æˆåŠŸã€‚é€šè¿‡æŒ‰ç…§æœ¬æŒ‡å—è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥å…¨é¢éªŒè¯å‚å›¢åŠŸèƒ½çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚

**æ ¸å¿ƒéªŒè¯ç‚¹**:
1. âœ… å‰ç«¯UIäº¤äº’æµç•…
2. âœ… APIè°ƒç”¨é“¾è·¯å®Œæ•´
3. âœ… åç«¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®
4. âœ… æ•°æ®ä¸€è‡´æ€§ä¿è¯
5. âœ… å¼‚å¸¸åœºæ™¯å¤„ç†å®Œå–„

**ä¸‹ä¸€æ­¥**:
- æŒç»­ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

---

**æ–‡æ¡£ç»´æŠ¤**: å¦‚æœ‰æ–°å¢åŠŸèƒ½æˆ–ä¿®æ”¹ï¼Œè¯·åŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£ã€‚

**åé¦ˆæ¸ é“**: å¦‚å‘ç°æµ‹è¯•é—®é¢˜æˆ–æ–‡æ¡£é”™è¯¯ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

