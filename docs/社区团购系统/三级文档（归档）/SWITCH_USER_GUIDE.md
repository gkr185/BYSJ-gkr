# 快速切换测试用户功能使用指南

## 📋 功能说明

在开发调试过程中，经常需要切换不同角色的用户来测试各种功能。本功能提供了一个便捷的用户切换入口，让开发者可以快速切换到预设的测试账号，无需重复输入用户名和密码。

## 🎯 功能特点

- ✅ **仅开发环境可用**: 只在开发模式下显示，生产环境自动隐藏
- ✅ **快速切换**: 一键切换到不同角色用户
- ✅ **直观展示**: 卡片式展示用户信息，包含角色、社区等
- ✅ **当前用户标识**: 清晰标记当前登录的用户
- ✅ **自动刷新**: 切换后自动刷新页面状态

## 🔧 如何使用

### 1. 进入切换界面

1. 确保处于**开发环境**（`npm run dev`）
2. **登录**任意账号
3. 点击右上角**用户头像**下拉菜单
4. 点击 **"切换测试用户"** 选项

![切换入口](https://via.placeholder.com/400x200?text=切换入口位置)

### 2. 选择测试用户

在弹出的对话框中：
- 查看所有预设的测试用户
- 点击用户卡片或"切换"按钮
- 等待切换完成
- 页面自动刷新

![切换对话框](https://via.placeholder.com/600x400?text=切换对话框)

## 👥 预设测试用户

### 1. 系统管理员

**账号信息**:
- 用户名: `admin`
- 密码: `123456`
- 用户ID: `3`
- 真实姓名: 系统管理员
- 手机号: 13900000001
- 角色: 管理员（role=3）
- 社区: 全部社区

**权限说明**:
- ✅ 管理所有用户
- ✅ 管理所有商品
- ✅ 管理所有订单
- ✅ 查看所有数据统计
- ✅ 系统配置管理

**测试场景**:
- 用户管理功能
- 商品上架/下架
- 订单管理
- 数据统计报表
- 系统设置

---

### 2. 社区团长

**账号信息**:
- 用户名: `leader01`
- 密码: `123456`
- 用户ID: `1`
- 真实姓名: 张团长
- 手机号: 13800138001
- 角色: 团长（role=2）
- 社区: 阳光社区

**权限说明**:
- ✅ 发起拼团活动
- ✅ 管理本社区拼团
- ✅ 查看团购订单
- ✅ 查看佣金收益
- ✅ 处理配送任务

**测试场景**:
- 发起拼团流程
- 团长中心功能
- 佣金结算
- 订单配送
- 社区管理

---

### 3. 普通用户A（阳光社区）

**账号信息**:
- 用户名: `user01`
- 密码: `123456`
- 用户ID: `4`
- 真实姓名: 普通用户A
- 手机号: 13800138002
- 角色: 普通用户（role=1）
- 社区: 阳光社区

**权限说明**:
- ✅ 浏览商品
- ✅ 参与拼团
- ✅ 下单购物
- ✅ 查看个人订单
- ✅ 管理收货地址

**测试场景**:
- 商品浏览和搜索
- 参与拼团（本社区）
- 购物车和下单
- 订单管理
- 用户中心功能

---

### 4. 普通用户B（幸福家园）

**账号信息**:
- 用户名: `user02`
- 密码: `123456`
- 用户ID: `5`
- 真实姓名: 普通用户B
- 手机号: 13800138003
- 角色: 普通用户（role=1）
- 社区: 幸福家园

**权限说明**:
- ✅ 浏览商品
- ✅ 参与拼团
- ✅ 下单购物
- ✅ 查看个人订单
- ✅ 管理收货地址

**测试场景**:
- 跨社区拼团功能
- 不同社区配送规则
- 社区推荐商品
- 地址和社区绑定

## 🎨 界面展示

### 用户卡片设计

每个用户卡片包含：

```
┌─────────────────────────────────────────────────┐
│  [头像]   用户名称                    [切换按钮] │
│  [标签]   @username                             │
│           描述信息                               │
│           📱 手机号  📍 社区名称                │
└─────────────────────────────────────────────────┘
```

**视觉特点**:
- 不同角色使用不同颜色头像
- 当前用户显示绿色边框和背景
- 悬停效果：蓝色边框 + 阴影
- 响应式设计：移动端纵向排列

## 🔒 安全说明

### 生产环境保护

```javascript
// 仅在开发环境显示
const isDevelopment = computed(() => {
  return import.meta.env.DEV || import.meta.env.MODE === 'development'
})
```

- 生产环境下，"切换测试用户"菜单项**完全隐藏**
- 使用 `v-if` 指令，代码不会被编译到生产包中
- 确保生产环境的安全性

### 测试用户密码

- 所有测试用户使用统一密码：`123456`
- **仅用于开发测试环境**
- 生产环境应使用强密码
- 建议定期更换测试密码

## 📝 技术实现

### 文件结构

```
community-group-buy-frontend/
├── src/
│   ├── components/
│   │   └── common/
│   │       ├── Header.vue                # 导航栏（添加切换入口）
│   │       └── SwitchUserDialog.vue      # 切换对话框组件
│   └── api/
│       └── user.js                       # 登录API调用
```

### 核心代码

**Header.vue - 添加菜单项**:
```vue
<el-dropdown-item command="switchUser" divided v-if="isDevelopment">
  <el-icon><Refresh /></el-icon>
  切换测试用户
</el-dropdown-item>
```

**SwitchUserDialog.vue - 切换逻辑**:
```javascript
const handleSwitch = async (testUser) => {
  // 调用登录接口
  const res = await login({
    username: testUser.username,
    password: testUser.password
  })
  
  // 更新用户状态
  userStore.setToken(res.data.token)
  userStore.setUserInfo(res.data.userInfo)
  
  // 刷新页面
  router.go(0)
}
```

### 环境检测

```javascript
// 开发环境判断
const isDevelopment = computed(() => {
  return import.meta.env.DEV || import.meta.env.MODE === 'development'
})
```

**环境变量**:
- `import.meta.env.DEV`: Vite开发模式
- `import.meta.env.MODE`: 当前运行模式

## 🧪 测试流程示例

### 测试拼团功能

1. **切换到团长账号**（leader01）
   - 发起一个3人拼团活动
   - 记录团ID

2. **切换到普通用户A**（user01）
   - 参与刚才的拼团
   - 完成支付

3. **切换到普通用户B**（user02）
   - 参与同一个团
   - 测试成团逻辑

4. **切换回团长账号**
   - 查看团购状态
   - 确认佣金计算

### 测试跨社区功能

1. **切换到用户A**（阳光社区）
   - 浏览商品
   - 查看本社区拼团

2. **切换到用户B**（幸福家园）
   - 浏览相同商品
   - 查看不同社区拼团
   - 测试社区推荐逻辑

## 🔧 自定义测试用户

如需添加更多测试用户，编辑 `SwitchUserDialog.vue`:

```javascript
const testUsers = ref([
  // 现有用户...
  {
    userId: 6,                    // 新用户ID
    username: 'testuser',         // 用户名
    password: '123456',           // 密码
    realName: '测试用户',         // 真实姓名
    phone: '13800138004',         // 手机号
    role: 1,                      // 角色（1-普通用户，2-团长，3-管理员）
    roleName: '普通用户',         // 角色名称
    roleType: 'info',             // 标签颜色（info/warning/danger）
    description: '用于特殊测试',  // 描述
    communityName: '测试社区',    // 社区名称
    color: '#67c23a',            // 头像背景色
    icon: User                    // 头像图标
  }
])
```

## 📊 使用统计

**开发效率提升**:
- 无需手动输入用户名密码
- 快速切换节省约 70% 的时间
- 减少测试账号记忆负担

**适用场景**:
- ✅ 多角色权限测试
- ✅ 跨社区功能测试
- ✅ 拼团流程测试
- ✅ 订单流程测试
- ✅ UI适配测试

## ⚠️ 注意事项

1. **仅限开发环境**
   - 切勿在生产环境启用此功能
   - 确保环境变量正确配置

2. **数据隔离**
   - 测试用户的数据不应影响生产数据
   - 使用独立的测试数据库

3. **密码安全**
   - 测试密码不要与生产密码相同
   - 定期更换测试账号密码

4. **后端依赖**
   - 需要后端用户服务正常运行
   - 确保测试用户已在数据库中存在

## 🐛 常见问题

### Q1: 切换用户后页面没有刷新？
**A**: 检查 `handleUserSwitched` 方法是否正确执行。确保调用了 `router.go(0)` 刷新页面。

### Q2: 生产环境下看到了"切换测试用户"？
**A**: 检查环境变量配置。确保 `import.meta.env.DEV` 在生产环境下为 `false`。

### Q3: 切换失败提示"用户不存在"？
**A**: 确保后端数据库中已创建对应的测试用户。运行 SQL 脚本初始化测试数据。

### Q4: 如何添加更多测试用户？
**A**: 编辑 `SwitchUserDialog.vue` 中的 `testUsers` 数组，添加新的用户配置。

## 📦 相关文件

| 文件 | 说明 |
|------|------|
| `src/components/common/Header.vue` | 导航栏组件，包含切换入口 |
| `src/components/common/SwitchUserDialog.vue` | 切换对话框组件 |
| `src/api/user.js` | 用户API接口 |
| `src/stores/user.js` | 用户状态管理 |
| `docs/社区团购系统/二级文档（参考）/API_UserService.md` | 用户服务API文档 |

## 🎯 后续优化

- [ ] 支持记住上次选择的用户
- [ ] 支持自定义测试用户配置文件
- [ ] 添加快捷键切换（Ctrl+Shift+U）
- [ ] 显示用户最近操作记录
- [ ] 支持批量切换测试流程

---

**开发日期**: 2025-11-06  
**版本**: v1.0  
**状态**: ✅ 已完成  
**环境**: 开发环境专用

**祝开发顺利！** 🎉

