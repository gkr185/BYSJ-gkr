# ç¤¾åŒºå›¢è´­ç³»ç»Ÿ - æ•°æ®åº“è®¾è®¡è¯´æ˜æ–‡æ¡£

**é¡¹ç›®åç§°**: åŸºäºSpring Bootçš„ç¤¾åŒºå›¢è´­ç³»ç»Ÿ  
**æ¶æ„æ¨¡å¼**: å¾®æœåŠ¡æ¶æ„ï¼ˆSpring Cloudï¼‰  
**æ•°æ®åº“æ•°é‡**: 7ä¸ªç‹¬ç«‹æ•°æ®åº“  
**æ•°æ®åº“ç‰ˆæœ¬**: MySQL 8.0.36  
**å­—ç¬¦é›†**: utf8mb4  
**æ’åºè§„åˆ™**: utf8mb4_0900_ai_ci  
**æ–‡æ¡£ç‰ˆæœ¬**: v6.1ï¼ˆDeliveryServiceæ›´æ–°ç‰ˆï¼Œä¸å®é™…SQL100%ä¸€è‡´ï¼‰  
**æ›´æ–°æ—¥æœŸ**: 2025-11-13  
**ç”Ÿæˆè¯´æ˜**: æœ¬æ–‡æ¡£åŸºäºå®é™…SQLæ–‡ä»¶éªŒè¯ç”Ÿæˆï¼Œdelivery_service_dbå·²å®Œæˆæ›´æ–°ï¼Œæ–°å¢warehouse_configè¡¨

---

## ğŸ“‘ ç›®å½•

1. [æ•°æ®åº“æ¦‚è¿°](#æ•°æ®åº“æ¦‚è¿°)
2. [å¾®æœåŠ¡æ•°æ®åº“æ¶æ„](#å¾®æœåŠ¡æ•°æ®åº“æ¶æ„)
3. [æ•°æ®åº“è¡¨è¯¦ç»†è®¾è®¡](#æ•°æ®åº“è¡¨è¯¦ç»†è®¾è®¡)
4. [è·¨åº“å…³è”ç­–ç•¥](#è·¨åº“å…³è”ç­–ç•¥)
5. [ç´¢å¼•è®¾è®¡æ±‡æ€»](#ç´¢å¼•è®¾è®¡æ±‡æ€»)
6. [æ•°æ®å­—å…¸](#æ•°æ®å­—å…¸)
7. [SQLè„šæœ¬è¯´æ˜](#sqlè„šæœ¬è¯´æ˜)

---

## æ•°æ®åº“æ¦‚è¿°

### è®¾è®¡åŸåˆ™

1. **å¾®æœåŠ¡æ•°æ®åº“éš”ç¦»**: æ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼Œæ•°æ®éš”ç¦»ï¼ŒæœåŠ¡ç‹¬ç«‹
2. **å•åº“å†…ç‰©ç†å¤–é”®**: ä¿ç•™åŒä¸€æ•°æ®åº“å†…çš„ç‰©ç†å¤–é”®çº¦æŸï¼ˆå…±10ä¸ªï¼‰
3. **è·¨åº“åº”ç”¨å±‚æ ¡éªŒ**: è·¨æ•°æ®åº“å…³è”é€šè¿‡åº”ç”¨å±‚æ ¡éªŒå’ŒæœåŠ¡è°ƒç”¨ï¼ˆå…±22ä¸ªï¼‰
4. **æ•°æ®å†—ä½™è®¾è®¡**: å…³é”®å­—æ®µå†—ä½™ï¼Œå‡å°‘è·¨æœåŠ¡è°ƒç”¨
5. **å¿«ç…§æœºåˆ¶**: è®¢å•å•†å“å¿«ç…§è®¾è®¡ï¼Œä¿è¯å†å²æ•°æ®å‡†ç¡®æ€§
6. **å®‰å…¨æ€§è®¾è®¡**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ï¼ˆå¯†ç SHA256ã€æ‰‹æœºå·AESã€æ”¯ä»˜ä¿¡æ¯AESï¼‰
7. **å­—æ®µå‘½åç»Ÿä¸€**: ç»Ÿä¸€ä½¿ç”¨ `created_at`ã€`updated_at` æ—¶é—´å­—æ®µ

### æ€»ä½“ç»Ÿè®¡

| é¡¹ç›® | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| æ•°æ®åº“æ€»æ•° | 7ä¸ª | æŒ‰å¾®æœåŠ¡æ‹†åˆ† |
| è¡¨æ€»æ•° | 20å¼  | åˆ†å¸ƒåœ¨7ä¸ªæ•°æ®åº“ä¸­ |
| ç‰©ç†å¤–é”® | 10ä¸ª | ä»…å•åº“å†… |
| è·¨åº“å…³è” | 22ä¸ª | åº”ç”¨å±‚æ ¡éªŒ |
| ç´¢å¼•æ€»æ•° | 90ä¸ª+ | åŒ…æ‹¬ä¸»é”®ã€å”¯ä¸€ã€æ™®é€šç´¢å¼• |

---

## å¾®æœåŠ¡æ•°æ®åº“æ¶æ„

### æ•°æ®åº“åˆ—è¡¨

| æ•°æ®åº“åç§° | å¯¹åº”æœåŠ¡ | ç«¯å£ | è¡¨æ•° | ç‰©ç†å¤–é”® | è¯´æ˜ |
|-----------|---------|------|------|---------|------|
| **user_service_db** | UserService | 8061 | 5å¼  | 4ä¸ª | ç”¨æˆ·ã€è´¦æˆ·ã€åœ°å€ã€åé¦ˆã€æ—¥å¿— |
| **product_service_db** | ProductService | 8062 | 2å¼  | 1ä¸ª | å•†å“åˆ†ç±»ã€å•†å“ä¿¡æ¯ |
| **groupbuy_service_db** | GroupBuyService | 8063 | 3å¼  | 2ä¸ª | æ‹¼å›¢æ´»åŠ¨ã€å›¢å®ä¾‹ã€å‚å›¢è®°å½• |
| **order_service_db** | OrderService | 8065 | 3å¼  | 1ä¸ª | è´­ç‰©è½¦ã€è®¢å•ä¸»è¡¨ã€è®¢å•æ˜ç»† |
| **payment_service_db** | PaymentService | 8066 | 1å¼  | 0ä¸ª | æ”¯ä»˜è®°å½• |
| **delivery_service_db** | DeliveryService | 8067 | 2å¼  | 0ä¸ª | é…é€å•ã€ä»“åº“é…ç½®ï¼ˆåŒå¼•æ“è·¯å¾„è§„åˆ’ï¼‰ |
| **leader_service_db** | LeaderService | 8068 | 4å¼  | 2ä¸ª | ç¤¾åŒºã€ç¤¾åŒºç”³è¯·ã€å›¢é•¿ã€ä½£é‡‘ |

**æ€»è®¡**: 7ä¸ªæ•°æ®åº“ï¼Œ20å¼ è¡¨ï¼Œ10ä¸ªç‰©ç†å¤–é”®

---

## æ•°æ®åº“è¡¨è¯¦ç»†è®¾è®¡

### ä¸€ã€user_service_dbï¼ˆç”¨æˆ·æœåŠ¡æ•°æ®åº“ï¼‰

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS user_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 1.1 sys_userï¼ˆç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨æ‰€æœ‰ç”¨æˆ·ï¼ˆæ™®é€šç”¨æˆ·/å›¢é•¿/ç®¡ç†å‘˜ï¼‰åŸºç¡€ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|------|--------|------|
| user_id | BIGINT | - | NO | AUTO_INCREMENT | ç”¨æˆ·å”¯ä¸€IDï¼ˆä¸»é”®ï¼‰ |
| username | VARCHAR | 50 | NO | - | ç™»å½•è´¦å· |
| password | VARCHAR | 100 | NO | - | åŠ å¯†å¯†ç ï¼ˆSHA256ï¼‰ |
| role | INT | - | NO | - | è§’è‰²ï¼ˆ1-æ™®é€šç”¨æˆ·ï¼›2-å›¢é•¿ï¼›3-ç®¡ç†å‘˜ï¼‰ |
| real_name | VARCHAR | 50 | YES | NULL | çœŸå®å§“å |
| phone | VARCHAR | 128 | YES | NULL | æ‰‹æœºå·ï¼ˆAESåŠ å¯†å­˜å‚¨ï¼‰ |
| wx_openid | VARCHAR | 100 | YES | NULL | å¾®ä¿¡OpenID |
| avatar | VARCHAR | 255 | YES | NULL | å¤´åƒURL |
| community_id | BIGINT | - | YES | NULL | å½’å±ç¤¾åŒºIDï¼ˆè·¨åº“å…³è”ï¼‰ |
| status | INT | - | NO | 1 | çŠ¶æ€ï¼ˆ0-ç¦ç”¨ï¼›1-æ­£å¸¸ï¼‰ |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | YES | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`user_id`)
- **å”¯ä¸€ç´¢å¼•**:
  - `uk_username` (`username`) - è´¦å·å”¯ä¸€
  - `uk_phone` (`phone`) - æ‰‹æœºå·å”¯ä¸€
  - `uk_wx_openid` (`wx_openid`) - å¾®ä¿¡OpenIDå”¯ä¸€
- **æ™®é€šç´¢å¼•**:
  - `idx_community_id` (`community_id`) - æŸ¥è¯¢ç¤¾åŒºç”¨æˆ·
  - `idx_role` (`role`) - æŒ‰è§’è‰²ç­›é€‰
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰

**ä¸šåŠ¡è§„åˆ™**:
1. `username`å¿…é¡»å”¯ä¸€ï¼Œç”¨äºç™»å½•
2. `password`ä½¿ç”¨SHA256+ç›å€¼åŠ å¯†å­˜å‚¨
3. `phone`ä½¿ç”¨AESåŠ å¯†å­˜å‚¨
4. `role`æšä¸¾å€¼ï¼š1-æ™®é€šç”¨æˆ·ã€2-å›¢é•¿ã€3-ç®¡ç†å‘˜
5. `community_id`è·¨åº“å…³è”åˆ°`leader_service_db.community`ï¼Œåº”ç”¨å±‚æ ¡éªŒ
6. `status=0`æ—¶ç”¨æˆ·è¢«ç¦ç”¨ï¼Œæ— æ³•ç™»å½•

---

#### 1.2 user_accountï¼ˆç”¨æˆ·è´¦æˆ·è¡¨ï¼‰

**è¡¨è¯´æ˜**: ç®¡ç†ç”¨æˆ·ä½™é¢åŠèµ„é‡‘æµè½¬

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| account_id | BIGINT | - | - | NO | AUTO_INCREMENT | è´¦æˆ·IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | - | NO | - | å…³è”ç”¨æˆ·ID |
| balance | DECIMAL | 10 | 2 | NO | 0.00 | å¯ç”¨ä½™é¢ |
| freeze_amount | DECIMAL | 10 | 2 | NO | 0.00 | å†»ç»“é‡‘é¢ï¼ˆæœªç»“ç®—ä½£é‡‘/é€€æ¬¾ä¸­ï¼‰ |
| update_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | æœ€åæ›´æ–°æ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`account_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_user_id` (`user_id`) - ä¸€ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªè´¦æˆ·

**å¤–é”®çº¦æŸ**:
- `fk_account_user`: `user_id` â†’ `sys_user(user_id)` ON DELETE CASCADE ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. ç”¨æˆ·æ³¨å†Œåè‡ªåŠ¨åˆ›å»ºè´¦æˆ·ï¼Œåˆå§‹ä½™é¢ä¸º0
2. `balance`ä¸ºå¯ç”¨ä½™é¢ï¼Œå¯ç”¨äºæ”¯ä»˜è®¢å•
3. `freeze_amount`ä¸ºå†»ç»“é‡‘é¢ï¼ˆå›¢é•¿æœªç»“ç®—ä½£é‡‘ã€é€€æ¬¾å¤„ç†ä¸­é‡‘é¢ï¼‰
4. å……å€¼ã€æ¶ˆè´¹ã€é€€æ¬¾éœ€ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§

---

#### 1.3 user_addressï¼ˆç”¨æˆ·æ”¶è´§åœ°å€è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨ç”¨æˆ·æ”¶è´§åœ°å€ï¼Œæ”¯æŒåœ°ç†è·¯å¾„è®¡ç®—ï¼ˆDijkstraç®—æ³•ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| address_id | BIGINT | - | - | NO | AUTO_INCREMENT | åœ°å€IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | - | NO | - | å…³è”ç”¨æˆ·ID |
| receiver | VARCHAR | 50 | - | NO | - | æ”¶ä»¶äºº |
| phone | VARCHAR | 128 | - | NO | - | æ”¶ä»¶äººç”µè¯ï¼ˆAESåŠ å¯†å­˜å‚¨ï¼‰ |
| province | VARCHAR | 20 | - | NO | - | çœä»½ |
| city | VARCHAR | 20 | - | NO | - | åŸå¸‚ |
| district | VARCHAR | 20 | - | NO | - | åŒº/å¿ |
| detail | VARCHAR | 255 | - | NO | - | è¯¦ç»†åœ°å€ |
| longitude | DECIMAL | 10 | 6 | NO | - | åœ°å€ç»åº¦ï¼ˆDijkstraç®—æ³•è¾“å…¥ï¼‰ |
| latitude | DECIMAL | 10 | 6 | NO | - | åœ°å€çº¬åº¦ï¼ˆDijkstraç®—æ³•è¾“å…¥ï¼‰ |
| is_default | INT | - | - | NO | 0 | æ˜¯å¦é»˜è®¤ï¼ˆ0-å¦ï¼›1-æ˜¯ï¼‰ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`address_id`)
- **æ™®é€šç´¢å¼•**: `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰åœ°å€

**å¤–é”®çº¦æŸ**:
- `fk_address_user`: `user_id` â†’ `sys_user(user_id)` ON DELETE CASCADE ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. æ¯ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªæ”¶è´§åœ°å€
2. æ¯ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤åœ°å€ï¼ˆ`is_default=1`ï¼‰
3. ç»çº¬åº¦ç”±é«˜å¾·åœ°å›¾APIåœ°ç†ç¼–ç è·å–
4. åˆ é™¤ç”¨æˆ·æ—¶çº§è”åˆ é™¤æ‰€æœ‰åœ°å€

---

#### 1.4 user_feedbackï¼ˆç”¨æˆ·åé¦ˆè¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨ç”¨æˆ·åé¦ˆä¿¡æ¯ï¼Œæ”¯æŒç®¡ç†å‘˜å¤„ç†ä¸å›å¤

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| feedback_id | BIGINT | NO | AUTO_INCREMENT | åé¦ˆIDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | NO | - | ç”¨æˆ·ID |
| type | INT | NO | - | åé¦ˆç±»å‹ï¼ˆ1-åŠŸèƒ½é—®é¢˜ï¼›2-å•†å“é—®é¢˜ï¼›3-é…é€é—®é¢˜ï¼›4-æ”¯ä»˜é—®é¢˜ï¼›5-å…¶ä»–ï¼‰ |
| content | TEXT | NO | - | åé¦ˆå†…å®¹ |
| images | TEXT | YES | NULL | å›¾ç‰‡URLï¼ˆå¤šå¼ ç”¨é€—å·åˆ†éš”ï¼‰ |
| status | INT | NO | 0 | å¤„ç†çŠ¶æ€ï¼ˆ0-å¾…å¤„ç†ï¼›1-å¤„ç†ä¸­ï¼›2-å·²è§£å†³ï¼›3-å·²å…³é—­ï¼‰ |
| reply | TEXT | YES | NULL | å¤„ç†æ„è§ï¼ˆç®¡ç†å‘˜å›å¤ï¼‰ |
| reply_time | DATETIME | YES | NULL | å¤„ç†æ—¶é—´ |
| create_time | DATETIME | NO | CURRENT_TIMESTAMP | åé¦ˆæäº¤æ—¶é—´ |
| update_time | DATETIME | YES | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`feedback_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·åé¦ˆ
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_create_time` (`create_time`) - æŒ‰æ—¶é—´æ’åº

**å¤–é”®çº¦æŸ**:
- `fk_feedback_user`: `user_id` â†’ `sys_user(user_id)` ON DELETE CASCADE ON UPDATE CASCADE

---

#### 1.5 sys_operation_logï¼ˆç³»ç»Ÿæ“ä½œæ—¥å¿—è¡¨ï¼‰

**è¡¨è¯´æ˜**: è®°å½•ç³»ç»Ÿæ“ä½œå®¡è®¡æ—¥å¿—ï¼Œä¿éšœå®‰å…¨

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|------|--------|------|
| log_id | BIGINT | - | NO | AUTO_INCREMENT | æ—¥å¿—IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | YES | NULL | æ“ä½œäººID |
| username | VARCHAR | 50 | YES | NULL | æ“ä½œäººç”¨æˆ·å |
| operation | VARCHAR | 255 | NO | - | æ“ä½œå†…å®¹ |
| module | VARCHAR | 50 | NO | - | æ“ä½œæ¨¡å— |
| method | VARCHAR | 500 | YES | NULL | æ–¹æ³•åï¼ˆå®Œæ•´è·¯å¾„ï¼‰ |
| params | TEXT | - | YES | NULL | è¯·æ±‚å‚æ•°ï¼ˆJSONæ ¼å¼ï¼‰ |
| result | VARCHAR | 20 | YES | NULL | æ“ä½œç»“æœï¼ˆSUCCESS/FAILï¼‰ |
| error_msg | TEXT | - | YES | NULL | é”™è¯¯ä¿¡æ¯ |
| duration | INT | - | YES | NULL | æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| ip | VARCHAR | 50 | YES | NULL | æ“ä½œIPåœ°å€ |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | æ“ä½œæ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`log_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·æ“ä½œè®°å½•
  - `idx_module` (`module`) - æŒ‰æ¨¡å—ç­›é€‰
  - `idx_create_time` (`create_time`) - æŒ‰æ—¶é—´æŸ¥è¯¢
  - `idx_result` (`result`) - æŒ‰æ“ä½œç»“æœç­›é€‰

**å¤–é”®çº¦æŸ**:
- `fk_log_user`: `user_id` â†’ `sys_user(user_id)` ON DELETE SET NULL ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. ä½¿ç”¨`@OperationLog`æ³¨è§£è‡ªåŠ¨è®°å½•
2. æ•æ„Ÿæ•°æ®è„±æ•ï¼ˆpasswordã€tokenç­‰æ›¿æ¢ä¸º`***`ï¼‰
3. å¼‚æ­¥ä¿å­˜ï¼Œä¸é˜»å¡ä¸šåŠ¡

---

### äºŒã€product_service_dbï¼ˆå•†å“æœåŠ¡æ•°æ®åº“ï¼‰

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS product_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 2.1 product_categoryï¼ˆå•†å“åˆ†ç±»è¡¨ï¼‰

**è¡¨è¯´æ˜**: ç®¡ç†å•†å“åˆ†ç±»ä½“ç³»ï¼Œæ”¯æŒå¤šçº§åˆ†ç±»

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|------|--------|------|
| category_id | BIGINT | - | NO | AUTO_INCREMENT | åˆ†ç±»IDï¼ˆä¸»é”®ï¼‰ |
| parent_id | BIGINT | - | NO | 0 | çˆ¶åˆ†ç±»IDï¼ˆ0-é¡¶çº§åˆ†ç±»ï¼‰ |
| category_name | VARCHAR | 50 | NO | - | åˆ†ç±»åç§° |
| sort | INT | - | NO | 0 | æ’åºæƒé‡ï¼ˆå€¼è¶Šå°è¶Šé å‰ï¼‰ |
| status | TINYINT | - | NO | 1 | çŠ¶æ€ï¼ˆ0-ç¦ç”¨ï¼›1-å¯ç”¨ï¼‰ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`category_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_parent_id` (`parent_id`) - æŸ¥è¯¢å­åˆ†ç±»
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰

**ä¸šåŠ¡è§„åˆ™**:
1. æ”¯æŒäºŒçº§åˆ†ç±»ç»“æ„ï¼ˆé¡¶çº§åˆ†ç±» â†’ å­åˆ†ç±»ï¼‰
2. é¡¶çº§åˆ†ç±»çš„`parent_id=0`
3. åˆ é™¤åˆ†ç±»æ—¶éœ€æ£€æŸ¥æ˜¯å¦æœ‰å•†å“å…³è”
4. `sort`å€¼è¶Šå°ï¼Œæ˜¾ç¤ºé¡ºåºè¶Šé å‰

---

#### 2.2 productï¼ˆå•†å“ä¿¡æ¯è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨å•†å“ä¿¡æ¯ï¼Œæ”¯æŒæ‹¼å›¢åŠæ™®é€šè´­ä¹°

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| product_id | BIGINT | - | - | NO | AUTO_INCREMENT | å•†å“IDï¼ˆä¸»é”®ï¼‰ |
| category_id | BIGINT | - | - | YES | NULL | å…³è”åˆ†ç±»ID |
| product_name | VARCHAR | 100 | - | NO | - | å•†å“åç§° |
| cover_img | VARCHAR | 255 | - | NO | - | å°é¢å›¾URL |
| detail | TEXT | - | - | YES | NULL | å•†å“è¯¦æƒ…ï¼ˆå¯Œæ–‡æœ¬ï¼‰ |
| price | DECIMAL | 10 | 2 | NO | - | åŸä»· |
| group_price | DECIMAL | 10 | 2 | YES | NULL | æ‹¼å›¢å‚è€ƒä»·ï¼ˆå¯è¢«æ´»åŠ¨è¦†ç›–ï¼‰ |
| stock | INT | - | - | NO | 0 | åº“å­˜æ•°é‡ |
| status | TINYINT | - | - | NO | 1 | çŠ¶æ€ï¼ˆ0-ä¸‹æ¶ï¼›1-ä¸Šæ¶ï¼‰ |
| create_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | - | YES | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`product_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_category_id` (`category_id`) - æŒ‰åˆ†ç±»æŸ¥è¯¢
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_create_time` (`create_time`) - æŒ‰æ—¶é—´æ’åº

**å¤–é”®çº¦æŸ**:
- `fk_product_category`: `category_id` â†’ `product_category(category_id)` ON DELETE SET NULL ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. `status=1`æ—¶å•†å“åœ¨å‰ç«¯å±•ç¤º
2. `stock=0`æ—¶å•†å“æ˜¾ç¤º"ç¼ºè´§"
3. `group_price`ä¸ºæ‹¼å›¢å‚è€ƒä»·ï¼Œå®é™…ä»·æ ¼ç”±`group_buy`è¡¨å†³å®š
4. åˆ é™¤åˆ†ç±»æ—¶ï¼Œå•†å“çš„`category_id`è®¾ä¸ºNULL

---

### ä¸‰ã€groupbuy_service_dbï¼ˆæ‹¼å›¢æœåŠ¡æ•°æ®åº“ï¼‰

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS groupbuy_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 3.1 group_buyï¼ˆæ‹¼å›¢æ´»åŠ¨è¡¨ï¼‰

**è¡¨è¯´æ˜**: æ‹¼å›¢æ´»åŠ¨è¡¨ï¼ˆæ´»åŠ¨æ¨¡æ¿ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| activity_id | BIGINT | - | - | NO | AUTO_INCREMENT | æ´»åŠ¨IDï¼ˆä¸»é”®ï¼‰ |
| product_id | BIGINT | - | - | NO | - | å…³è”å•†å“IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| group_price | DECIMAL | 10 | 2 | NO | - | æ‹¼å›¢ä»· |
| required_num | INT | - | - | NO | 2 | æˆå›¢äººæ•° |
| max_num | INT | - | - | YES | NULL | æœ€å¤§äººæ•°é™åˆ¶ï¼ˆå¯ç©ºï¼Œæ— é™åˆ¶ï¼‰ |
| start_time | DATETIME | - | - | NO | - | æ´»åŠ¨å¼€å§‹æ—¶é—´ |
| end_time | DATETIME | - | - | NO | - | æ´»åŠ¨ç»“æŸæ—¶é—´ |
| status | TINYINT | - | - | NO | 1 | æ´»åŠ¨çŠ¶æ€ï¼ˆ0-æœªå¼€å§‹ï¼›1-è¿›è¡Œä¸­ï¼›2-å·²ç»“æŸï¼›3-å¼‚å¸¸ï¼‰ |
| qrcode_url | VARCHAR | 255 | - | YES | NULL | æ´»åŠ¨äºŒç»´ç URL |
| link | VARCHAR | 255 | - | YES | NULL | æ´»åŠ¨ä¸“å±é“¾æ¥ |
| create_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`activity_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_link` (`link`) - æ‹¼å›¢é“¾æ¥å”¯ä¸€
- **æ™®é€šç´¢å¼•**:
  - `idx_product_id` (`product_id`) - æŸ¥è¯¢å•†å“çš„æ‹¼å›¢æ´»åŠ¨
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_time` (`start_time`, `end_time`) - æ—¶é—´èŒƒå›´æŸ¥è¯¢

**ä¸šåŠ¡è§„åˆ™**:
1. `product_id`è·¨åº“å…³è”åˆ°`product_service_db.product`ï¼Œåº”ç”¨å±‚æ ¡éªŒ
2. `group_price`å¿…é¡»å°äºå•†å“çš„`price`
3. `required_num`é€šå¸¸ä¸º2-10äºº
4. å½“å‰æ—¶é—´åœ¨`start_time`å’Œ`end_time`ä¹‹é—´æ—¶ï¼Œ`status=1`
5. ä¸€ä¸ªæ´»åŠ¨å¯ä»¥æœ‰å¤šä¸ªå›¢å®ä¾‹

---

#### 3.2 group_buy_teamï¼ˆå›¢å®ä¾‹è¡¨ï¼‰

**è¡¨è¯´æ˜**: å›¢å®ä¾‹è¡¨ï¼ˆå…·ä½“çš„å›¢ï¼Œv3.0ä¼˜åŒ–ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|------|--------|------|
| team_id | BIGINT | - | NO | AUTO_INCREMENT | å›¢IDï¼ˆä¸»é”®ï¼‰ |
| team_no | VARCHAR | 32 | NO | - | å›¢å·ï¼ˆå¦‚ï¼šT20251027001ï¼‰ |
| activity_id | BIGINT | - | NO | - | å…³è”æ´»åŠ¨ID |
| launcher_id | BIGINT | - | NO | - | å‘èµ·äººç”¨æˆ·IDï¼ˆv3.0ä»…å›¢é•¿å¯å‘èµ·ï¼Œè·¨åº“å…³è”ï¼‰ |
| leader_id | BIGINT | - | NO | - | å½’å±å›¢é•¿IDï¼ˆé…é€å›¢ç‚¹ï¼Œv3.0ä¸­=launcher_idï¼Œè·¨åº“å…³è”ï¼‰ |
| community_id | BIGINT | - | YES | NULL | å½’å±ç¤¾åŒºIDï¼ˆv3.0æ–°å¢ï¼Œè·¨åº“å…³è”ï¼‰ |
| required_num | INT | - | NO | - | æˆå›¢äººæ•°ï¼ˆä»æ´»åŠ¨å¤åˆ¶ï¼‰ |
| current_num | INT | - | NO | 0 | å½“å‰äººæ•° |
| team_status | TINYINT | - | NO | 0 | å›¢çŠ¶æ€ï¼ˆ0-æ‹¼å›¢ä¸­ï¼›1-å·²æˆå›¢ï¼›2-å·²å¤±è´¥ï¼‰ |
| success_time | DATETIME | - | YES | NULL | æˆå›¢æ—¶é—´ |
| expire_time | DATETIME | - | NO | - | è¿‡æœŸæ—¶é—´ï¼ˆ24å°æ—¶åï¼‰ |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`team_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_team_no` (`team_no`) - å›¢å·å”¯ä¸€
- **æ™®é€šç´¢å¼•**:
  - `idx_activity_id` (`activity_id`) - æŸ¥è¯¢æ´»åŠ¨çš„æ‰€æœ‰å›¢
  - `idx_launcher_id` (`launcher_id`) - æŸ¥è¯¢ç”¨æˆ·å‘èµ·çš„å›¢
  - `idx_leader_id` (`leader_id`) - æŸ¥è¯¢å›¢é•¿çš„æ‰€æœ‰å›¢
  - `idx_community_id` (`community_id`) - æŸ¥è¯¢ç¤¾åŒºçš„æ‰€æœ‰å›¢
  - `idx_team_status` (`team_status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_expire_time` (`expire_time`) - å®šæ—¶ä»»åŠ¡æŸ¥è¯¢è¿‡æœŸå›¢
  - `idx_create_time` (`create_time`) - æŒ‰åˆ›å»ºæ—¶é—´æ’åº

**å¤–é”®çº¦æŸ**:
- `fk_team_activity`: `activity_id` â†’ `group_buy(activity_id)` ON DELETE CASCADE ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. `team_no`æ ¼å¼ï¼š`T + yyyyMMdd + 6ä½éšæœºæ•°`
2. v3.0ä»…å›¢é•¿å¯å‘èµ·ï¼Œ`launcher_id = leader_id`
3. `launcher_id`ã€`leader_id`ã€`community_id`è·¨åº“å…³è”ï¼Œåº”ç”¨å±‚æ ¡éªŒ
4. æˆå›¢æ¡ä»¶ï¼š`current_num >= required_num`
5. å®šæ—¶ä»»åŠ¡æ¯å°æ—¶æ£€æŸ¥è¿‡æœŸå›¢ï¼Œè‡ªåŠ¨é€€æ¬¾

---

#### 3.3 group_buy_memberï¼ˆå‚å›¢è®°å½•è¡¨ï¼‰

**è¡¨è¯´æ˜**: å‚å›¢è®°å½•è¡¨ï¼ˆv2.0æ–°å¢ï¼Œv3.0æ ¸å¿ƒï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| member_id | BIGINT | - | - | NO | AUTO_INCREMENT | å‚å›¢è®°å½•IDï¼ˆä¸»é”®ï¼‰ |
| team_id | BIGINT | - | - | NO | - | å›¢ID |
| user_id | BIGINT | - | - | NO | - | å‚å›¢ç”¨æˆ·IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| order_id | BIGINT | - | - | YES | NULL | å…³è”è®¢å•IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| is_launcher | TINYINT | - | - | NO | 0 | æ˜¯å¦å‘èµ·äººï¼ˆ0-å¦ï¼›1-æ˜¯ï¼‰ |
| product_quantity | INT | - | - | NO | 1 | è´­ä¹°å•†å“æ•°é‡ï¼ˆv6.1æ–°å¢ï¼‰ |
| pay_amount | DECIMAL | 10 | 2 | NO | - | æ”¯ä»˜é‡‘é¢ |
| join_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | å‚å›¢æ—¶é—´ |
| status | TINYINT | - | - | NO | 0 | çŠ¶æ€ï¼ˆ0-å¾…æ”¯ä»˜ï¼›1-å·²æ”¯ä»˜ï¼›2-å·²æˆå›¢ï¼›3-å·²å–æ¶ˆï¼‰ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`member_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_team_user` (`team_id`, `user_id`) - ä¸€ä¸ªç”¨æˆ·ä¸èƒ½é‡å¤å‚åŠ åŒä¸€ä¸ªå›¢
- **æ™®é€šç´¢å¼•**:
  - `idx_team_id` (`team_id`) - æŸ¥è¯¢å›¢çš„æ‰€æœ‰æˆå‘˜
  - `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·å‚ä¸çš„æ‰€æœ‰å›¢
  - `idx_order_id` (`order_id`) - é€šè¿‡è®¢å•æŸ¥è¯¢å‚å›¢è®°å½•
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰

**å¤–é”®çº¦æŸ**:
- `fk_member_team`: `team_id` â†’ `group_buy_team(team_id)` ON DELETE CASCADE ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. å‚å›¢æµç¨‹ï¼šç”¨æˆ·å‚å›¢ â†’ åˆ›å»ºè®¢å• â†’ æ”¯ä»˜ â†’ æ›´æ–°çŠ¶æ€
2. `is_launcher=1`è¡¨ç¤ºå‘èµ·äººï¼ˆæ¯ä¸ªå›¢åªæœ‰ä¸€ä¸ªï¼‰
3. `product_quantity`è®°å½•ç”¨æˆ·è´­ä¹°çš„å•†å“æ•°é‡ï¼Œé»˜è®¤ä¸º1ï¼ˆv6.1æ–°å¢ï¼‰
4. `user_id`ã€`order_id`è·¨åº“å…³è”ï¼Œåº”ç”¨å±‚æ ¡éªŒ
5. æˆå›¢åæ‰€æœ‰æˆå‘˜`status`æ›´æ–°ä¸º2
6. æ‹¼å›¢å¤±è´¥æˆ–ä¸­é€”é€€å‡ºï¼Œ`status`æ›´æ–°ä¸º3ï¼Œè‡ªåŠ¨é€€æ¬¾

---

### å››ã€order_service_dbï¼ˆè®¢å•æœåŠ¡æ•°æ®åº“ï¼‰

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS order_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 4.1 shopping_cartï¼ˆè´­ç‰©è½¦è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨ç”¨æˆ·å¾…è´­å•†å“ï¼Œæ”¯æŒæ‹¼å›¢/æ™®é€šå•†å“æ··å­˜

| å­—æ®µå | ç±»å‹ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| cart_id | BIGINT | NO | AUTO_INCREMENT | è´­ç‰©è½¦IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | NO | - | å…³è”ç”¨æˆ·IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| product_id | BIGINT | NO | - | å…³è”å•†å“IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| activity_id | BIGINT | YES | NULL | å…³è”æ‹¼å›¢æ´»åŠ¨IDï¼ˆéæ‹¼å›¢å•†å“ä¸ºnullï¼Œè·¨åº“å…³è”ï¼‰ |
| quantity | INT | NO | 1 | æ•°é‡ |
| add_time | DATETIME | NO | CURRENT_TIMESTAMP | æ·»åŠ æ—¶é—´ |
| update_time | DATETIME | YES | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`cart_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_user_product_activity` (`user_id`, `product_id`, `activity_id`) - é˜²æ­¢é‡å¤æ·»åŠ 
- **æ™®é€šç´¢å¼•**:
  - `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·è´­ç‰©è½¦
  - `idx_product_id` (`product_id`) - å•†å“å…³è”æŸ¥è¯¢
  - `idx_activity_id` (`activity_id`) - æ‹¼å›¢æ´»åŠ¨å…³è”æŸ¥è¯¢

**ä¸šåŠ¡è§„åˆ™**:
1. `user_id`ã€`product_id`ã€`activity_id`è·¨åº“å…³è”ï¼Œåº”ç”¨å±‚æ ¡éªŒ
2. `activity_id=NULL`è¡¨ç¤ºæ™®é€šè´­ä¹°
3. åŒä¸€å•†å“ã€åŒä¸€æ´»åŠ¨ä¸èƒ½é‡å¤æ·»åŠ 

---

#### 4.2 order_mainï¼ˆè®¢å•ä¸»è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨è®¢å•æ ¸å¿ƒä¿¡æ¯ï¼Œå…³è”ç”¨æˆ·ã€å›¢é•¿ä¸é…é€

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| order_id | BIGINT | - | - | NO | AUTO_INCREMENT | è®¢å•IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | - | NO | - | ä¸‹å•ç”¨æˆ·IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| leader_id | BIGINT | - | - | NO | - | å–è´§å›¢é•¿IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| order_sn | VARCHAR | 50 | - | NO | - | è®¢å•ç¼–å·ï¼ˆæ—¥æœŸ+éšæœºæ•°ï¼‰ |
| total_amount | DECIMAL | 10 | 2 | NO | - | å•†å“æ€»é‡‘é¢ |
| discount_amount | DECIMAL | 10 | 2 | NO | 0.00 | ä¼˜æƒ é‡‘é¢ |
| pay_amount | DECIMAL | 10 | 2 | NO | - | å®ä»˜é‡‘é¢ï¼ˆtotal - discountï¼‰ |
| order_status | TINYINT | - | - | NO | 0 | è®¢å•çŠ¶æ€ï¼ˆ0-å¾…æ”¯ä»˜ï¼›1-å¾…å‘è´§ï¼›2-é…é€ä¸­ï¼›3-å·²é€è¾¾ï¼›4-å·²å–æ¶ˆï¼›5-é€€æ¬¾ä¸­ï¼›6-å·²é€€æ¬¾ï¼‰ |
| pay_status | TINYINT | - | - | NO | 0 | æ”¯ä»˜çŠ¶æ€ï¼ˆ0-æœªæ”¯ä»˜ï¼›1-å·²æ”¯ä»˜ï¼‰ |
| pay_time | DATETIME | - | - | YES | NULL | æ”¯ä»˜æ—¶é—´ |
| receive_address_id | BIGINT | - | - | NO | - | æ”¶è´§åœ°å€IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| dispatch_group | VARCHAR | 50 | - | YES | NULL | åˆ†å•ç»„æ ‡è¯†ï¼ˆåŒæ‰¹æ¬¡é…é€è®¢å•ï¼‰ |
| delivery_id | BIGINT | - | - | YES | NULL | å…³è”é…é€å•IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| create_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | - | YES | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`order_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_order_sn` (`order_sn`) - è®¢å•ç¼–å·å”¯ä¸€
- **æ™®é€šç´¢å¼•**:
  - `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·è®¢å•
  - `idx_leader_id` (`leader_id`) - æŸ¥è¯¢å›¢é•¿è®¢å•
  - `idx_delivery_id` (`delivery_id`) - é…é€å•å…³è”æŸ¥è¯¢
  - `idx_dispatch_group` (`dispatch_group`) - åˆ†å•ç»„æŸ¥è¯¢
  - `idx_receive_address_id` (`receive_address_id`) - åœ°å€å…³è”æŸ¥è¯¢
  - `idx_order_status` (`order_status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_pay_status` (`pay_status`) - æŒ‰æ”¯ä»˜çŠ¶æ€ç­›é€‰

**ä¸šåŠ¡è§„åˆ™**:
1. `order_sn`æ ¼å¼ï¼š`yyyyMMddHHmmss + 6ä½éšæœºæ•°`
2. `pay_amount = total_amount - discount_amount`
3. è®¢å•çŠ¶æ€æµè½¬ï¼š0â†’1â†’2â†’3ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
4. æ”¯ä»˜è¶…æ—¶ï¼ˆ30åˆ†é’Ÿï¼‰è‡ªåŠ¨å–æ¶ˆè®¢å•
5. è·¨åº“å…³è”å­—æ®µï¼š`user_id`ã€`leader_id`ã€`receive_address_id`ã€`delivery_id`

---

#### 4.3 order_itemï¼ˆè®¢å•æ˜ç»†è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨è®¢å•å•†å“æ˜ç»†ï¼ˆå¿«ç…§è®¾è®¡ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| item_id | BIGINT | - | - | NO | AUTO_INCREMENT | è®¢å•é¡¹IDï¼ˆä¸»é”®ï¼‰ |
| order_id | BIGINT | - | - | NO | - | å…³è”è®¢å•ID |
| product_id | BIGINT | - | - | NO | - | å…³è”å•†å“IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| activity_id | BIGINT | - | - | YES | NULL | å…³è”æ‹¼å›¢æ´»åŠ¨IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| product_name | VARCHAR | 100 | - | NO | - | å•†å“åç§°ï¼ˆä¸‹å•æ—¶å¿«ç…§ï¼‰ |
| product_img | VARCHAR | 255 | - | YES | NULL | å•†å“å›¾ç‰‡ï¼ˆä¸‹å•æ—¶å¿«ç…§ï¼‰ |
| price | DECIMAL | 10 | 2 | NO | - | è´­ä¹°å•ä»·ï¼ˆæ‹¼å›¢ä»·/åŸä»·ï¼‰ |
| quantity | INT | - | - | NO | - | è´­ä¹°æ•°é‡ |
| total_price | DECIMAL | 10 | 2 | NO | - | å°è®¡é‡‘é¢ï¼ˆpriceÃ—quantityï¼‰ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`item_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_order_id` (`order_id`) - æŸ¥è¯¢è®¢å•æ‰€æœ‰å•†å“
  - `idx_product_id` (`product_id`) - å•†å“é”€é‡ç»Ÿè®¡
  - `idx_activity_id` (`activity_id`) - æ‹¼å›¢æ´»åŠ¨ç»Ÿè®¡

**å¤–é”®çº¦æŸ**:
- `fk_item_order`: `order_id` â†’ `order_main(order_id)` ON DELETE CASCADE ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. **å¿«ç…§è®¾è®¡**ï¼š`product_name`ã€`product_img`ã€`price`ä¿å­˜ä¸‹å•æ—¶çš„å•†å“ä¿¡æ¯
2. `total_price = price Ã— quantity`
3. è®¢å•çš„`total_amount = SUM(total_price)`

---

### äº”ã€payment_service_dbï¼ˆæ”¯ä»˜æœåŠ¡æ•°æ®åº“ï¼‰

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS payment_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 5.1 payment_recordï¼ˆæ”¯ä»˜è®°å½•è¡¨ï¼‰

**è¡¨è¯´æ˜**: è®°å½•æ”¯ä»˜/å……å€¼/é€€æ¬¾æ˜ç»†ï¼Œä¿éšœäº¤æ˜“å®‰å…¨

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| pay_id | BIGINT | - | - | NO | AUTO_INCREMENT | æ”¯ä»˜è®°å½•IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | - | NO | - | å…³è”ç”¨æˆ·IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| order_id | BIGINT | - | - | YES | NULL | å…³è”è®¢å•IDï¼ˆå……å€¼æ—¶ä¸ºnullï¼Œè·¨åº“å…³è”ï¼‰ |
| pay_type | TINYINT | - | - | NO | - | æ”¯ä»˜ç±»å‹ï¼ˆ1-å¾®ä¿¡ï¼›2-æ”¯ä»˜å®ï¼›3-ä½™é¢ï¼‰ |
| amount | DECIMAL | 10 | 2 | NO | - | é‡‘é¢ï¼ˆæ­£æ•°-æ”¯ä»˜/å……å€¼ï¼›è´Ÿæ•°-é€€æ¬¾ï¼‰ |
| pay_status | TINYINT | - | - | NO | 0 | çŠ¶æ€ï¼ˆ0-å¤±è´¥ï¼›1-æˆåŠŸï¼‰ |
| transaction_id | VARCHAR | 100 | - | YES | NULL | ç¬¬ä¸‰æ–¹æ”¯ä»˜æµæ°´å·ï¼ˆé€šç”¨ï¼‰ |
| wx_transaction_id | VARCHAR | 100 | - | YES | NULL | å¾®ä¿¡æ”¯ä»˜ä¸“ç”¨æµæ°´å· |
| pay_callback_info | TEXT | - | - | YES | NULL | æ”¯ä»˜å›è°ƒä¿¡æ¯ï¼ˆAESåŠ å¯†å­˜å‚¨ï¼‰ |
| encrypt_sign | VARCHAR | 255 | - | NO | - | æ•°æ®åŠ å¯†ç­¾åï¼ˆé˜²ç¯¡æ”¹ï¼ŒSHA256+ç›å€¼ï¼‰ |
| create_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`pay_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_user_id` (`user_id`) - æŸ¥è¯¢ç”¨æˆ·æ”¯ä»˜è®°å½•
  - `idx_order_id` (`order_id`) - æŸ¥è¯¢è®¢å•æ”¯ä»˜è®°å½•
  - `idx_transaction_id` (`transaction_id`) - ç¬¬ä¸‰æ–¹æµæ°´å·æŸ¥è¯¢
  - `idx_pay_status` (`pay_status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_create_time` (`create_time`) - æŒ‰æ—¶é—´æ’åº

**ä¸šåŠ¡è§„åˆ™**:
1. **å®‰å…¨è®¾è®¡**ï¼š
   - `pay_callback_info`ä½¿ç”¨AESåŠ å¯†å­˜å‚¨
   - `encrypt_sign`ä½¿ç”¨SHA256+ç›å€¼é˜²ç¯¡æ”¹
2. å……å€¼æ—¶`order_id=NULL`
3. é€€æ¬¾æ—¶`amount`ä¸ºè´Ÿæ•°
4. æ”¯ä»˜æˆåŠŸåæ›´æ–°è®¢å•çš„`pay_status=1`
5. è·¨åº“å…³è”ï¼š`user_id`ã€`order_id`

---

### å…­ã€delivery_service_dbï¼ˆé…é€æœåŠ¡æ•°æ®åº“ï¼‰âœ… å·²æ›´æ–°

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS delivery_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 6.1 deliveryï¼ˆé…é€å•è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨é…é€è·¯å¾„ä¸åˆ†å•ç»“æœï¼ˆæ”¯æ’‘åŒå¼•æ“è·¯å¾„è§„åˆ’ï¼šDijkstraç®—æ³• + é«˜å¾·åœ°å›¾APIï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| delivery_id | BIGINT | - | - | NO | AUTO_INCREMENT | é…é€å•IDï¼ˆä¸»é”®ï¼‰ |
| leader_id | BIGINT | - | - | NO | - | è´Ÿè´£å›¢é•¿IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| dispatch_group | VARCHAR | 50 | - | NO | - | å…³è”åˆ†å•ç»„ |
| start_time | DATETIME | - | - | YES | NULL | é…é€å¼€å§‹æ—¶é—´ |
| end_time | DATETIME | - | - | YES | NULL | é…é€å®Œæˆæ—¶é—´ |
| optimal_route | TEXT | - | - | NO | - | æœ€ä¼˜è·¯å¾„ï¼ˆç»çº¬åº¦åºåˆ—ï¼ŒDijkstraç®—æ³•è®¡ç®—ç»“æœï¼‰ |
| distance | DECIMAL | 10 | 2 | NO | - | æ€»é…é€è·ç¦»ï¼ˆç±³ï¼‰ |
| status | TINYINT | - | - | NO | 0 | é…é€çŠ¶æ€ï¼ˆ0-å¾…åˆ†é…ï¼›1-é…é€ä¸­ï¼›2-å·²å®Œæˆï¼‰ |
| route_strategy | TINYINT | - | - | YES | 0 | è·¯å¾„ç­–ç•¥ï¼ˆ0-æœ€çŸ­æ—¶é—´ï¼›1-æœ€çŸ­è·ç¦»ï¼›2-é¿å¼€æ‹¥å µï¼‰ |
| estimated_duration | INT | - | - | YES | NULL | é¢„ä¼°é…é€æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ |
| actual_start_time | DATETIME | - | - | YES | NULL | å®é™…å¼€å§‹é…é€æ—¶é—´ |
| route_display_data | TEXT | - | - | YES | NULL | å‰ç«¯åœ°å›¾å±•ç¤ºæ•°æ® |
| algorithm_used | VARCHAR | 20 | - | YES | 'dijkstra' | ä½¿ç”¨çš„ç®—æ³•ï¼ˆdijkstra/gaodeï¼‰ |

**å­—æ®µæ•°é‡**: 12ä¸ª

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`delivery_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_leader_id` (`leader_id`) - æŸ¥è¯¢å›¢é•¿é…é€å•
  - `idx_dispatch_group` (`dispatch_group`) - åˆ†å•ç»„æŸ¥è¯¢
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_algorithm_used` (`algorithm_used`) - æŒ‰ç®—æ³•ç±»å‹æŸ¥è¯¢
  - `idx_route_strategy` (`route_strategy`) - æŒ‰è·¯å¾„ç­–ç•¥æŸ¥è¯¢

**ä¸šåŠ¡è§„åˆ™**:
1. **åŒå¼•æ“è·¯å¾„è§„åˆ’**ï¼šä¼˜å…ˆä½¿ç”¨é«˜å¾·åœ°å›¾APIï¼Œå¤±è´¥æ—¶é™çº§åˆ°Dijkstraç®—æ³•
2. `optimal_route`æ ¼å¼ï¼š`lat1,lng1;lat2,lng2;...`ï¼ˆç®—æ³•è®¡ç®—è¾“å‡ºï¼‰
3. `distance`å•ä½ä¸ºç±³ï¼Œ`estimated_duration`å•ä½ä¸ºåˆ†é’Ÿ
4. `route_strategy`ï¼š0-æœ€çŸ­æ—¶é—´ã€1-æœ€çŸ­è·ç¦»ã€2-é¿å¼€æ‹¥å µ
5. `algorithm_used`è®°å½•å®é™…ä½¿ç”¨çš„è·¯å¾„è§„åˆ’ç®—æ³•
6. `leader_id`è·¨åº“å…³è”åˆ°`user_service_db.sys_user`

---

#### 6.2 warehouse_configï¼ˆä»“åº“é…ç½®è¡¨ï¼‰

**è¡¨è¯´æ˜**: ç®¡ç†é…é€ä»“åº“ä¿¡æ¯ï¼Œæ”¯æŒå¤šä»“åº“é…é€å’Œé»˜è®¤ä»“åº“æœºåˆ¶

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | - | NO | AUTO_INCREMENT | ä»“åº“IDï¼ˆä¸»é”®ï¼‰ |
| warehouse_name | VARCHAR | 100 | - | NO | - | ä»“åº“åç§° |
| address | VARCHAR | 255 | - | NO | - | ä»“åº“åœ°å€ |
| longitude | DECIMAL | 10 | 6 | NO | - | ä»“åº“ç»åº¦ï¼ˆè·¯å¾„è§„åˆ’èµ·ç‚¹ï¼‰ |
| latitude | DECIMAL | 10 | 6 | NO | - | ä»“åº“çº¬åº¦ï¼ˆè·¯å¾„è§„åˆ’èµ·ç‚¹ï¼‰ |
| is_default | TINYINT | - | - | NO | 0 | æ˜¯å¦é»˜è®¤ä»“åº“ï¼ˆ0-å¦ï¼›1-æ˜¯ï¼‰ |
| status | TINYINT | - | - | NO | 1 | çŠ¶æ€ï¼ˆ0-ç¦ç”¨ï¼›1-å¯ç”¨ï¼‰ |
| contact_person | VARCHAR | 50 | - | YES | NULL | è”ç³»äºº |
| contact_phone | VARCHAR | 20 | - | YES | NULL | è”ç³»ç”µè¯ |
| description | VARCHAR | 500 | - | YES | NULL | æè¿° |
| create_time | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | - | YES | NULL | æ›´æ–°æ—¶é—´ï¼ˆON UPDATE CURRENT_TIMESTAMPï¼‰ |

**å­—æ®µæ•°é‡**: 12ä¸ª

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_warehouse_name` (`warehouse_name`) - ä»“åº“åç§°å”¯ä¸€
- **æ™®é€šç´¢å¼•**:
  - `idx_is_default` (`is_default`) - æŸ¥è¯¢é»˜è®¤ä»“åº“
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰

**ä¸šåŠ¡è§„åˆ™**:
1. **é»˜è®¤ä»“åº“æœºåˆ¶**ï¼šç³»ç»Ÿåªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤ä»“åº“ï¼ˆ`is_default=1`ï¼‰
2. ä»“åº“ç»çº¬åº¦ä½œä¸ºé…é€è·¯å¾„è§„åˆ’çš„èµ·ç‚¹
3. ç¦ç”¨ä»“åº“ï¼ˆ`status=0`ï¼‰ä¸èƒ½è®¾ç½®ä¸ºé»˜è®¤ä»“åº“
4. åˆ é™¤é»˜è®¤ä»“åº“å‰éœ€å…ˆè®¾ç½®å…¶ä»–ä»“åº“ä¸ºé»˜è®¤
5. æ”¯æŒå¤šä»“åº“ç®¡ç†ï¼Œæœªæ¥å¯æ‰©å±•å°±è¿‘é…é€åŠŸèƒ½

---

### ä¸ƒã€leader_service_dbï¼ˆå›¢é•¿æœåŠ¡æ•°æ®åº“ï¼‰âœ… å·²ä¼˜åŒ–

**æ•°æ®åº“åˆ›å»ºSQL**:
```sql
CREATE DATABASE IF NOT EXISTS leader_service_db
CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

#### 7.1 communityï¼ˆç¤¾åŒºè¡¨ï¼‰

**è¡¨è¯´æ˜**: ç¤¾åŒºè¡¨ï¼ˆv3.0æ–°å¢ï¼Œå·²ä¼˜åŒ–ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| community_id | BIGINT | - | - | NO | AUTO_INCREMENT | ç¤¾åŒºIDï¼ˆä¸»é”®ï¼‰ |
| community_name | VARCHAR | 100 | - | NO | - | ç¤¾åŒºåç§° |
| province | VARCHAR | 20 | - | NO | - | çœä»½ |
| city | VARCHAR | 20 | - | NO | - | åŸå¸‚ |
| district | VARCHAR | 20 | - | NO | - | åŒº/å¿ |
| address | VARCHAR | 255 | - | NO | - | è¯¦ç»†åœ°å€ |
| latitude | DECIMAL | 10 | 6 | NO | - | ç¤¾åŒºä¸­å¿ƒçº¬åº¦ |
| longitude | DECIMAL | 10 | 6 | NO | - | ç¤¾åŒºä¸­å¿ƒç»åº¦ |
| service_radius | INT | - | - | NO | 3000 | æœåŠ¡åŠå¾„ï¼ˆå•ä½ï¼šç±³ï¼Œé»˜è®¤3000ï¼‰ |
| status | INT | - | - | NO | 1 | çŠ¶æ€ï¼ˆ0-å¾…å®¡æ ¸ï¼›1-æ­£å¸¸è¿è¥ï¼›2-å·²å…³é—­ï¼‰ |
| description | VARCHAR | 500 | - | YES | NULL | ç¤¾åŒºç®€ä»‹ |
| created_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**å­—æ®µæ•°é‡**: 13ä¸ª

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`community_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_latitude_longitude` (`latitude`, `longitude`) - ç»çº¬åº¦èŒƒå›´æŸ¥è¯¢
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_created_at` (`created_at`) - æŒ‰æ—¶é—´æ’åº

**ä¸šåŠ¡è§„åˆ™**:
1. ç¤¾åŒºç”±ç®¡ç†å‘˜åˆ›å»ºæˆ–å›¢é•¿ç”³è¯·å®¡æ ¸ååˆ›å»º
2. ç»çº¬åº¦ç”±é«˜å¾·åœ°å›¾APIåœ°ç†ç¼–ç è·å–
3. ç”¨æˆ·æ·»åŠ åœ°å€æ—¶è‡ªåŠ¨åŒ¹é…æœ€è¿‘ç¤¾åŒºï¼ˆHaversineç®—æ³•ï¼Œâ‰¤5kmï¼‰
4. `status=0`æ—¶ç¤¾åŒºå¾…å®¡æ ¸ï¼Œ`status=1`æ­£å¸¸è¿è¥ï¼Œ`status=2`å·²å…³é—­

---

#### 7.2 community_applicationï¼ˆç¤¾åŒºç”³è¯·è¡¨ï¼‰

**è¡¨è¯´æ˜**: ç¤¾åŒºç”³è¯·è¡¨ï¼ˆv3.0æ–°å¢ï¼Œå·²ä¼˜åŒ–ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| application_id | BIGINT | - | - | NO | AUTO_INCREMENT | ç”³è¯·IDï¼ˆä¸»é”®ï¼‰ |
| applicant_id | BIGINT | - | - | NO | - | ç”³è¯·äººIDï¼ˆè·¨åº“å…³è”ï¼‰ |
| applicant_name | VARCHAR | 50 | - | YES | NULL | ç”³è¯·äººå§“åï¼ˆå†—ä½™ï¼‰ |
| applicant_phone | VARCHAR | 20 | - | YES | NULL | ç”³è¯·äººæ‰‹æœºå·ï¼ˆå†—ä½™ï¼‰ |
| community_name | VARCHAR | 100 | - | NO | - | ç¤¾åŒºåç§° |
| province | VARCHAR | 20 | - | NO | - | çœä»½ |
| city | VARCHAR | 20 | - | NO | - | åŸå¸‚ |
| district | VARCHAR | 20 | - | NO | - | åŒº/å¿ |
| address | VARCHAR | 255 | - | NO | - | è¯¦ç»†åœ°å€ |
| latitude | DECIMAL | 10 | 6 | NO | - | çº¬åº¦ |
| longitude | DECIMAL | 10 | 6 | NO | - | ç»åº¦ |
| service_radius | INT | - | - | NO | 3000 | æœåŠ¡åŠå¾„ |
| description | VARCHAR | 500 | - | YES | NULL | ç¤¾åŒºç®€ä»‹ |
| application_reason | VARCHAR | 500 | - | YES | NULL | ç”³è¯·ç†ç”± |
| status | INT | - | - | NO | 0 | çŠ¶æ€ï¼ˆ0-å¾…å®¡æ ¸ï¼›1-å®¡æ ¸é€šè¿‡ï¼›2-å®¡æ ¸æ‹’ç»ï¼‰ |
| reviewer_id | BIGINT | - | - | YES | NULL | å®¡æ ¸äººIDï¼ˆè·¨åº“å…³è”ï¼‰ |
| review_comment | VARCHAR | 500 | - | YES | NULL | å®¡æ ¸æ„è§ |
| reviewed_at | DATETIME | - | - | YES | NULL | å®¡æ ¸æ—¶é—´ |
| created_community_id | BIGINT | - | - | YES | NULL | åˆ›å»ºçš„ç¤¾åŒºIDï¼ˆå®¡æ ¸é€šè¿‡åç”Ÿæˆï¼‰ |
| created_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**å­—æ®µæ•°é‡**: 21ä¸ª

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`application_id`)
- **æ™®é€šç´¢å¼•**:
  - `idx_applicant_id` (`applicant_id`) - æŸ¥è¯¢ç”³è¯·äººçš„æ‰€æœ‰ç”³è¯·
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_created_at` (`created_at`) - æŒ‰æ—¶é—´æ’åº
- **å¤–é”®ç´¢å¼•**: `fk_app_community` (`created_community_id`)

**å¤–é”®çº¦æŸ**:
- `fk_app_community`: `created_community_id` â†’ `community(community_id)` ON DELETE SET NULL ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. å›¢é•¿ç”³è¯·æ—¶å¡«å†™ç¤¾åŒºä¿¡æ¯
2. ç®¡ç†å‘˜å®¡æ ¸æ—¶è¡¥å……ç»çº¬åº¦ä¿¡æ¯
3. å®¡æ ¸é€šè¿‡åè‡ªåŠ¨åˆ›å»º`community`è®°å½•
4. å®¡æ ¸é€šè¿‡åè‡ªåŠ¨å…³è”åˆ°`group_leader_store.community_id`
5. `applicant_id`ã€`reviewer_id`è·¨åº“å…³è”åˆ°`user_service_db.sys_user`

---

#### 7.3 group_leader_storeï¼ˆå›¢é•¿å›¢ç‚¹è¡¨ï¼‰

**è¡¨è¯´æ˜**: å­˜å‚¨å›¢é•¿ä¿¡æ¯åŠå›¢ç‚¹åœ°ç†æ•°æ®ï¼Œæ”¯æŒåˆ†å•ä¸é…é€ï¼ˆå·²ä¼˜åŒ–ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| store_id | BIGINT | - | - | NO | AUTO_INCREMENT | å›¢ç‚¹IDï¼ˆä¸»é”®ï¼‰ |
| leader_id | BIGINT | - | - | NO | - | å…³è”å›¢é•¿ç”¨æˆ·IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| leader_name | VARCHAR | 50 | - | YES | NULL | å›¢é•¿å§“åï¼ˆå†—ä½™ï¼‰ |
| leader_phone | VARCHAR | 20 | - | YES | NULL | å›¢é•¿æ‰‹æœºå·ï¼ˆå†—ä½™ï¼‰ |
| community_id | BIGINT | - | - | NO | - | å½’å±ç¤¾åŒºID |
| community_name | VARCHAR | 100 | - | YES | NULL | ç¤¾åŒºåç§°ï¼ˆå†—ä½™ï¼‰ |
| store_name | VARCHAR | 100 | - | YES | NULL | å›¢ç‚¹åç§° |
| province | VARCHAR | 20 | - | YES | NULL | æ‰€åœ¨çœä»½ |
| city | VARCHAR | 20 | - | YES | NULL | æ‰€åœ¨åŸå¸‚ |
| district | VARCHAR | 20 | - | YES | NULL | æ‰€åœ¨åŒº/å¿ |
| address | VARCHAR | 255 | - | YES | NULL | å›¢ç‚¹åœ°å€ |
| detail_address | VARCHAR | 255 | - | YES | NULL | è¯¦ç»†åœ°å€ |
| longitude | DECIMAL | 10 | 6 | YES | NULL | å›¢ç‚¹ç»åº¦ï¼ˆè·¯å¾„è®¡ç®—èµ·ç‚¹ï¼‰ |
| latitude | DECIMAL | 10 | 6 | YES | NULL | å›¢ç‚¹çº¬åº¦ï¼ˆè·¯å¾„è®¡ç®—èµ·ç‚¹ï¼‰ |
| max_delivery_range | INT | - | - | NO | 3000 | æœ€å¤§é…é€èŒƒå›´ï¼ˆç±³ï¼‰ |
| description | VARCHAR | 500 | - | YES | NULL | å›¢ç‚¹ç®€ä»‹ |
| commission_rate | DECIMAL | 5 | 2 | NO | 10.00 | ä½£é‡‘æ¯”ä¾‹ï¼ˆ%ï¼‰ |
| total_commission | DECIMAL | 10 | 2 | NO | 0.00 | ç´¯è®¡ä½£é‡‘ |
| status | INT | - | - | NO | 0 | çŠ¶æ€ï¼ˆ0-å¾…å®¡æ ¸ï¼›1-æ­£å¸¸è¿è¥ï¼›2-å·²åœç”¨ï¼‰ |
| reviewer_id | BIGINT | - | - | YES | NULL | å®¡æ ¸äººIDï¼ˆè·¨åº“å…³è”ï¼‰ |
| review_comment | VARCHAR | 500 | - | YES | NULL | å®¡æ ¸æ„è§ |
| reviewed_at | DATETIME | - | - | YES | NULL | å®¡æ ¸æ—¶é—´ |
| created_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**å­—æ®µæ•°é‡**: 24ä¸ª

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`store_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_leader_id` (`leader_id`) - ä¸€ä¸ªå›¢é•¿åªèƒ½æœ‰ä¸€ä¸ªå›¢ç‚¹
- **æ™®é€šç´¢å¼•**:
  - `idx_community_id` (`community_id`) - æŸ¥è¯¢ç¤¾åŒºå†…çš„å›¢é•¿
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_created_at` (`created_at`) - æŒ‰æ—¶é—´æ’åº

**å¤–é”®çº¦æŸ**:
- `fk_store_community`: `community_id` â†’ `community(community_id)` ON DELETE RESTRICT ON UPDATE CASCADE

**ä¸šåŠ¡è§„åˆ™**:
1. ç”¨æˆ·ç”³è¯·æˆä¸ºå›¢é•¿åï¼Œç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ï¼ˆ`status=1`ï¼‰æ‰èƒ½å¼€å±•ä¸šåŠ¡
2. `max_delivery_range`å®šä¹‰å›¢ç‚¹æœåŠ¡èŒƒå›´ï¼Œç”¨äºè®¢å•åˆ†å•
3. `commission_rate`ä¸ºå›¢é•¿ä½£é‡‘æ¯”ä¾‹ï¼ŒèŒƒå›´0-100
4. ç»çº¬åº¦ç”±é«˜å¾·åœ°å›¾APIè·å–
5. `leader_id`ã€`reviewer_id`è·¨åº“å…³è”åˆ°`user_service_db.sys_user`
6. **å¤–é”®ç­–ç•¥**ï¼š`community_id` ä½¿ç”¨ RESTRICTï¼Œé˜²æ­¢åˆ é™¤æœ‰å›¢ç‚¹çš„ç¤¾åŒº

---

#### 7.4 commission_recordï¼ˆä½£é‡‘è®°å½•è¡¨ï¼‰

**è¡¨è¯´æ˜**: è®°å½•å›¢é•¿ä½£é‡‘è®¡ç®—ä¸ç»“ç®—æ˜ç»†ï¼ˆå·²ä¼˜åŒ–ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å°æ•°ä½ | ç©ºå€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|--------|------|
| commission_id | BIGINT | - | - | NO | AUTO_INCREMENT | ä½£é‡‘IDï¼ˆä¸»é”®ï¼‰ |
| leader_id | BIGINT | - | - | NO | - | å…³è”å›¢é•¿IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| leader_name | VARCHAR | 50 | - | YES | NULL | å›¢é•¿å§“åï¼ˆå†—ä½™ï¼‰ |
| order_id | BIGINT | - | - | NO | - | å…³è”è®¢å•IDï¼ˆè·¨åº“å…³è”ï¼‰ |
| order_amount | DECIMAL | 10 | 2 | NO | - | è®¢å•é‡‘é¢ |
| commission_rate | DECIMAL | 5 | 2 | NO | - | ä½£é‡‘æ¯”ä¾‹ |
| commission_amount | DECIMAL | 10 | 2 | NO | - | ä½£é‡‘é‡‘é¢ |
| status | INT | - | - | NO | 0 | çŠ¶æ€ï¼ˆ0-å¾…ç»“ç®—ï¼›1-å·²ç»“ç®—ï¼›2-ç»“ç®—å¤±è´¥ï¼‰ |
| settled_at | DATETIME | - | - | YES | NULL | ç»“ç®—æ—¶é—´ |
| settlement_batch | VARCHAR | 20 | - | YES | NULL | ç»“ç®—æ‰¹æ¬¡å·ï¼ˆæ ¼å¼ï¼šYYYYMMDDï¼‰ |
| remark | VARCHAR | 255 | - | YES | NULL | å¤‡æ³¨ |
| created_at | DATETIME | - | - | NO | CURRENT_TIMESTAMP | ç”Ÿæˆæ—¶é—´ï¼ˆè®¢å•å®Œæˆåï¼‰ |

**å­—æ®µæ•°é‡**: 12ä¸ªï¼ˆæ³¨æ„ï¼šä½£é‡‘è®°å½•ä¸éœ€è¦ `updated_at`ï¼‰

**ç´¢å¼•è®¾è®¡**:
- **ä¸»é”®**: PRIMARY KEY (`commission_id`)
- **å”¯ä¸€ç´¢å¼•**: `uk_order_id` (`order_id`) - ä¸€ä¸ªè®¢å•åªç”Ÿæˆä¸€æ¡ä½£é‡‘è®°å½•
- **æ™®é€šç´¢å¼•**:
  - `idx_leader_id` (`leader_id`) - æŸ¥è¯¢å›¢é•¿ä½£é‡‘
  - `idx_status` (`status`) - æŒ‰çŠ¶æ€ç­›é€‰
  - `idx_created_at` (`created_at`) - æŒ‰æ—¶é—´æ’åº

**ä¸šåŠ¡è§„åˆ™**:
1. è®¢å•é…é€å®Œæˆï¼ˆ`order_status=3`ï¼‰åè‡ªåŠ¨ç”Ÿæˆä½£é‡‘è®°å½•
2. `commission_amount = order_amount Ã— commission_rate / 100`
3. æ¯æœˆ1å·æ‰¹é‡ç»“ç®—ï¼š`status=1`ï¼Œé‡‘é¢è½¬å…¥å›¢é•¿è´¦æˆ·
4. `leader_id`ã€`order_id`è·¨åº“å…³è”ï¼Œåº”ç”¨å±‚æ ¡éªŒ
5. **æ³¨æ„**ï¼šä½£é‡‘è®°å½•åªåˆ›å»ºä¸€æ¬¡ä¸ä¿®æ”¹ï¼Œå› æ­¤æ²¡æœ‰ `updated_at` å­—æ®µ

---

## è·¨åº“å…³è”ç­–ç•¥

### è·¨åº“å…³è”æ±‡æ€»ï¼ˆ22ä¸ªï¼‰

| åºå· | å­è¡¨ï¼ˆæ•°æ®åº“ï¼‰ | å­è¡¨å­—æ®µ | çˆ¶è¡¨ï¼ˆæ•°æ®åº“ï¼‰ | çˆ¶è¡¨å­—æ®µ | å¤„ç†ç­–ç•¥ |
|------|--------------|---------|--------------|---------|---------|
| 1 | sys_user (user_service_db) | community_id | community (leader_service_db) | community_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 2 | group_buy (groupbuy_service_db) | product_id | product (product_service_db) | product_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 3 | group_buy_team (groupbuy_service_db) | launcher_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 4 | group_buy_team (groupbuy_service_db) | leader_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 5 | group_buy_team (groupbuy_service_db) | community_id | community (leader_service_db) | community_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 6 | group_buy_member (groupbuy_service_db) | user_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 7 | group_buy_member (groupbuy_service_db) | order_id | order_main (order_service_db) | order_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 8 | shopping_cart (order_service_db) | user_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 9 | shopping_cart (order_service_db) | product_id | product (product_service_db) | product_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 10 | shopping_cart (order_service_db) | activity_id | group_buy (groupbuy_service_db) | activity_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 11 | order_main (order_service_db) | user_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 12 | order_main (order_service_db) | leader_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 13 | order_main (order_service_db) | receive_address_id | user_address (user_service_db) | address_id | å¿«ç…§è®¾è®¡ï¼ˆå†—ä½™åœ°å€ï¼‰ |
| 14 | order_main (order_service_db) | delivery_id | delivery (delivery_service_db) | delivery_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 15 | order_item (order_service_db) | product_id | product (product_service_db) | product_id | å¿«ç…§è®¾è®¡ï¼ˆå†—ä½™å•†å“åç§°/å›¾ç‰‡/ä»·æ ¼ï¼‰ |
| 16 | order_item (order_service_db) | activity_id | group_buy (groupbuy_service_db) | activity_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 17 | payment_record (payment_service_db) | user_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 18 | payment_record (payment_service_db) | order_id | order_main (order_service_db) | order_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 19 | delivery (delivery_service_db) | leader_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 20 | community_application (leader_service_db) | applicant_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 21 | group_leader_store (leader_service_db) | leader_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |
| 22 | commission_record (leader_service_db) | leader_id | sys_user (user_service_db) | user_id | æœåŠ¡è°ƒç”¨éªŒè¯ |

### å¤„ç†ç­–ç•¥è¯´æ˜

#### 1. æœåŠ¡è°ƒç”¨éªŒè¯
- åˆ›å»ºæ•°æ®å‰è°ƒç”¨å…³è”æœåŠ¡APIéªŒè¯IDæœ‰æ•ˆæ€§
- ä½¿ç”¨OpenFeignå£°æ˜å¼å®¢æˆ·ç«¯
- ç¤ºä¾‹ï¼šåˆ›å»ºè®¢å•å‰è°ƒç”¨UserServiceéªŒè¯ç”¨æˆ·å­˜åœ¨

#### 2. å¿«ç…§è®¾è®¡
- å†—ä½™å…³è”æ•°æ®ï¼Œé¿å…é¢‘ç¹è·¨æœåŠ¡è°ƒç”¨
- ç¤ºä¾‹ï¼š`order_item`ä¿å­˜`product_name`ã€`product_img`ã€`price`

#### 3. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- å®šæœŸæ‰§è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬
- å‘ç°å¹¶ä¿®å¤å­¤ç«‹æ•°æ®

---

## ç´¢å¼•è®¾è®¡æ±‡æ€»

### ä¸»é”®ç´¢å¼•ï¼ˆ19ä¸ªï¼‰

æ‰€æœ‰è¡¨çš„ä¸»é”®ç´¢å¼•ï¼š
- user_service_db: 5ä¸ªä¸»é”®
- product_service_db: 2ä¸ªä¸»é”®
- groupbuy_service_db: 3ä¸ªä¸»é”®
- order_service_db: 3ä¸ªä¸»é”®
- payment_service_db: 1ä¸ªä¸»é”®
- delivery_service_db: 1ä¸ªä¸»é”®
- leader_service_db: 4ä¸ªä¸»é”®

### å”¯ä¸€ç´¢å¼•ï¼ˆ11ä¸ªï¼‰

| è¡¨å | å”¯ä¸€ç´¢å¼• | å­—æ®µ | ç”¨é€” |
|------|----------|------|------|
| sys_user | uk_username | username | è´¦å·å”¯ä¸€ |
| sys_user | uk_phone | phone | æ‰‹æœºå·å”¯ä¸€ |
| sys_user | uk_wx_openid | wx_openid | å¾®ä¿¡OpenIDå”¯ä¸€ |
| user_account | uk_user_id | user_id | ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ªè´¦æˆ· |
| group_buy | uk_link | link | æ‹¼å›¢é“¾æ¥å”¯ä¸€ |
| group_buy_team | uk_team_no | team_no | å›¢å·å”¯ä¸€ |
| group_buy_member | uk_team_user | team_id, user_id | ä¸€ä¸ªç”¨æˆ·ä¸èƒ½é‡å¤å‚åŠ åŒä¸€ä¸ªå›¢ |
| shopping_cart | uk_user_product_activity | user_id, product_id, activity_id | é˜²æ­¢é‡å¤æ·»åŠ  |
| order_main | uk_order_sn | order_sn | è®¢å•ç¼–å·å”¯ä¸€ |
| commission_record | uk_order_id | order_id | ä¸€ä¸ªè®¢å•åªç”Ÿæˆä¸€æ¡ä½£é‡‘è®°å½• |
| group_leader_store | uk_leader_id | leader_id | ä¸€ä¸ªå›¢é•¿åªèƒ½æœ‰ä¸€ä¸ªå›¢ç‚¹ |

### æ™®é€šç´¢å¼•ï¼ˆ60ä¸ª+ï¼‰

è¯¦è§å„è¡¨çš„ç´¢å¼•è®¾è®¡éƒ¨åˆ†ã€‚

---

## æ•°æ®å­—å…¸

### æšä¸¾å€¼å®šä¹‰

#### sys_user.roleï¼ˆç”¨æˆ·è§’è‰²ï¼‰
| å€¼ | è¯´æ˜ | æƒé™ |
|----|------|------|
| 1 | æ™®é€šç”¨æˆ· | æµè§ˆå•†å“ã€ä¸‹å•æ”¯ä»˜ã€ç”³è¯·å›¢é•¿ |
| 2 | å›¢é•¿ | æ™®é€šç”¨æˆ·æƒé™ + ç®¡ç†å›¢å‘˜ã€å¤„ç†è®¢å•ã€é…é€ç®¡ç† |
| 3 | ç³»ç»Ÿç®¡ç†å‘˜ | æ‰€æœ‰æƒé™ï¼ˆå•†å“ç®¡ç†ã€å›¢é•¿å®¡æ ¸ã€æ•°æ®ç»Ÿè®¡ï¼‰ |

#### sys_user.status / product.status / product_category.status
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | ç¦ç”¨/ä¸‹æ¶ |
| 1 | æ­£å¸¸/ä¸Šæ¶ |

#### user_feedback.typeï¼ˆåé¦ˆç±»å‹ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 1 | åŠŸèƒ½é—®é¢˜ |
| 2 | å•†å“é—®é¢˜ |
| 3 | é…é€é—®é¢˜ |
| 4 | æ”¯ä»˜é—®é¢˜ |
| 5 | å…¶ä»– |

#### user_feedback.statusï¼ˆå¤„ç†çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | å¾…å¤„ç† |
| 1 | å¤„ç†ä¸­ |
| 2 | å·²è§£å†³ |
| 3 | å·²å…³é—­ |

#### group_buy.statusï¼ˆæ´»åŠ¨çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | æœªå¼€å§‹ |
| 1 | è¿›è¡Œä¸­ |
| 2 | å·²ç»“æŸ |
| 3 | å¼‚å¸¸ |

#### group_buy_team.team_statusï¼ˆå›¢çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | æ‹¼å›¢ä¸­ |
| 1 | å·²æˆå›¢ |
| 2 | å·²å¤±è´¥ |

#### group_buy_member.statusï¼ˆå‚å›¢çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | å¾…æ”¯ä»˜ |
| 1 | å·²æ”¯ä»˜ |
| 2 | å·²æˆå›¢ |
| 3 | å·²å–æ¶ˆ |

#### order_main.order_statusï¼ˆè®¢å•çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ | å¯æ“ä½œ |
|----|------|--------|
| 0 | å¾…æ”¯ä»˜ | æ”¯ä»˜ã€å–æ¶ˆ |
| 1 | å¾…å‘è´§ | å‘è´§ã€é€€æ¬¾ |
| 2 | é…é€ä¸­ | å®Œæˆé…é€ |
| 3 | å·²é€è¾¾ | æ—  |
| 4 | å·²å–æ¶ˆ | æ—  |
| 5 | é€€æ¬¾ä¸­ | æ—  |
| 6 | å·²é€€æ¬¾ | æ—  |

#### order_main.pay_statusï¼ˆæ”¯ä»˜çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | æœªæ”¯ä»˜ |
| 1 | å·²æ”¯ä»˜ |

#### payment_record.pay_typeï¼ˆæ”¯ä»˜ç±»å‹ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 1 | å¾®ä¿¡æ”¯ä»˜ |
| 2 | æ”¯ä»˜å®æ”¯ä»˜ |
| 3 | ä½™é¢æ”¯ä»˜ |

#### payment_record.pay_status / commission_record.status
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | å¤±è´¥/å¾…ç»“ç®— |
| 1 | æˆåŠŸ/å·²ç»“ç®— |
| 2 | ç»“ç®—å¤±è´¥ï¼ˆä»…commission_recordï¼‰ |

#### delivery.statusï¼ˆé…é€çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | å¾…åˆ†é… |
| 1 | é…é€ä¸­ |
| 2 | å·²å®Œæˆ |

#### community.statusï¼ˆç¤¾åŒºçŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | å¾…å®¡æ ¸ |
| 1 | æ­£å¸¸è¿è¥ |
| 2 | å·²å…³é—­ |

#### group_leader_store.statusï¼ˆå›¢é•¿çŠ¶æ€ï¼‰
| å€¼ | è¯´æ˜ |
|----|------|
| 0 | å¾…å®¡æ ¸ |
| 1 | æ­£å¸¸è¿è¥ |
| 2 | å·²åœç”¨ |

---

## SQLè„šæœ¬è¯´æ˜

### è„šæœ¬æ–‡ä»¶åˆ—è¡¨

```
community-group-buy-backend/sql/
â”œâ”€â”€ user_service_db.sql       (174è¡Œ, 5å¼ è¡¨)
â”œâ”€â”€ product_service_db.sql    (67è¡Œ, 2å¼ è¡¨)
â”œâ”€â”€ groupbuy_service_db.sql   (107è¡Œ, 3å¼ è¡¨)
â”œâ”€â”€ order_service_db.sql      (104è¡Œ, 3å¼ è¡¨)
â”œâ”€â”€ payment_service_db.sql    (49è¡Œ, 1å¼ è¡¨)
â”œâ”€â”€ delivery_service_db.sql   (44è¡Œ, 1å¼ è¡¨)
â””â”€â”€ leader_service_db.sql     (158è¡Œ, 4å¼ è¡¨) âœ… å·²ä¼˜åŒ–
```

### æ‰§è¡Œé¡ºåº

1. **user_service_db.sql** - ç”¨æˆ·æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰
2. **product_service_db.sql** - å•†å“æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰
3. **leader_service_db.sql** - å›¢é•¿æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰âœ… å·²ä¼˜åŒ–
4. **groupbuy_service_db.sql** - æ‹¼å›¢æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰
5. **order_service_db.sql** - è®¢å•æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰
6. **payment_service_db.sql** - æ”¯ä»˜æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰
7. **delivery_service_db.sql** - é…é€æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰

**è¯´æ˜**: ç”±äºå¾®æœåŠ¡æ¶æ„ï¼Œå„æ•°æ®åº“ç‹¬ç«‹ï¼Œæ‰§è¡Œé¡ºåºå¯ä»»æ„ã€‚

### æ‰§è¡Œæ–¹æ³•

#### æ–¹æ³•1ï¼šé€ä¸ªæ‰§è¡Œ
```bash
mysql -u root -p < user_service_db.sql
mysql -u root -p < product_service_db.sql
mysql -u root -p < groupbuy_service_db.sql
mysql -u root -p < order_service_db.sql
mysql -u root -p < payment_service_db.sql
mysql -u root -p < delivery_service_db.sql
mysql -u root -p < leader_service_db.sql
```

#### æ–¹æ³•2ï¼šæ‰¹é‡æ‰§è¡Œï¼ˆæ¨èï¼‰
åˆ›å»ºæ‰¹å¤„ç†è„šæœ¬ `execute_all.bat`ï¼ˆWindowsï¼‰:
```bat
@echo off
mysql -u root -p < user_service_db.sql
mysql -u root -p < product_service_db.sql
mysql -u root -p < groupbuy_service_db.sql
mysql -u root -p < order_service_db.sql
mysql -u root -p < payment_service_db.sql
mysql -u root -p < delivery_service_db.sql
mysql -u root -p < leader_service_db.sql
echo All databases created successfully!
pause
```

---

## æ•°æ®åº“ä¼˜åŒ–å»ºè®®

### 1. ç´¢å¼•ä¼˜åŒ–
- âœ… é«˜é¢‘æŸ¥è¯¢å­—æ®µå·²æ·»åŠ ç´¢å¼•
- âœ… leader_service_db é‡å¤ç´¢å¼•å·²æ¸…ç†
- å»ºè®®ï¼šå®šæœŸä½¿ç”¨`EXPLAIN`åˆ†ææ…¢æŸ¥è¯¢

### 2. å­—æ®µå‘½åä¼˜åŒ–
- âœ… leader_service_db å­—æ®µå‘½åå·²ç»Ÿä¸€
- âœ… æ—¶é—´å­—æ®µç»Ÿä¸€ä½¿ç”¨ `created_at`ã€`updated_at`
- å…¶ä»–æœåŠ¡ä¿æŒä¸€è‡´æ€§

### 3. æ•°æ®å½’æ¡£
- å»ºè®®ï¼šå½’æ¡£1å¹´å‰çš„è®¢å•æ•°æ®ã€æ—¥å¿—æ•°æ®
- å»ºè®®ï¼šå®šæœŸæ¸…ç†è¿‡æœŸè´­ç‰©è½¦æ•°æ®

### 4. æ€§èƒ½ç›‘æ§
- å»ºè®®ï¼šå¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
- å»ºè®®ï¼šå®šæœŸåˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆ`ANALYZE TABLE`ï¼‰
- å»ºè®®ï¼šç›‘æ§æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨æƒ…å†µ

---

## æ›´æ–°å†å²

### v6.0 (2025-10-30) - ä¼˜åŒ–æ¸…ç†ç‰ˆ âœ…
- âœ… éªŒè¯æ‰€æœ‰7ä¸ªSQLæ–‡ä»¶ä¸æ–‡æ¡£ä¸€è‡´
- âœ… leader_service_db å·²æ¸…ç†æ‰€æœ‰é‡å¤å­—æ®µå’Œç´¢å¼•
- âœ… å¤–é”®çº¦æŸå·²ä¿®å¤ï¼ˆgroup_leader_store ä½¿ç”¨ RESTRICTï¼‰
- âœ… å­—æ®µå‘½åå·²ç»Ÿä¸€ï¼ˆcreated_atã€updated_atã€reviewed_atã€settled_atï¼‰
- âœ… ç§»é™¤æ‰€æœ‰"å¾…æ¸…ç†"æ ‡æ³¨
- âœ… æ›´æ–°å­—æ®µç»Ÿè®¡å’Œç´¢å¼•ç»Ÿè®¡
- âœ… æ–‡æ¡£ä¸å®é™…ä»£ç 100%ä¸€è‡´

### v6.1 (2025-11-07) - æ·»åŠ å•†å“æ•°é‡å­—æ®µ
- âœ… æ·»åŠ `product_quantity`å­—æ®µåˆ°`group_buy_member`è¡¨
- âœ… æä¾›æ•°æ®åº“è¿ç§»è„šæœ¬ï¼Œæ”¯æŒç°æœ‰æ•°æ®å…¼å®¹
- âœ… æ›´æ–°ä¸šåŠ¡è§„åˆ™å’Œå­—æ®µè¯´æ˜
- âœ… ä¼˜åŒ–å‚å›¢è®°å½•çš„æ•°æ®å®Œæ•´æ€§

### v6.0 (2025-10-30) - ä¼˜åŒ–æ¸…ç†ç‰ˆ âœ…
- âœ… éªŒè¯æ‰€æœ‰7ä¸ªSQLæ–‡ä»¶ä¸æ–‡æ¡£ä¸€è‡´
- âœ… leader_service_db å·²æ¸…ç†æ‰€æœ‰é‡å¤å­—æ®µå’Œç´¢å¼•
- âœ… å¤–é”®çº¦æŸå·²ä¿®å¤ï¼ˆgroup_leader_store ä½¿ç”¨ RESTRICTï¼‰
- âœ… å­—æ®µå‘½åå·²ç»Ÿä¸€ï¼ˆcreated_atã€updated_atã€reviewed_atã€settled_atï¼‰
- âœ… ç§»é™¤æ‰€æœ‰"å¾…æ¸…ç†"æ ‡æ³¨
- âœ… æ›´æ–°å­—æ®µç»Ÿè®¡å’Œç´¢å¼•ç»Ÿè®¡
- âœ… æ–‡æ¡£ä¸å®é™…ä»£ç 100%ä¸€è‡´

### v5.0 (2025-10-30) - åŸºäºå®é™…SQLç”Ÿæˆ
- âœ… æ ¹æ®7ä¸ªSQLæ–‡ä»¶ç”Ÿæˆå®Œæ•´æ–‡æ¡£
- âœ… è¯¦ç»†è¯´æ˜è·¨åº“å…³è”ç­–ç•¥
- âœ… å®Œæ•´çš„ç´¢å¼•è®¾è®¡æ±‡æ€»
- âœ… å®Œæ•´çš„æ•°æ®å­—å…¸
- âš ï¸ å‘ç°å­—æ®µé‡å¤ã€ç´¢å¼•é‡å¤ç­‰é—®é¢˜

---

## leader_service_db ä¼˜åŒ–æ€»ç»“

### ä¼˜åŒ–å‰åå¯¹æ¯”

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| community è¡¨å­—æ®µ | 15ä¸ª | 13ä¸ª | åˆ é™¤2ä¸ªé‡å¤å­—æ®µ |
| community è¡¨ç´¢å¼• | 6ä¸ª | 4ä¸ª | åˆ é™¤2ä¸ªé‡å¤ç´¢å¼• |
| community_application è¡¨å­—æ®µ | 25ä¸ª | 21ä¸ª | åˆ é™¤4ä¸ªé‡å¤å­—æ®µ |
| community_application è¡¨ç´¢å¼• | 8ä¸ª | 4ä¸ª | åˆ é™¤4ä¸ªé‡å¤ç´¢å¼• |
| group_leader_store è¡¨å­—æ®µ | 26ä¸ª | 24ä¸ª | åˆ é™¤2ä¸ªé‡å¤å­—æ®µ |
| group_leader_store è¡¨ç´¢å¼• | 7ä¸ª | 5ä¸ª | åˆ é™¤2ä¸ªé‡å¤ç´¢å¼• |
| commission_record è¡¨å­—æ®µ | 15ä¸ª | 12ä¸ª | åˆ é™¤3ä¸ªé‡å¤å­—æ®µ |
| commission_record è¡¨ç´¢å¼• | 5ä¸ª | 5ä¸ª | ç´¢å¼•å·²è§„èŒƒ |

### ä¼˜åŒ–å†…å®¹

1. **åˆ é™¤é‡å¤å­—æ®µ**ï¼š
   - community: åˆ é™¤ `name`ã€`create_time`
   - community_application: åˆ é™¤ `create_time`ã€`audit_time`ã€`auditor_id`ã€`approved_community_id`
   - group_leader_store: åˆ é™¤ `audit_time`ã€`audit_status`
   - commission_record: åˆ é™¤ `create_time`ã€`amount`ã€`settle_time`

2. **åˆ é™¤é‡å¤ç´¢å¼•**ï¼š
   - åˆ é™¤æ‰€æœ‰ `idx_xxx_created_at` é‡å¤ç´¢å¼•
   - ç»Ÿä¸€ä½¿ç”¨ `idx_created_at`

3. **ä¿®å¤å¤–é”®çº¦æŸ**ï¼š
   - group_leader_store å¤–é”®ç”± `ON DELETE SET NULL` æ”¹ä¸º `ON DELETE RESTRICT`
   - é˜²æ­¢è¯¯åˆ é™¤æœ‰å›¢ç‚¹çš„ç¤¾åŒº

---

**æ–‡æ¡£ç‰ˆæœ¬**: v6.1ï¼ˆæ·»åŠ å•†å“æ•°é‡å­—æ®µï¼‰  
**ç”Ÿæˆæ—¥æœŸ**: 2025-11-07  
**ç»´æŠ¤äºº**: è€¿åº·ç‘  
**é¡¹ç›®è·¯å¾„**: E:\E\BYSJ\community-group-buy-backend\sql\  
**æ•°æ®åº“æ€»æ•°**: 7ä¸ª  
**è¡¨æ€»æ•°**: 19å¼   
**SQLæ€»è¡Œæ•°**: 736è¡Œï¼ˆ+33è¡Œè¿ç§»è„šæœ¬ï¼‰  
**ä¼˜åŒ–çŠ¶æ€**: âœ… leader_service_db å·²ä¼˜åŒ–ï¼Œgroup_buy_memberè¡¨å·²æ‰©å±•

