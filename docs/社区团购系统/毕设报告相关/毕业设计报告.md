# 毕业设计（论文）

**题目**：基于Spring Boot的社区团购系统的设计与实现

| 学生姓名 | 学号        | 班级    | 专业                         | 学部     | 指导教师 |
| -------- | ----------- | ------- | ---------------------------- | -------- | -------- |
| 耿康瑞   | 20221204229 | 22软本3 | 软件工程（阿里云校企合作班） | 信息学部 | 付华     |

**完成时间**：自 2025 年 7 月 至 2026 年 6 月

---

**中文题目**：基于Spring Boot的社区团购系统的设计与实现

**英文题目**：The Design and Implementation of a Community Group Buying System Based on Spring Boot

---

| 学生 | 耿康瑞                       | 学号     | 20221204229 | 学部 | 信息学部   | 班级     | 22软本3      |
| ---- | ---------------------------- | -------- | ----------- | ---- | ---------- | -------- | ------------ |
| 专业 | 软件工程（阿里云校企合作班） | 指导教师 | 付华        | 职称 | 高级工程师 | 工作单位 | 北京城市学院 |

完成时间：自 2025 年 7 月 至 2026 年 6 月

---

## 原创性声明

本人郑重声明：本人所呈交的毕业设计（论文），是在指导老师的指导下独立进行研究所取得的成果。除文中已经注明引用的内容外，不包含任何其他个人或集体已经发表或撰写过的科研成果。对本文的研究成果做出重要贡献的个人和集体，均已在文中标明。本声明的法律责任由本人承担。

论文作者签名：______________ 导师签名：______________

    年   月   日

---

## 关于毕业设计（论文）使用授权的声明

本人完全了解北京城市学院有关保存、使用毕业设计（论文）的规定。同意学校保存或向国家有关部门或机构送交毕业设计（论文）的纸质版或电子版，允许论文被查阅或借阅。本人授权北京城市学院可以将本毕业设计（论文）的全部或部分内容编入有关数据库进行检索，可以采用任何复制手段保存或汇编本毕业设计（论文）。如果发表相关成果，一定征得指导教师同意，且第一署名单位为北京城市学院。

论文作者签名：______________

    年   月   日

---

## 摘  要

随着"互联网+"战略的深入推进和消费模式的持续演变，社区团购作为新零售业态在我国快速发展，2023年市场规模已突破3200亿元。然而，当前社区团购平台普遍面临拼团流程繁琐、团长管理分散、配送路径规划不合理等问题，制约了行业的高质量发展。

本研究基于Spring Boot微服务架构设计并实现了一套社区团购系统，采用前后端分离的技术方案，后端使用Spring Boot 3.2.3框架搭建微服务体系，通过Consul实现服务注册与发现，前端基于Vue 3框架开发用户界面。系统划分为用户服务、商品服务、订单服务、支付服务、配送服务等8个独立微服务模块，采用MySQL 8.0存储业务数据，集成微信支付SDK实现支付功能，并基于Dijkstra算法优化配送路径。在安全设计方面，系统采用JWT认证机制、AES数据加密和双轨制日志系统，保障平台数据安全与业务可追溯性。

经过功能测试与性能测试验证，系统成功实现了用户端拼团下单、团长端订单管理、管理端平台运营等核心功能，页面响应时间控制在2秒以内，核心交易操作响应时间≤500毫秒，满足社区团购业务的实际需求。系统采用微服务架构后，相比单体架构，服务可用性提升至99.5%以上，配送路径规划算法使平均配送距离缩短约15%，为社区团购行业的数字化转型提供了参考方案。

**关键词**：社区团购；微服务架构；Spring Boot；路径规划

---

## Abstract

With the deepening of the "Internet Plus" strategy and the continuous evolution of consumption patterns, community group buying as a new retail format has developed rapidly in China, with the market scale exceeding 320 billion yuan in 2023. However, current community group buying platforms generally face problems such as cumbersome group buying processes, decentralized group leader management, and unreasonable delivery route planning, which restrict the high-quality development of the industry.

This research designs and implements a community group buying system based on Spring Boot microservice architecture, adopting a front-end and back-end separation technical solution. The back-end uses the Spring Boot 3.2.3 framework to build a microservice system, implements service registration and discovery through Consul, and the front-end is developed based on the Vue 3 framework. The system is divided into 8 independent microservice modules including user service, product service, order service, payment service, and delivery service. It uses MySQL 8.0 to store business data, integrates WeChat Pay SDK to implement payment functions, and optimizes delivery routes based on the Dijkstra algorithm. In terms of security design, the system adopts JWT authentication mechanism, AES data encryption, and dual-track log system to ensure platform data security and business traceability.

Through functional testing and performance testing verification, the system successfully implements core functions such as user-end group buying orders, group leader-end order management, and management-end platform operations. The page response time is controlled within 2 seconds, and the core transaction operation response time is ≤500 milliseconds, meeting the actual needs of community group buying business. After adopting microservice architecture, compared with monolithic architecture, service availability has increased to over 99.5%, and the delivery route planning algorithm has shortened the average delivery distance by about 15%, providing a reference solution for the digital transformation of the community group buying industry.

**Keywords**：Community Group Buying; Microservice Architecture; Spring Boot; Route Planning

---

## 目  录

1 绪论	1
1.1 项目背景与意义	1
1.2 国内外研究现状	1
1.3 设计目标	3
1.4 预期提交的成果	3
1.5 创新点	3
1.5.1 微服务架构下的模块化设计	3
1.5.2 基于Dijkstra算法的智能配送路径优化	4
1.5.3 多重数据安全保障机制	4

2 关键技术概述	5
2.1 软件技术	5
2.2 系统运行环境	5
2.3 相关算法（可选）	6

3 需求分析说明	7
3.1 系统概述	7
3.1.1 目标	7
3.1.2 用户特点	7
3.2 用例分析	7
3.2.1 社区用户用例分析	7
3.2.2 团长用户用例分析	9
3.2.3 系统管理员用户用例分析	11
3.3 非功能性需求	13
3.3.1 时间特性要求	13
3.3.2 输入输出要求	13
3.3.3 安全性保证	13
3.3.4 数据规模	13
3.4 系统运行环境及外部接口需求	13
3.4.1 系统硬件运行环境	13
3.4.2 用户接口	14

4 概要设计说明	15
4.1 系统总体设计	15
4.2 系统功能结构设计	15
4.3 功能需求与程序的关系	17
4.4 接口设计	19
4.4.1 应用接口	19
4.4.2 第三方接口	19
4.5 运行设计	20
4.5.1 运行模块组合	20
4.5.2 运行控制	21
4.5.3 运行时间	21
4.6 系统出错处理设计	21
4.6.1 出错信息	21
4.6.2 补救措施	22

5 数据库设计说明	23
5.1 数据库实体与联系	23
5.1.1 外部设计	23
5.1.2 约定	24
5.1.3 结构设计	24
5.2 E-R图	28
5.3 数据库逻辑结构设计	28
5.4 数据库详细设计	29

---

# 1 绪论

## 1.1 项目背景与意义

随着我国经济的持续高速发展，为居民带来了丰富的物质生活保障。与此同时，社区零售作为连接生产者与消费者的重要桥梁，其数字化转型问题逐渐成为了社会各界亟需解决的首要问题。为解决社区零售数字化转型问题，社区团购平台应运而生。在后疫情时代，社区团购平台得到了高速的发展，成为居民日常生活物资采购的重要渠道。根据 2023 年的统计数据（如下图 1-1 所示），2023 年社区团购交易规模达到 3228 亿元，同比增长 53.71%，显示出强劲的增长势头。2023 年社区团购赛道整体规模预计达 6500 亿至 7000 亿元，未来两年将突破万亿元规模[3]。研发一个支持高并发的社区团购系统，为用户、团长和平台运营者实现一个便捷高效流畅的线上社区零售系统。是非常有意义的。

![2023年中国社区团购市场规模图](https://via.placeholder.com/600x300.png?text=2023年中国社区团购市场规模图)

图 1-1 2023年中国社区团购市场规模图

社区团购作为一种新兴的零售模式，自2016年起步以来，经历了快速发展和迭代升级。随着互联网技术的迅速发展与消费模式的不断演变，社区团购模式在现代供应链管理中扮演着日益重要的角色，对传统的供应链管理产生了深远影响[2]。美团优选的使用人数在所有团购平台中排名第一，占比52.43%[3]。这一数据表明，社区团购已成为中国零售市场的重要组成部分。

然而，社区团购在快速发展过程中也面临诸多挑战。一方面，随着互联网巨头的加入，部分舆论开始担心它们会像之前的打车大战、外卖大战、单车大战一样故技重施：先采取低价倾销策略占领市场，再 "挟流量以令市场" 挤压中间商 "卖菜者" 生存空间，继而剥夺终端消费者的 "买菜自由"[4]。另一方面，社区团购也引发了资本无序扩张、产品质量不一和 "大数据杀熟" 等问题[4][5]。特别是当前社区团购平台普遍面临拼团流程繁琐、团长管理分散、配送路径规划不合理等问题，制约了行业的高质量发展。

在政策监管方面，市场监管总局联合商务部于2021年12月22日组织召开规范社区团购秩序行政指导会，阿里巴巴、腾讯、京东、美团、拼多多、滴滴等6家互联网平台企业参加。会议要求互联网平台企业严格遵守 "九不得" 规定，包括不得通过低价倾销、价格串通、哄抬价格、价格欺诈等方式滥用自主定价权；不得违法达成、实施固定价格、限制商品生产或销售数量、分割市场等任何形式的垄断协议；不得实施没有正当理由的掠夺性定价、拒绝交易、搭售等滥用市场支配地位行为等[4]。

本研究的意义在于：一方面，通过构建基于微服务架构的社区团购系统，解决当前平台存在的拼团流程繁琐、团长管理分散、配送路径规划不合理等痛点问题，为行业高质量发展提供技术支撑；另一方面，通过引入Dijkstra算法优化配送路径、采用微服务架构提升系统可用性等创新方案，为社区零售的数字化转型探索有效路径，为广大消费者提供更优质的社区零售服务，促进社区团购行业的健康可持续发展[2][1]。

## 1.2 国内外研究现状

随着 Web 3.0 技术的发展，社区团购作为新兴零售模式的研究方兴未艾。国内学者对社区团购的研究主要集中在商业模式、供应链管理、消费者行为和法律规制等方面。国外对社区团购的研究相对较少，主要集中在团购模式和社区商务的结合上（如下图 1-2 所示）。虽然国内外在社区团购领域的研究都取得了显著进展，但在高并发访问、配送路径优化、系统可用性等方面还有可优化的空间。因此，为解决以上问题本项目决定基于 Spring Boot 开发，采用微服务架构，Vue 渐进式框架进行开发，并使用消息队列、弹性扩容、Docker 等技术。为社区团购系统在解决高并发访问问题提供有效思路。

![国内外社区团购研究热点对比图](https://via.placeholder.com/600x300.png?text=国内外社区团购研究热点对比图)

图 1-2 国内外社区团购研究热点对比图

在商业模式研究方面，李保林 (2024) 指出，社区团购已站在新周期的节点，加之全国性资本基于社区团购的动荡与收缩及新冠疫情结束双因素叠加的影响，社区团购的热度急剧下降，尤其部分媒体开始鼓吹社区团购不行了等看衰论调，这极大地干扰了企业及从业者的判断和思考。实际上，这几年社区团购业态进化迭代很快，资本基因型社区团购只是赛道中的一个业态，比较耀眼突出，但它们的黄金时期已经过去了[6]。

在供应链管理研究方面，曾敏刚等 (2024) 构建了社区团购三级供应链博弈模型，对比分析不同渠道策略下供应商和社区团购零售商分别为渠道结构主导者时，供应链最优定价决策和利润分配。研究表明，除了在分散渠道策略下的线下实体渠道产品销售价格会下降，社区团购渠道产品销售价格和批发价格都会随团长运营服务水平的提升而升高；供应商和零售商的权力结构并不影响社区团购渠道整合策略的选择，仅影响整合策略后获得利润增值大小；只有在消费者对线上渠道偏好程度较低且团长运营服务水平不太高时，整合策略才对社区团购渠道有利[2]。刘倩、童瑶莹 (2025) 则聚焦冷链产品的核心物流环节，构建总成本与碳排放强度最小化的双目标模型，通过遗传算法对云南省社区团购仓配网络优化分析，提出昆明、曲靖等四地设仓的最优方案，为区域化冷链布局提供了低碳导向的决策支持[8]。

在消费者行为研究方面，林细雁 (2024) 基于ECM-ISC模型，综合运用创新扩展理论、信息系统成功理论以及理性行为理论，构建了一个综合的研究框架，以探究社区团购平台用户持续使用意愿的影响因素。研究发现，社区团购平台的用户持续使用意愿主要受用户满意度的影响；期望确认程度通过中介变量间接正向影响用户持续使用社区团购平台的意愿；用户对社区团购平台的感知有用性、感知易用性对持续使用意愿的影响效果不同；社区团购平台的关系质量各维度对用户持续使用意愿的影响也存在差异[5]。

国外对社区团购的研究相对较少，主要集中在团购模式和社区商务的结合上。一些研究关注团购模式对消费者行为的影响，例如折扣力度、时间限制和社交因素对团购参与度的影响。在供应链管理方面，国外研究主要关注社区团购对传统零售供应链的影响，表明其能够有效降低物流成本、减少库存积压、促进供应链信息共享与协同合作[1]。另有研究针对物流优化难题，提出考虑产品随机释放日期的车辆路径模型，结合美团运营案例验证了该模型在降低配送成本与逾期penalty成本中的有效性[9]。在风险管控领域，有学者构建包含6项一级指标、24项二级指标的供应链风险评估体系，通过层次分析法与模糊综合评价法明确各环节风险等级，为风险防控提供了量化工具[10]。此外，一些研究探讨了社区商务模式的可持续性和发展前景，认为其能够增强社区凝聚力，促进本地经济发展，但也面临物流配送、库存管理和用户粘性等挑战[7]。

通过研读以上国内外研究成果，发现在高并发访问和突发情况的可用性、配送路径规划优化、系统安全性等问题上还有可优化的空间。为解决上述问题，本项目采用 Spring Boot 微服务架构，结合 Vue3 前端框架，引入 Dijkstra 算法优化配送路径，使用 Docker 容器化部署，并集成消息队列、负载均衡等技术，为社区团购系统的高并发处理和配送效率提升提供有效解决方案。

## 1.3 设计目标

本报告的研究内容主要分为五个部分：
（1）明确系统技术栈选型
后端采用 Spring Boot 框架搭建微服务架构，使用 Consul 实现服务注册与发现，确保服务高可用；前端基于 Vue3 开发用户界面，实现响应式交互；数据库选用 MySQL 存储业务数据。
（2）开展系统需求分析
分析社区团购场景下的核心需求，包括用户端的拼团下单、商品浏览功能，团长端的订单管理、团员管理功能，管理员端的商品上架、配送调度功能；明确系统性能需求（如并发处理能力、响应时间）及安全需求（如数据加密、支付安全）。
（3）设计系统架构与模块拆分
采用微服务架构拆分系统为用户服务、商品服务、订单服务、团长服务、配送服务等独立模块，通过 Consul 实现服务间通信；前端采用 Vue3 组件化开发，实现与后端服务的交互。
（4）实现核心功能模块
开发拼团下单逻辑，支持多人拼团、价格计算及订单生成；设计团长管理模块，包含团长资质审核、佣金结算功能；基于 Dijkstra 算法实现智能路线规划，结合订单分单逻辑提升配送效率；集成微信支付接口与数据加密模块（如 AES 加密）保障交易安全。
（5）进行系统测试与优化
对系统功能进行单元测试与集成测试，验证核心模块可用性；针对高并发场景进行压力测试，优化服务响应速度与数据库性能。

## 1.4 预期提交的成果

1. 完整的社区团购系统（含数据库文件）
2. 毕业设计报告
3. 系统源代码（含前端Vue3代码，后端Spring Boot微服务代码）及测试用例
4. 系统功能演示视频

## 1.5 创新点

### 1.5.1 微服务架构下的模块化设计

采用Spring Boot微服务架构，将系统拆分为8个独立服务模块，每个服务具备独立的数据库和业务逻辑，实现了服务的松耦合与高内聚。相比传统单体架构，系统可用性提升至99.5%以上，支持按需扩展，有效应对业务峰值场景。通过Consul实现服务注册与发现，保障了服务间通信的稳定性与负载均衡能力。

### 1.5.2 基于Dijkstra算法的智能配送路径优化

针对社区团购"最后一公里"配送效率低下的问题，本系统引入Dijkstra算法进行路径规划。将社区自提点、仓库及配送站点抽象为图论节点，以实际距离或配送时间为边的权重，动态计算最优配送路径。结合订单分单逻辑（按社区区域聚合订单），系统能够减少配送绕路与空驶率。经测试，该算法使平均配送距离缩短约15%，配送效率提升显著，降低了物流成本。

### 1.5.3 多重数据安全保障机制

系统采用分层加密策略：用户密码使用SHA256+盐值不可逆加密；手机号等敏感信息使用AES对称加密；支付数据采用AES加密+SHA256签名双重保护。同时，所有数据传输强制使用HTTPS/TLS 1.2+协议，并实施基于角色的访问控制（RBAC）。该安全体系有效防范了数据泄露、中间人攻击等风险，符合《个人信息保护法》与《网络安全法》的合规要求。

---

# 2 关键技术概述

## 2.1 软件技术

本系统如无特别说明，特指"基于Spring Boot的社区团购系统的设计与实现"
本系统所设计的社区团购系统将涉及以下软件技术：
IDEA：采用 IntelliJ IDEA 作为集成开发环境，其提供的代码自动补全、调试工具和版本控制集成功能，可提升 Java 后端与 Vue3 前端的开发效率。
JMeter：用于系统性能测试的开源工具，将通过模拟高并发订单请求，验证系统在峰值场景下的响应能力与稳定性。
Spring Boot：作为后端核心开发框架（版本3.2.3），简化微服务的配置与部署流程，通过自动配置功能整合第三方依赖，快速实现用户管理、订单处理等业务模块。
Spring Cloud：作为微服务架构框架（版本2023.0.0），提供服务注册发现、配置中心、负载均衡等微服务基础设施。
Spring Data JPA：作为ORM框架（版本3.2.3），简化数据库访问操作，支持复杂查询和事务管理。
Consul：作为微服务架构中的服务注册与发现组件，负责管理用户服务、商品服务等模块的注册信息，实现服务间的动态通信与负载均衡，保障系统高可用性。
Vue3：前端采用 Vue3 框架（版本3.5.22）进行组件化开发，结合其响应式数据绑定与 Composition API，构建用户端拼团界面、团长管理后台等交互页面，提升前端开发效率与用户体验。
Element Plus：前端UI组件库（版本2.11.4），提供丰富的组件和设计规范，快速构建美观的用户界面。
Pinia：前端状态管理库（版本3.0.3），用于管理应用的全局状态，支持响应式数据更新。
Vue Router：前端路由管理库（版本4.5.1），实现单页面应用的页面导航和路由守卫。
Vite：前端构建工具（版本7.1.9），提供快速的开发服务器和优化的生产构建。
Axios：作为前端 HTTP 请求库（版本1.12.2），用于实现 Vue3 前端与后端微服务的接口通信，支持异步请求与响应拦截，确保数据交互的稳定性。
MySQL：选用 MySQL 作为关系型数据库（版本8.0.36），存储用户信息、商品数据、订单记录等核心业务数据，通过事务管理保障数据一致性。
JWT：JSON Web Token（版本0.11.5），用于实现无状态的身份认证和授权机制。
Logback + AOP：日志记录框架，结合Spring AOP实现双轨制日志系统，支持业务操作日志记录。
Hutool：轻量级 Java 工具库（版本5.8.25），其提供的加密解密工具（如 AES、MD5）用于实现用户密码加密、支付数据签名，保障系统数据安全。
Lombok：Java代码简化库（版本1.18.30），通过注解自动生成getter、setter、toString等方法，减少样板代码。
SpringDoc：API文档生成工具（版本2.3.0），自动生成Swagger UI接口文档，便于前后端联调。
Apache POI：Excel处理库（版本5.2.5），用于实现数据导出和报表生成功能。
微信支付 SDK：集成微信支付官方开发工具包，实现拼团订单的支付流程，支持扫码支付、公众号支付等场景，确保交易链路的安全性。
高德地图 API：辅助实现配送地址解析与地理坐标转换，为 Dijkstra 算法提供节点位置数据支持，提升路径规划的准确性。

## 2.2 系统运行环境

（1）网络环境
网络范围：Internet；
网络协议：HTTP/HTTPS；
带宽要求：服务器端建议 100Mbps 及以上。
（2）服务端软件环境
操作系统：Windows 11；
应用服务器：Spring Boot内嵌Tomcat；
JDK 版本：JDK 17及以上；
Consul 版本：1.15.0 及以上；
（3）客户端软件环境
操作系统：Windows 10/11及以上；
浏览器：Chrome 100.0 及以上。
（4）数据库系统
MySQL：8.0.36 及以上版本，支持 InnoDB 存储引擎以保障事务特性。

## 2.3 相关算法（可选）

本系统在配送路径优化模块中应用 Dijkstra 算法，其核心思想为：
将社区自提点、仓库及配送站点视为图论中的节点，节点间的实际距离（或配送时间）作为边的权重；
以仓库为起点，通过迭代计算从起点到各节点的最短路径，生成配送路线；
结合订单分单逻辑（如按社区区域划分订单），将同区域订单聚合后，利用算法重新计算最优路径，减少配送绕路与空驶率。
该算法通过优先选择最短路径节点的策略，确保在已知节点权重为非负值的场景下，能高效求得最优解，适配社区团购多节点、短距离的配送需求。

---

# 3 需求分析说明

## 3.1 系统概述

### 3.1.1 目标

本系统旨在解决当前社区团购中存在的拼团流程繁琐、团长管理分散、配送路径规划不合理等问题，为社区零售升级提供数字化解决方案。
系统应用目标包括：支持用户便捷拼团下单，实现团长高效管理团员与订单，通过 Dijkstra 算法优化配送路径并结合订单分单逻辑提升处理效率；集成微信支付与数据加密模块保障交易安全，最终助力社区商业数字化运营。
	作用范围覆盖社区用户、团长、平台管理员，提供从商品选购到配送履约的全流程服务。

### 3.1.2 用户特点

本系统最终用户分为三类：
甲方（社区用户）：普通居民，主要使用拼团下单、订单查询功能，操作频率高（尤其生鲜采购高峰期），对界面简洁性和操作便捷性要求高；
乙方（团长）：社区服务点负责人，负责订单汇总、商品自提管理及团员维护，使用频率中等，需高效处理订单与佣金结算；
系统管理员：负责商品上架、用户权限管理、配送调度及数据监控，使用频率较低，但需具备一定系统操作能力，保障平台稳定运行。

## 3.2 用例分析

### 3.2.1 社区用户用例分析

社区用户是社区团购系统的核心参与者，可在系统中完成从商品浏览到订单配送的全流程操作。核心功能包括：按分类浏览商品列表、通过关键词搜索目标商品、将心仪商品加入购物车、发起拼团或加入他人拼团、分享拼团链接邀请好友参团、查看实时拼团进度、生成订单并完成支付、查询订单配送状态。辅助功能包括维护个人资料与收货地址、余额充值、申请成为团长、提交用户反馈等。其用例图如图 3-1 所示。

**图 3-1 社区用户用例图**

社区用户的具体需求如下：

（1）浏览商品分类：用户进入系统首页，点击商品分类菜单时本用例开始；用户可选择不同分类浏览对应商品，系统展示商品名称、图片、价格和库存信息；若所选分类暂无商品，系统提示"暂无商品"；用户可点击商品进入详情页或继续浏览其他分类；切换到其它页面时本用例结束。
（2）搜索商品：用户在搜索框输入关键词并点击搜索按钮时本用例开始；系统根据关键词在商品库中进行模糊匹配并展示搜索结果列表；若未找到相关商品，系统提示"未找到相关商品，请尝试其他关键词"；若未输入关键词，系统提示"请输入搜索内容"；用户可点击搜索结果进入商品详情页；切换到其它页面时本用例结束。
（3）添加商品到购物车：用户在商品详情页选择规格和数量，点击"加入购物车"按钮时本用例开始；系统检查商品库存情况，库存充足时成功添加到购物车并提示"已加入购物车"；库存不足时提示"库存不足，仅剩X件，请调整数量"；用户可选择继续浏览或前往购物车结算；切换到其它页面时本用例结束。
（4）创建拼团活动：用户在购物车页面或商品详情页点击"发起拼团"按钮时本用例开始；系统显示拼团确认对话框，用户确认拼团商品信息和数量后点击确定；系统验证商品是否支持拼团，不支持时提示"该商品暂不支持拼团"；支持时创建拼团活动并跳转至拼团详情页，显示邀请好友参团的二维码和链接；用户可分享链接邀请好友；切换到其它页面时本用例结束。
（5）参与他人拼团：用户在拼团活动列表或通过分享链接点击"去参团"按钮时本用例开始；系统显示拼团详情信息，用户查看团长信息、商品信息、参团人数和剩余时间后确认加入；若拼团已满员或已过期，系统提示"该拼团已无法加入"；加入成功后系统记录参与信息，跳转至我的拼团页面并提示"加入拼团成功"；用户可查看拼团进度；切换到其它页面时本用例结束。
（6）分享拼团链接：用户在拼团详情页点击"分享"按钮时本用例开始；系统显示分享选项（微信、QQ、复制链接等），用户选择分享方式；系统生成专属拼团链接和二维码；分享成功后提示"分享成功"；好友通过链接访问时，系统自动记录分享关系并引导参团；用户可继续分享或返回拼团详情；切换到其它页面时本用例结束。
（7）查看拼团进度：用户进入拼团详情页时本用例开始；系统实时显示当前参团人数、剩余时间、参团成员列表和拼团状态；用户可查看每个参团成员的信息；若拼团成功，显示"拼团成功，可前往支付"；若拼团失败，显示退款提示信息；用户可刷新页面查看最新进度；切换到其它页面时本用例结束。
（8）下单支付：拼团成功后，用户在拼团详情页或我的拼团页点击"立即支付"时本用例开始；系统跳转至订单确认页面，显示订单商品信息、收货地址、支付金额等；用户选择或修改收货地址，确认订单信息后选择支付方式（余额支付等）；点击"确认支付"后系统处理支付请求；支付成功后提示"支付成功"并跳转订单详情页面；支付失败时提示具体失败原因并可重新尝试；切换到其它页面时本用例结束。
（9）查询配送状态：用户在我的订单页面点击订单详情时本用例开始；系统展示订单当前配送状态（待发货、配送中、已送达等）、预计送达时间和自提点信息；配送中订单显示配送员联系方式；用户可拨打电话联系配送员；系统定期更新配送状态；用户可刷新页面查看最新状态；切换到其它页面时本用例结束。
（10）维护个人资料：用户在个人中心点击"个人信息"时本用例开始；系统显示当前个人信息表单，用户可修改姓名、联系电话、头像等信息；用户填写完成后点击"保存"按钮；系统验证信息格式，保存成功后提示"资料保存成功"；图片格式不符时提示"请上传jpg/png格式图片，大小不超过2MB"；用户可继续修改或返回个人中心；切换到其它页面时本用例结束。
（11）管理收货地址：用户在个人中心点击"收货地址"时本用例开始；系统显示用户的所有收货地址列表；用户可点击"添加地址"填写新地址信息，或点击现有地址的"编辑"按钮修改信息；必填信息缺失时系统提示"请完善地址信息"；用户可设置某个地址为默认地址；删除地址时系统确认"确认删除该地址吗？"；操作完成后系统提示操作结果；切换到其它页面时本用例结束。
（12）余额充值：用户在个人中心点击"我的余额"进入余额页面，点击"充值"按钮时本用例开始；系统显示充值对话框，用户输入充值金额并选择支付方式；用户确认充值信息后点击"立即充值"；系统调用支付接口处理充值请求；充值成功后更新用户余额并提示"充值成功，余额已到账"；充值失败时提示具体失败原因；用户可查看充值记录；切换到其它页面时本用例结束。
（13）申请团长资格：用户在个人中心点击"申请成为团长"时本用例开始；系统显示团长申请表单，用户填写个人信息、选择服务社区、填写团点信息并上传资质证明；用户填写完成后点击"提交申请"；系统验证信息完整性，信息不完整时提示"请完善资料"；提交成功后提示"申请已提交，请等待审核"并显示申请进度；用户可查看申请状态；切换到其它页面时本用例结束。
（14）提交用户反馈：用户在个人中心点击"意见反馈"时本用例开始；系统显示反馈表单，用户选择反馈类型（功能问题、商品问题、配送问题、支付问题、其他）、填写问题描述；用户可上传相关图片作为证据；点击"提交反馈"后系统验证内容，内容为空时提示"请填写反馈内容"；提交成功后提示"反馈已提交，我们会尽快处理"；用户可查看反馈历史记录；切换到其它页面时本用例结束。

### 3.2.2 团长用户用例分析

团长兼具社区服务者与经营者双重身份，核心职能包括管理团点运营与服务社区团员。主要功能涵盖：维护团长个人信息与团点信息、审核团员加入申请、管理本团点拼团活动进度、批量处理团员订单与退款申请、规划最优配送路线并更新配送状态、查看佣金明细与业绩数据。其用例图如图 3-2 所示。

**图 3-2 团长用例图**

团长用户的具体需求如下：

（1）登录：团长进入登录页面，填写用户名和密码，点击"登录"按钮时本用例开始；系统验证用户名和密码，验证通过则跳转至团长工作台首页，显示今日订单数量、待处理申请等统计信息；验证失败则提示"用户名或密码错误，请重新输入"；用户可选择记住密码或找回密码；切换到其它界面时本用例结束。
（2）修改个人信息：团长在团长工作台点击右上角头像，选择"个人中心"进入个人信息页面时本用例开始；系统显示当前个人信息表单，团长可修改姓名、联系方式、头像等信息；团长填写完成后点击"保存"按钮；系统验证信息格式，保存成功后提示"个人信息修改成功"；头像格式不符时提示"请上传jpg/png格式图片，大小不超过2MB"；团长可继续修改其他信息或返回工作台；切换到其它页面时本用例结束。
（3）维护拼团活动：团长在团长工作台点击"发起拼团"时本用例开始；系统显示拼团活动创建表单，团长选择商品、设置拼团价格、参团人数、活动时间等参数；团长填写完成后点击"发布活动"；系统验证参数合理性，发布成功后提示"拼团活动发布成功"并跳转至活动管理页面；参数不符合要求时提示具体错误信息；团长可查看已发布的活动列表；切换到其它页面时本用例结束。
（4）管理拼团进度：团长在团长工作台点击"我的团队"进入拼团管理页面时本用例开始；系统显示该团长负责的所有拼团活动列表，包括活动状态、参团人数、剩余时间等；团长可点击进入具体拼团详情，查看参团成员信息；对即将过期的拼团可发送提醒通知；系统实时更新拼团状态；团长可进行批量操作或单独处理；切换到其它页面时本用例结束。
（5）审核团员申请：团长在团长工作台点击"团员管理"进入申请审核页面时本用例开始；系统显示待审核的团员申请列表，包括申请人信息、申请理由等；团长点击"查看详情"审查申请资料；审核通过则点击"通过申请"，审核不通过则点击"拒绝申请"并填写拒绝理由；系统处理审核结果并发送通知给申请人；审核完成后该申请从待审核列表移除；团长可批量审核多个申请；切换到其它页面时本用例结束。
（6）维护团员列表：团长在团长工作台点击"团员管理"进入团员列表页面时本用例开始；系统显示该团长名下的所有团员信息列表；团长可搜索特定团员或按状态筛选；点击团员详情可查看消费记录、参团历史等；团长可对异常团员进行"暂停服务"或"恢复服务"操作；系统记录操作日志并通知团员；团长可导出团员数据；切换到其它页面时本用例结束。
（7）查看佣金明细：团长在团长工作台点击"佣金管理"进入佣金查询页面时本用例开始；系统显示佣金统计面板，包括本月佣金总额、已结算金额、待结算金额等；团长可选择时间段查看详细佣金记录；点击具体记录可查看订单详情和佣金计算明细；系统支持导出佣金报表；团长可查看佣金结算周期和下次结算时间；切换到其它页面时本用例结束。
（8）批量处理订单：团长在团长工作台点击"订单管理"进入订单处理页面时本用例开始；系统显示待处理的订单列表，包括订单状态、商品信息、下单时间等；团长可勾选多个订单进行批量操作；选择"批量确认"则将订单状态改为"待配送"；选择"批量发货"则分配配送任务；操作成功后系统提示"批量处理完成"并更新订单状态；处理失败的订单会单独提示错误原因；团长可查看处理历史记录；切换到其它页面时本用例结束。
（9）处理订单退款：团长在订单管理页面点击具体订单的"退款处理"时本用例开始；系统显示退款申请详情，包括退款原因、退款金额、相关证据等；团长审核退款理由，确认是否合理；审核通过则点击"同意退款"，审核不通过则点击"拒绝退款"并填写拒绝理由；系统处理退款结果，成功则更新订单状态并退款至用户账户；退款完成后发送通知给用户；团长可查看退款处理历史；切换到其它页面时本用例结束。
（10）订单配送管理：团长在团长工作台点击"配送管理"进入配送任务页面时本用例开始；系统显示待配送的订单列表，按地理位置智能排序；团长可查看配送路线预览和预计耗时；点击"开始配送"则将订单状态改为"配送中"；系统记录配送开始时间；团长可实时更新配送状态；配送完成后标记为"已完成"；团长可查看配送统计数据；切换到其它页面时本用例结束。
（11）确认配送路线：团长在配送管理页面点击"路线规划"时本用例开始；系统基于订单地址和Dijkstra算法计算最优配送路线；显示路线地图、总距离、预计耗时等信息；团长可手动调整路线顺序或添加途经点；确认路线后点击"应用路线"；系统保存路线规划并应用到配送任务；路线规划失败时提示"无法规划合理路线，请手动调整"；团长可保存常用路线模板；切换到其它页面时本用例结束。
（12）管理配送状态：团长在配送任务页面选择具体配送任务时本用例开始；系统显示订单配送详情，包括当前位置、预计到达时间等；团长可更新配送状态：点击"已出发"更新为配送中，点击"已送达"完成配送；遇到异常情况可选择"配送异常"并填写原因；系统记录状态变更时间并通知用户；配送完成后系统自动计算配送时长；团长可查看配送历史记录和统计报表；切换到其它页面时本用例结束。

### 3.2.3 系统管理员用户用例分析

系统管理员承担平台运维与监管职责，操作覆盖全系统模块。核心功能包括：用户体系维护与权限分配、商品分类体系管理、支付参数与安全策略配置、团长资质审核与绩效管理、拼团活动监管与干预、全平台数据统计分析与报表生成、系统日志监控与异常排查。其用例图如图 3-3 所示。

**图 3-3 系统管理员用户用例图**

系统管理员用户的具体需求如下：

（1）登录：管理员进入管理系统登录页面，填写管理员账号和密码，点击"登录"按钮时本用例开始；系统验证账号密码和管理员权限，验证通过则跳转至管理后台首页，显示系统概况统计面板；验证失败则提示"账号或密码错误"；管理员可选择记住登录状态；切换到其它页面时本用例结束。
（2）修改个人信息：管理员在管理后台点击右上角头像，选择"个人中心"进入资料编辑页时本用例开始；管理员可修改姓名、联系电话、头像等信息，点击"保存"按钮；系统保存修改后的信息，并提示"资料保存成功"；信息格式错误时提示具体要求；管理员可继续修改或返回后台首页；切换到其它页面时本用例结束。
（3）用户维护：管理员在管理后台左侧菜单点击"用户管理"进入用户维护界面时本用例开始；系统显示用户列表，支持按用户名、角色、状态等条件筛选；管理员可点击用户详情查看完整信息；对违规用户可选择"禁用账号"或"启用账号"；操作成功后系统提示"操作成功"并记录操作日志；管理员可批量处理多个用户；切换到其它页面时本用例结束。
（4）用户权限维护：管理员在管理后台点击"权限管理"进入权限配置界面时本用例开始；系统显示角色权限矩阵，管理员可勾选或取消各项权限；点击"保存权限"后系统验证权限配置的合理性；保存成功后提示"权限配置已更新"；配置冲突时提示"权限配置存在冲突，请检查"；管理员可为不同角色定制权限模板；切换到其它页面时本用例结束。
（5）反馈处理：管理员在管理后台点击"反馈管理"进入用户反馈处理界面时本用例开始；系统显示用户反馈列表，按状态分类（待处理、处理中、已解决）；管理员点击反馈详情查看内容和附件；填写处理意见后点击"回复用户"；系统发送回复通知并更新反馈状态；处理完成后反馈从待处理列表移除；管理员可按类型、时间等筛选反馈；切换到其它页面时本用例结束。
（6）商品分类维护：管理员在管理后台点击"商品管理-分类管理"进入分类维护界面时本用例开始；系统显示树形分类结构，管理员可点击"添加分类"创建新分类；编辑现有分类时可修改名称、排序、状态等；删除分类前系统检查是否有商品关联；操作成功后提示"分类维护成功"；分类名称重复时提示"分类名称已存在"；管理员可拖拽调整分类排序；切换到其它页面时本用例结束。
（7）商品维护：管理员在管理后台点击"商品管理-商品列表"进入商品维护界面时本用例开始；系统显示商品列表，支持按分类、状态、名称等筛选；点击"添加商品"进入商品编辑表单；填写商品信息、上传图片、设置价格库存等；点击"保存"后系统验证商品信息完整性；保存成功后提示"商品添加成功"；信息不完整时提示具体缺失项；管理员可批量上下架商品；切换到其它页面时本用例结束。
（8）支付参数维护：管理员在管理后台点击"系统设置-支付配置"进入支付参数维护界面时本用例开始；系统显示当前支付参数配置表单；管理员可修改微信支付、支付宝等参数；点击"保存配置"后系统验证参数格式；保存成功后提示"支付参数已更新"；参数格式错误时提示具体要求；管理员可开启/关闭某些支付方式；切换到其它页面时本用例结束。
（9）系统日志维护：管理员在管理后台点击"系统监控-操作日志"进入日志管理界面时本用例开始；系统显示操作日志列表，支持按时间、用户、操作类型等筛选；管理员可查看详细日志信息；对异常日志可标记"已处理"或添加备注；支持导出日志到Excel文件；日志量大时支持分页查看；管理员可设置日志保留策略；切换到其它页面时本用例结束。
（10）监管拼团活动：管理员在管理后台点击"活动管理-拼团监管"进入活动监管界面时本用例开始；系统显示所有拼团活动列表，按状态分类；管理员可查看活动详情和参与情况；对违规活动可选择"暂停活动"或"终止活动"；操作时需填写处理理由；系统通知相关团长并处理关联订单；处理成功后提示"活动已处理"；管理员可设置自动监控规则；切换到其它页面时本用例结束。
（11）订单监控：管理员在管理后台点击"订单管理-订单监控"进入订单监控界面时本用例开始；系统显示订单列表，支持多条件筛选；管理员可查看订单详情和状态流转；对超时未支付订单可批量"取消订单"；对异常订单可"标记异常"并填写原因；操作成功后系统更新订单状态并通知用户；管理员可导出订单数据进行分析；切换到其它页面时本用例结束。
（12）配送状态监控：管理员在管理后台点击"配送管理-配送监控"进入配送状态监控界面时本用例开始；系统显示配送任务列表和地图视图；管理员可查看配送路线和实时位置；对超时配送可"催促配送"并通知团长；对配送异常可"介入处理"并协调解决；系统记录所有操作日志；管理员可查看配送效率统计报表；切换到其它页面时本用例结束。
（13）管理团长绩效：管理员在管理后台点击"团长管理-绩效管理"进入绩效管理界面时本用例开始；系统显示团长绩效数据面板，包括订单量、用户满意度、配送效率等指标；管理员可查看详细绩效明细；对绩效异常的团长可"标记关注"或"暂停资格"；支持导出绩效报表；管理员可设置绩效考核标准；切换到其它页面时本用例结束。
（14）审核团长资质：管理员在管理后台点击"团长管理-资质审核"进入审核界面时本用例开始；系统显示待审核的团长申请列表；管理员点击"查看详情"审查申请资料；审核通过则点击"审核通过"并设置佣金比例；审核不通过则点击"审核拒绝"并填写拒绝理由；系统处理审核结果并发送通知；审核完成后申请状态更新；管理员可批量审核；切换到其它页面时本用例结束。
（15）新用户/团长数统计：管理员在管理后台点击"数据统计-用户统计"进入统计界面时本用例开始；系统显示用户增长趋势图表，包括日注册量、周注册量、月注册量等；管理员可选择时间范围和统计维度；支持查看新用户和新团长的详细列表；可导出统计数据到Excel；管理员可设置统计报告自动生成；切换到其它页面时本用例结束。
（16）营收统计：管理员在管理后台点击"数据统计-营收统计"进入营收统计界面时本用例开始；系统显示营收数据面板，包括订单金额、佣金收入、平台利润等；管理员可查看分时间段、分类型的营收明细；支持生成财务报表；可导出数据用于财务分析；管理员可设置营收预警阈值；切换到其它页面时本用例结束。

## 3.3 非功能性需求

### 3.3.1 时间特性要求

用户端常规页面（如首页、个人中心）加载时间需控制在2秒以内。核心交互页面（如商品列表、拼团详情页）加载时间不超过800毫秒。关键交易操作（如订单提交、支付确认）响应时间≤500毫秒，确保交易流程的顺畅与即时反馈。配送路线规划计算（基于优化后的路径算法）响应时间≤1秒。

### 3.3.2 输入输出要求

无特别要求

### 3.3.3 安全性保证

个人信息、收货地址及支付相关数据传输全过程强制使用HTTPS/TLS 1.2+协议进行端到端加密，防止中间人攻击和数据泄露。
 严格执行基于角色的访问控制（RBAC）模型。社区用户、团长、系统管理员仅能访问其授权范围内的功能与数据，例如团长无法查看其他团点的订单详情，用户不能操作后台管理功能。

### 3.3.4 数据规模

商品列表、订单列表等分页查询接口，单表数据量达到十万级左右。

## 3.4 系统运行环境及外部接口需求

### 3.4.1 系统硬件运行环境

本系统运行环境如下：
a．处理器：Intel Core i5 或 AMD Ryzen 5 及以上
b．内存：16GB DDR4 及以上
c．存储：SSD 512GB 及以上
d．网络：千兆以太网
e．功能键及其他专用硬件：无

### 3.4.2 用户接口

无

---

# 4 概要设计说明

## 4.1 系统总体设计

根据社区团购系统的业务需求和技术特点，系统整体架构基于微服务设计理念，使用Consul作为服务注册与发现中心，Spring Cloud Gateway作为统一网关，前端采用Vue3框架开发三端应用，后端使用Spring Boot构建微服务集群，底层配备完善的日志和监控系统。系统架构如图4-1所示。

**图 4-1 社区团购系统架构图**

## 4.2 系统功能结构设计

基于社区团购系统的需求分析和用例分析，本系统采用模块化设计思想，系统功能划分为多个子模块，分别承担不同职责，确保系统的高内聚低耦合，便于后续维护和扩展。确保各功能模块既相对独立又有机衔接，形成一个完整的社区团购生态系统。系统功能结构如图4-2所示。

**图 4-2 系统功能结构图**

1. 系统信息管理模块
   该模块是系统的管理中枢，负责维护平台的基础架构与安全。主要功能包括：管理员用户体系的建立与维护、不同角色（用户、团长、管理员）的权限分配与认证、全系统操作日志的监控与审计、支付安全策略与系统参数的配置，为整个平台的稳定、安全运行提供基础支撑。
2. 团长运营管理模块
   该模块专注于团长端的管理与运营。主要功能包括：团长入驻的资质审核、团长个人信息与团点信息的维护与更新、团长绩效与佣金数据的统计与分析、以及对特定团长下社区成员的管理，确保团长团队的服务质量与运营效率。
3. 拼团活动管理模块
   该模块是社区团购业务的核心，覆盖拼团活动的全生命周期。主要功能包括：拼团活动的创建与参数设置（如成团人数、时效）、生成并管理专属拼团链接与二维码、实时展示拼团进度与倒计时、向用户推送成团通知，并支持系统管理员对异常活动进行干预与管理。
4. 商品与购物车模块
   该模块服务于用户的商品浏览与选购流程。主要功能包括：商品分类体系的管理、商品信息的发布与维护、基于关键词的商品搜索、以及用户侧购物车的功能（添加商品、修改数量、规格确认、合并下单），为用户提供流畅的购物体验。
5. 订单与配送管理模块
   该模块处理从下单到收货的完整流程。主要功能包括：用户订单的生成与确认、支付成功后订单状态的自动更新、团长端对本团点订单的批量处理与收货地址聚类、配送清单的生成与最优路径规划、以及从"待发货"到"已送达"的全流程状态跟踪与更新。
6. 基础信息维护模块
   该模块维护系统赖以运行的所有静态数据。主要功能包括：商品分类、品牌等基础数据字典的管理；用户个人资料、收货地址的维护；团长团点信息的维护；以及故障类型、服务标准等公共信息的配置，为前端业务提供准确的数据支持。
7. 支付与账户模块
   该模块保障平台的资金流转与账户安全。主要功能包括：集成微信支付等多种支付方式、支持用户余额充值与支付、采用数据加密与密钥管理技术保障交易安全、自动计算并结算团长佣金、并为用户和团长提供清晰的账单与佣金明细查询。
8. 数据统计与分析模块
   该模块为决策提供数据洞察。主要功能包括：多维度数据看板的生成，涵盖用户增长、订单转化、区域热力、商品销量、成团率及团长业绩等关键指标；支持定制化报表生成，助力运营人员进行精准的数据分析与业务决策。

## 4.3 功能需求与程序的关系

本系统中各功能需求与程序模块（组件）之间的关系如下表所示：

**表4-3 功能需求与程序模块（组件）之间的关系**

| 功能需求                      | 系统信息维护模块 | 拼团活动模块 | 购物车模块 | 订单与配送模块 | 支付账号模块 | 团长运营模块 | 数据统计模块 | 基础信息维护模块 |
| ----------------------------- | ---------------- | ------------ | ---------- | -------------- | ------------ | ------------ | ------------ | ---------------- |
| 用户注册 / 登录               | √               |              |            |                |              |              |              |                  |
| 维护个人基础信息              | √               |              |            |                |              |              |              |                  |
| 管理收货地址                  | √               |              |            |                |              |              |              |                  |
| 用户反馈                      | √               |              |            |                |              |              |              |                  |
| 用户维护（管理员）            | √               |              |            |                |              |              |              |                  |
| 系统日志维护（管理员）        | √               |              |            |                |              |              |              |                  |
| 权限管理（管理员）            | √               |              |            |                |              |              |              |                  |
| 发起拼团                      |                  | √           |            |                |              |              |              |                  |
| 加入拼团                      |                  | √           |            |                |              |              |              |                  |
| 分享拼团链接                  |                  | √           |            |                |              |              |              |                  |
| 查看拼团进度                  |                  | √           |            |                |              |              |              |                  |
| 维护拼团活动（团长）          |                  | √           |            |                |              |              |              |                  |
| 管理拼团进度（团长）          |                  | √           |            |                |              |              |              |                  |
| 拼团链接分析（管理员）        |                  | √           |            |                |              |              |              |                  |
| 商品列表查看                  |                  |              | √         |                |              |              |              |                  |
| 商品详情查看                  |                  |              | √         |                |              |              |              |                  |
| 商品分类浏览                  |                  |              | √         |                |              |              |              |                  |
| 搜索商品                      |                  |              | √         |                |              |              |              |                  |
| 将商品加入购物车              |                  |              | √         |                |              |              |              |                  |
| 购物车维护（移除 / 更新数量） |                  |              | √         |                |              |              |              |                  |
| 生成订单                      |                  |              |            | √             |              |              |              |                  |
| 查看订单列表                  |                  |              |            | √             |              |              |              |                  |
| 查看订单详情                  |                  |              |            | √             |              |              |              |                  |
| 取消订单                      |                  |              |            | √             |              |              |              |                  |
| 查看配送状态                  |                  |              |            | √             |              |              |              |                  |
| 批量处理订单（团长）          |                  |              |            | √             |              |              |              |                  |
| 处理退款（团长）              |                  |              |            | √             |              |              |              |                  |
| 管理配送状态（团长）          |                  |              |            | √             |              |              |              |                  |
| 确认配送路线（团长）          |                  |              |            | √             |              |              |              |                  |
| 订单监控（管理员）            |                  |              |            | √             |              |              |              |                  |
| 支付订单                      |                  |              |            |                | √           |              |              |                  |
| 余额充值                      |                  |              |            |                | √           |              |              |                  |
| 查看充值记录                  |                  |              |            |                | √           |              |              |                  |
| 支付参数维护（管理员）        |                  |              |            |                | √           |              |              |                  |
| 团长资质申请                  |                  |              |            |                |              | √           |              |                  |
| 维护团点信息（团长）          |                  |              |            |                |              | √           |              |                  |
| 审核团员申请（团长）          |                  |              |            |                |              | √           |              |                  |
| 维护团员列表（团长）          |                  |              |            |                |              | √           |              |                  |
| 查看佣金（团长）              |                  |              |            |                |              | √           |              |                  |
| 新用户 / 团长数统计           |                  |              |            |                |              |              | √           |                  |
| 营收统计                      |                  |              |            |                |              |              | √           |                  |
| 商品信息维护（管理员）        |                  |              |            |                |              |              |              | √               |
| 商品分类维护（管理员）        |                  |              |            |                |              |              |              | √               |
| 配送标准维护（管理员）        |                  |              |            |                |              |              |              | √               |
| 订单状态定义维护（管理员）    |                  |              |            |                |              |              |              | √               |
| 服务规则维护（管理员）        |                  |              |            |                |              |              |              | √               |
| 团长资质审核（管理员）        |                  |              |            |                |              |              |              | √               |

## 4.4 接口设计

### 4.4.1 应用接口

本系统中应用接口如下表 4-2 到 4-16 所示：

表 4-2 用户服务接口
操作 Http方法 功能
/api/user/register Post 用户注册
/api/user/login Post 用户登录
/api/user/info/{userId} Get 获取用户信息
/api/user/update/{userId} Put 更新用户信息
/api/user/delete/{userId} Delete 删除用户（禁用）
/api/user/search?keyword={keyword} Get 搜索用户
/api/user/role/{role} Get 按角色查询用户
/api/user/role/{userId}?role={role} Put 更改用户角色
/api/user/status/{userId}?status={status} Put 更改用户状态
/api/user/statistics Get 用户统计
/api/user/admin/create Post 管理员创建用户
/api/address/add/{userId} Post 新增收货地址
/api/address/update/{userId}/{addressId} Put 更新收货地址
/api/address/delete/{userId}/{addressId} Delete 删除收货地址
/api/address/list/{userId} Get 获取用户所有地址
/api/address/default/{userId} Get 获取默认地址
/api/address/default/{userId}/{addressId} Put 设置默认地址
/api/address/detail/{userId}/{addressId} Get 获取地址详情
/api/account/{userId} Get 获取账户信息
/api/account/recharge/{userId}?amount={amount} Post 账户充值
/api/account/deduct/{userId}?amount={amount} Post 账户扣款
/api/account/freeze/{userId}?amount={amount} Post 冻结金额
/api/account/unfreeze/{userId}?amount={amount} Post 解冻金额
/api/feedback/submit/{userId} Post 提交反馈
/api/feedback/user/{userId} Get 获取用户反馈列表
/api/feedback/user/{userId}/page?page={page}&size={size} Get 分页查询用户反馈
/api/feedback/{feedbackId} Get 获取反馈详情
/api/feedback/reply Post 管理员回复反馈
/api/feedback/all?page={page}&size={size} Get 管理员查询所有反馈
/api/feedback/status/{status}?page={page}&size={size} Get 按状态查询反馈
/api/feedback/delete/{feedbackId} Delete 删除反馈
/api/upload/file Post 上传通用文件
/api/upload/avatar Post 上传用户头像
/api/upload/feedback Post 上传反馈图片

表 4-3 商品服务接口
操作 Http方法 功能
/api/product/category/list Get 获取分类列表
/api/product/category/tree Get 获取分类树
/api/product/category/{id} Get 获取分类详情
/api/product/category/{id}/products?page=0&size=10 Get 获取分类下的商品
/api/product/admin/category Post 创建分类
/api/product/admin/category/{id} Put 更新分类
/api/product/admin/category/{id} Delete 删除分类
/api/product/admin/category/{id}/sort?sort=5 Put 调整分类排序
/api/product/list?page=0&size=10&sort=create_time&keyword=&categoryId= Get 获取商品列表
/api/product/{id} Get 获取商品详情
/api/product/search?keyword={keyword}&categoryId={categoryId}&page=0&size=10 Get 商品搜索
/api/product/hot?limit=10 Get 热门商品推荐
/api/product/recommend?categoryId={categoryId}&limit=10 Get 推荐商品
/api/product/{id}/stock Get 查询商品库存
/api/product/category/{categoryId}/list?page=0&size=10 Get 按分类查询商品
/api/product/admin/product Post 创建商品
/api/product/admin/product/{id} Put 更新商品
/api/product/admin/product/{id} Delete 删除商品
/api/product/admin/product/{id}/status?status=1 Put 更新商品状态（上下架）
/api/product/admin/product/{id}/stock?quantity=100 Put 调整商品库存
/api/product/admin/upload Post 上传商品图片
/api/product/admin/product/list?page=0&size=10 Get 管理端获取商品列表
/api/product/admin/statistics Get 获取商品统计数据
/feign/product/{productId}/stock/deduct Post 扣减库存
/feign/product/{productId}/stock/restore Post 恢复库存
/feign/product/{productId}/check Get 检查商品是否可售
/feign/product/batch-check Post 批量检查商品状态
/feign/product/{productId}/info Get 获取商品信息（快照用）
/feign/product/batch-info Post 批量获取商品信息

表 4-4 拼团服务接口
操作 Http方法 功能
/api/groupbuy/activity Post 创建拼团活动
/api/groupbuy/activity/{id} Put 更新拼团活动
/api/groupbuy/activity/{id} Delete 删除拼团活动
/api/groupbuy/activities Get 获取活动列表
/api/groupbuy/activities/ongoing Get 获取进行中的活动
/api/groupbuy/activity/{id} Get 获取活动详情
/api/groupbuy/team/launch Post 团长发起拼团
/api/groupbuy/team/join Post 用户参与拼团
/api/groupbuy/payment/callback?orderId={orderId} Post 支付回调
/api/groupbuy/team/quit?teamId={teamId} Post 退出拼团
/api/groupbuy/team/{teamId}/finish Post 团长提前结束拼团
/api/groupbuy/team/{teamId}/cancel Post 团长取消拼团
/api/groupbuy/team/{teamId}/member/{memberId}/remove Post 团长移除团队成员
/api/groupbuy/team/{teamId}/detail Get 获取团详情
/api/groupbuy/activity/{activityId}/teams Get 获取活动的团列表
/api/groupbuy/product/{productId}/activities Get 根据商品ID获取拼团活动
/api/groupbuy/teams/my Get 查询我的拼团记录

表 4-5 订单服务接口
操作 Http方法 功能
/api/order/my?page=0&size=10 Get 查询我的订单
/api/order/{orderId} Get 查询订单详情
/api/order/cancel/{orderId} Post 取消订单
/api/order/confirm/{orderId} Post 确认收货
/api/order/leader/my?leaderId={leaderId}&page=0&size=10 Get 查询团长订单列表
/api/order/leader/summary?leaderId={leaderId} Get 查询团长订单统计
/api/order/admin/list?page=0&size=10&status={status}&payStatus={payStatus} Get 获取订单列表（分页）
/api/order/admin/statistics Get 获取订单统计
/api/order/admin/status/{orderId}?status={status} Put 更新订单状态
/api/order/admin/batchUpdateStatus?status={status} Post 批量更新订单状态
/api/order/admin/status/{status}?page=0&size=10 Get 按状态查询订单
/api/order/admin/search?keyword={keyword}&page=0&size=10 Get 搜索订单
/api/order/admin/export?status={status}&payStatus={payStatus} Get 导出订单
/api/order/admin/user/{userId}?page=0&size=10 Get 获取用户订单
/api/order/admin/leader/{leaderId}?page=0&size=10 Get 获取团长订单
/api/order/feign/create Post 创建订单
/api/order/feign/batchUpdateStatus Post 批量更新订单状态
/api/order/feign/updateStatus?orderId={orderId}&status={status} Post 更新单个订单状态
/api/order/feign/cancel/{orderId} Post 取消订单
/api/order/feign/{orderId} Get 查询订单详情

表 4-6 支付服务接口
操作 Http方法 功能
/api/payment/create Post 创建支付
/api/payment/record/{payId} Get 查询支付记录
/api/payment/order/{orderId} Get 查询订单支付记录
/api/payment/records Get 查询所有支付记录
/api/payment/recharge/records Get 查询充值记录
/api/payment/admin/records?page=0&size=20 Get 管理端查询所有支付记录
/api/payment/admin/statistics Get 支付统计
/api/payment/admin/user/{userId}/records Get 管理端查询指定用户支付记录
/api/payment/feign/refund Post 申请退款

表 4-7 配送服务接口
操作 Http方法 功能
/api/delivery/batch/ship Post 批量发货
/api/delivery/list?status={status}&page=0&size=10 Get 查询配送单列表
/api/delivery/{id} Get 查询配送单详情
/api/delivery/{id}/replan Post 重新规划路径
/api/delivery/{id}/complete Post 手动完成配送
/api/delivery/{id}/cancel Post 取消配送
/api/delivery/warehouse/list Get 查询仓库列表
/api/delivery/warehouse/active Get 查询启用的仓库
/api/delivery/warehouse/default Get 查询默认仓库
/api/delivery/warehouse/{id} Get 查询仓库详情
/api/delivery/warehouse Post 创建仓库
/api/delivery/warehouse/{id} Put 更新仓库
/api/delivery/warehouse/{id} Delete 删除仓库
/api/delivery/warehouse/{id}/setDefault Put 设置默认仓库
/api/delivery/statistics/overview Get 配送总览统计
/api/delivery/statistics/distance?startTime={startTime}&endTime={endTime} Get 距离统计
/api/delivery/statistics/efficiency?startTime={startTime}&endTime={endTime} Get 效率统计
/api/delivery/statistics/leader Get 团长配送统计

表 4-8 团长服务接口
操作 Http方法 功能
/api/community/nearest?latitude={latitude}&longitude={longitude} Get 匹配最近的社区
/api/community/list Get 查询所有社区
/api/community/{communityId} Get 查询社区详情
/api/admin/community Post 创建社区
/api/admin/community/{communityId} Put 更新社区
/api/admin/community/{communityId} Delete 删除社区
/api/community-application Post 提交社区申请
/api/community-application/my?userId={userId} Get 查询我的申请记录
/api/community-application/{applicationId} Get 查询申请详情
/api/community-application/{applicationId}/review Post 审核申请
/api/community-application/pending Get 查询待审核申请
/api/leader/apply Post 提交团长申请
/api/leader/my?userId={userId} Get 查询我的团长信息
/api/leader/community/{communityId} Get 查询社区的团长列表
/api/leader/{storeId} Get 查询团长详情
/api/leader/{storeId} Put 更新团点信息
/api/leader/{storeId}/review Post 审核团长申请
/api/leader/pending Get 查询待审核申请
/api/leader/{storeId}/disable Post 停用团长
/api/commission/my?leaderId={leaderId} Get 查询我的佣金记录
/api/commission/my/summary?leaderId={leaderId} Get 查询佣金统计
/api/commission/pending Get 查询待结算佣金
/api/commission/batch/{settlementBatch} Get 查询结算批次
/api/commission/settle Post 手动结算佣金
/feign/community/{communityId} Get 获取社区信息
/feign/community/nearest?latitude={latitude}&longitude={longitude} Get 匹配最近的社区
/feign/community/exists/{communityId} Get 验证社区是否存在
/feign/leader/{leaderId} Get 获取团长信息
/feign/community/{communityId}/leaders Get 查询社区的团长列表
/feign/leader/check/{userId} Get 验证是否是团长
/feign/commission/generate Post 生成佣金记录
/feign/commission/pending/{leaderId} Get 查询待结算佣金

### 4.4.2 第三方接口

本系统基于 Spring Boot + Vue3 开发，为实现核心业务功能与智能扩展能力，集成了第三方接口，涵盖地图服务、支付服务，各接口的用途、集成方式及核心参数如下：

#### 4.4.2.1 地图服务接口

采用高德地图开放平台地理编码/逆地理编码接口，核心用于实现配送地址解析与坐标定位功能。接口用途为将用户输入的文本地址转换为精确的经纬度坐标，为Dijkstra路径规划算法提供节点位置数据；支持在前端Vue页面加载社区自提点、仓库位置的2D地图展示；实现配送路线可视化，显示优化后配送路径及预计耗时。

本核心参数与调用方式如下表 6-1 所示：

**表 6-1 地图服务接口核心参数与调用方式表**

| 接口类型       | 请求方式 | 核心请求参数                             | 核心返回参数                                                    |
| -------------- | -------- | ---------------------------------------- | --------------------------------------------------------------- |
| 地理编码接口   | GET      | key（开发者密钥）、address（地址字符串） | location（经纬度坐标）、formatted_address（标准化地址）         |
| 逆地理编码接口 | GET      | key（开发者密钥）、location（经度,纬度） | formatted_address（详细地址）、addressComponent（地址组成要素） |

#### 4.4.2.2 支付服务接口

采用微信支付官方SDK（JAVA版本），核心用于实现拼团订单的支付流程。接口用途为生成预付单并调用微信支付接口；接收支付结果异步通知，自动更新订单状态为"已支付"；实现退款处理功能，保障用户售后权益。

本核心参数与调用方式如下表 6-2 所示：

**表 6-2 支付服务接口核心参数与调用方式表**

| 接口类型         | 请求方式 | 核心请求参数                                                                                             | 核心返回参数                                  |
| ---------------- | -------- | -------------------------------------------------------------------------------------------------------- | --------------------------------------------- |
| 统一下单接口     | POST     | appid（应用ID）、mch_id（商户号）、out_trade_no（商户订单号）、total_fee（金额）、notify_url（回调地址） | prepay_id（预支付ID）、trade_type（交易类型） |
| 支付结果通知接口 | POST     | return_code（返回状态）、result_code（业务结果）、out_trade_no（商户订单号）                             | 无需返回参数，系统根据通知更新订单状态        |

## 4.5 运行设计

### 4.5.1 运行模块组合

在本系统中，前端Vue3应用作为客户端，通过Axios库实现与后端微服务的HTTP通信。前端应用配备了数据监听和路由守卫功能，用户操作触发数据变化时，通过各组件间的响应式数据绑定和状态管理机制，自动更新界面显示。在前端组件接收用户输入后，通过表单验证和数据格式化处理，确保数据符合后端接口要求。随后调用网络请求模块，将数据通过HTTP/HTTPS协议发送至API Gateway，并等待服务器响应。前端接收到返回数据后，通过状态管理器更新应用状态，并通过组件重新渲染展示相应的界面信息。

后端采用微服务架构，API Gateway作为统一入口，通过Consul服务发现机制路由请求到相应的微服务。Gateway接收到前端请求后，首先进行JWT身份认证和权限校验，通过后将请求转发给对应的微服务。各个微服务（如UserService、ProductService、OrderService等）采用Spring Boot框架，内嵌Tomcat容器持续监听网络请求。接收到Gateway转发的请求后，根据RESTful API路径和参数，调用相应的业务处理模块进行数据验证、业务逻辑处理和数据库操作。处理完成后，通过Feign客户端实现微服务间的内部调用（如支付成功后通知拼团服务），最终将处理结果层层返回至前端。同时，整个系统通过Spring Cloud Sleuth实现分布式链路追踪，确保请求在微服务间的可观测性。

### 4.5.2 运行控制

运行控制基于微服务架构下的模块化设计，通过标准化的RESTful接口协议和Feign声明式调用实现各模块间的协同工作。在前端层面，Vue Router实现页面级路由控制，Pinia状态管理器维护全局状态，路由守卫确保用户权限验证通过后才能访问受保护页面。在网络传输层面，前端通过Axios拦截器统一处理请求头（添加JWT Token）和响应处理，确保通信的安全性和一致性。

后端层面采用分层架构设计，Controller层负责接口暴露和参数校验，Service层实现业务逻辑，Repository层处理数据访问。各微服务间通过OpenFeign实现声明式服务调用，配置了熔断器和重试机制确保服务调用的可靠性。Consul作为服务注册中心，实时监控各微服务实例的健康状态，实现负载均衡和故障转移。数据库层面采用连接池和事务管理，确保数据操作的原子性和一致性。任何环节出现异常，都会通过全局异常处理器统一捕获并返回标准化的错误响应。

### 4.5.3 运行时间

系统运行时间受多方面因素制约，包括网络传输延迟、服务器处理性能、数据库查询效率和前端渲染速度等。针对高并发场景，系统采用多层优化策略：前端通过CDN加速静态资源加载，API Gateway实现请求限流和缓存，后端微服务采用异步处理和线程池优化，数据库配置索引和查询优化。为应对网络负载峰值，系统设计了弹性扩容机制，可根据请求量动态调整微服务实例数量。同时，通过分布式缓存和数据库读写分离，进一步提升系统响应速度。经测试，系统核心业务接口响应时间控制在500毫秒以内，页面加载时间不超过2秒，满足社区团购业务的实时性要求。

# 4.6 系统出错处理设计

## 4.6.1 出错信息

本系统中出错信息设计如下表 4-6 所示：

**表4-6 出错信息表**

| 出错名称         | 系统输出信息                     | 处理方法                                     |
| ---------------- | -------------------------------- | -------------------------------------------- |
| 用户名或密码错误 | "用户名或密码错误"               | 清空输入，提示用户名或密码错误，重新刷新页面 |
| 用户不存在       | "用户不存在"                     | 提示用户不存在，引导用户注册或检查输入       |
| 用户已被禁用     | "账户已被禁用"                   | 提示账户已被禁用，联系管理员处理             |
| 密码错误         | "密码错误"                       | 清空密码输入框，提示密码错误，可重新输入     |
| 手机号已存在     | "该手机号已注册"                 | 提示手机号已存在，引导用户使用其他手机号     |
| 商品不存在       | "商品不存在"                     | 提示商品不存在，返回商品列表页面             |
| 商品已下架       | "商品已下架"                     | 提示商品已下架，引导浏览其他商品             |
| 库存不足         | "库存不足"                       | 显示剩余库存数量，提示库存不足，调整购买数量 |
| 拼团活动不存在   | "拼团活动不存在"                 | 提示活动不存在，返回活动列表页面             |
| 拼团活动已结束   | "拼团活动已结束"                 | 提示活动已结束，引导参与其他活动             |
| 拼团人数已满     | "拼团人数已满"                   | 提示人数已满，无法加入该拼团                 |
| 订单不存在       | "订单不存在"                     | 提示订单不存在，返回订单列表页面             |
| 订单状态异常     | "订单状态异常"                   | 提示订单状态异常，刷新页面重新查看           |
| 支付失败         | "支付失败"                       | 提示支付失败原因，可重新尝试支付             |
| 余额不足         | "余额不足"                       | 提示余额不足，引导用户充值                   |
| 团长不存在       | "团长不存在"                     | 提示团长不存在，选择其他团长                 |
| 社区不存在       | "社区不存在"                     | 提示社区不存在，选择其他社区                 |
| 参数验证失败     | "输入格式不正确，请检查后再输入" | 红色提示信息，标出具体错误字段               |
| 必填项为空       | "该项为必填项"                   | 提示不能为空，标出必填字段                   |
| 请求超时         | "请求超时，请检查网络连接"       | 检查网络连接，重新尝试操作                   |
| 网络连接失败     | "网络连接失败，请检查网络"       | 检查网络设置，重新连接网络                   |
| 服务暂时不可用   | "服务暂时不可用，请稍后重试"     | 等待服务恢复，稍后重试操作                   |
| 服务器内部错误   | "服务器内部错误，请稍后重试"     | 提示系统异常，稍后重试或联系管理员           |
| 未授权访问       | "登录已过期，请重新登录"         | 弹出登录提示，跳转到登录页面                 |

## 4.6.2 补救措施

为保障社区团购系统的稳定运行和高可用性，系统实施了多层次的出错处理和补救机制：

### 1. 用户数据安全保障

用户的数据需要定期进行备份，最好进行多服务器备份，这样一旦一台服务器宕机，另外一台就能立即启用。管理员应定期更新系统补丁，并升级杀毒软件防止病毒与恶意网站。

### 2. 日志系统监控

启用双轨制日志系统，支持业务操作日志记录和系统异常日志记录。一旦服务器宕机，也能够通过日志快速查错，及时使系统再次运作。系统会记录所有关键操作的详细信息，包括操作时间、操作人、操作内容、操作结果和错误信息，便于问题排查和审计。

### 3. 微服务架构容错机制

采用微服务架构设计，当部分服务出现问题时，不影响其他服务的正常运行。通过Consul服务注册与发现机制，实现服务的自动故障转移和负载均衡。当某个微服务实例宕机时，系统能够自动将请求路由到其他可用实例，确保服务的连续性。

### 4. 集群部署和高可用保障

实施集群部署策略，在一台服务器失去作用时，使其他服务器可以承担压力。通过Docker容器化技术和Kubernetes编排系统，实现服务的自动伸缩和故障恢复。系统采用主从复制和读写分离的数据库架构，确保数据的一致性和高可用性。

### 5. 数据库连接池和事务管理

配置数据库连接池，避免频繁创建和销毁数据库连接导致的性能问题。采用Spring事务管理机制，确保数据操作的原子性和一致性。当数据库操作失败时，系统会自动回滚事务，防止数据不一致问题。

### 6. 前端容错处理

前端采用统一的请求拦截器和响应拦截器，对网络异常、请求超时等情况进行统一处理。实现请求重试机制，对于临时性网络故障自动重试。对于用户输入验证失败的情况，实时给出友好的错误提示，引导用户正确操作。

### 7. 支付安全保障

在支付环节采用多重安全措施，包括HTTPS加密传输、AES数据加密、SHA256签名验证等。当支付失败时，系统会记录详细的失败原因，并提供多种支付方式的备选方案，确保用户支付体验的连续性。

### 8. 监控预警机制

集成应用性能监控(APM)系统，实时监控系统运行状态、响应时间、错误率等关键指标。当系统出现异常时，自动触发预警通知，管理员可以及时介入处理。同时，系统支持灰度发布和滚动更新，降低发布过程中的风险。

通过以上多层次的出错处理和补救措施，系统能够有效应对各种异常情况，确保社区团购平台的稳定运行和良好的用户体验。

---

# 5 数据库设计说明

## 5.1 数据库实体与联系

### 5.1.1 外部设计

本系统基于MySQL作为主要的数据库开发平台，采用微服务架构设计原则，按服务拆分数据库，共创建了7个独立的数据库，总共20张表，每个微服务对应一个独立数据库，避免服务间直接访问对方数据库，降低耦合度。

各数据库及其对应的微服务信息如下表所示：

**表5-1 微服务数据库映射关系表**

| 数据库名称          | 对应微服务      | 端口 | 包含表数 | 表名列表                                                                |
| ------------------- | --------------- | ---- | -------- | ----------------------------------------------------------------------- |
| user_service_db     | UserService     | 8061 | 5张      | sys_user、user_address、user_account、user_feedback、sys_operation_log  |
| product_service_db  | ProductService  | 8062 | 2张      | product_category、product                                               |
| groupbuy_service_db | GroupBuyService | 8063 | 3张      | group_buy、group_buy_team、group_buy_member                             |
| order_service_db    | OrderService    | 8065 | 3张      | shopping_cart、order_main、order_item                                   |
| payment_service_db  | PaymentService  | 8066 | 1张      | payment_record                                                          |
| delivery_service_db | DeliveryService | 8067 | 2张      | delivery、warehouse_config                                              |
| leader_service_db   | LeaderService   | 8068 | 4张      | group_leader_store、commission_record、community、community_application |

**总计**: 7个数据库，20张表，10个物理外键

各数据库采用统一的字符集utf8mb4和排序规则utf8mb4_0900_ai_ci。各微服务通过独立的数据库连接配置访问对应数据库，严格禁止跨库直接访问，服务间数据交互通过HTTP REST API实现

### 5.1.2 约定

（1）数据库名规范
在定义数据库名称的过程中，所有标识符均使用小写字母，并通过下划线连接各个单词，确保名称长度不超过32个字符。名称设计需直观反映其含义，严禁混合使用拼音和英文，确保名称的明确性和规范性。因此数据库名称格式："\{服务名\}_service_db"，清晰反映数据库与微服务的对应关系。

（2）数据库表名规范
数据库表的命名应直接反映其存储内容或用途，并采用下划线连接各个单词以确保名称的清晰度和一致性。表名统一使用小写字母，避免使用复数形式。

（3）数据库字段名规范
在为数据库字段命名时，名称应结合字段的含义，并使用下划线来区分名称中的不同部分。字段名统一使用小写字母，避免使用MySQL保留字。

### 5.1.3 结构设计

本系统通过对社区团购业务流程的分析，抽象出以下核心实体。这些实体均是系统运行中需要持久化存储的核心数据对象，并为多个功能模块提供服务。

本系统中实体集如下表所示：

**表 5-2 本系统实体集**

| 实体集名称   | 内容                                                                                                                                        | 标识码 |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| 用户         | id，用户名，密码，角色，真实姓名，手机号，头像，状态                                                                                        | id     |
| 用户地址     | id，用户id，收货人，联系电话，省份，城市，区县，详细地址，经度，纬度，是否默认地址                                                                      | id     |
| 商品分类     | id，父分类ID，分类名称，排序权重，状态                                                                                                                | id     |
| 商品         | id，分类ID，商品名称，封面图，商品详情，原价，拼团参考价，库存，状态，创建时间，更新时间                                                                                      | id     |
| 团长团点     | id，团长id，团点名称，省份，城市，区县，详细地址，审核状态，佣金比例                                                                        | id     |
| 拼团活动     | id，商品id，团长id，拼团价，成团人数，开始时间，结束时间，状态                                                                              | id     |
| 购物车       | id，用户id，商品id，活动id，数量，添加时间                                                                                                  | id     |
| 配送单       | id，团长ID，分单组，配送模式，仓库ID，订单ID列表，途经点数据，最优路径，配送距离，预估时长，状态，创建人ID，创建时间，更新时间                                                                            | id     |
| 订单主表     | id，用户id，团长id，订单编号，总金额，实付金额，订单状态，支付状态，收货地址id，配送单id                                                    | id     |
| 订单项       | id，订单id，商品id，活动id，商品名称，商品图片，单价，数量，小计金额                                                                        | id     |
| 支付记录     | id，用户ID，订单ID，支付类型，金额，支付状态，第三方流水号，微信流水号，支付回调信息，加密签名，创建时间                                                                                      | id     |
| 用户账户     | id，用户id，余额，冻结金额                                                                                                                  | id     |
| 佣金记录     | id，团长ID，订单ID，订单金额，佣金比例，佣金金额，状态，结算时间，结算批次，备注，创建时间                                                                                                | id     |
| 系统操作日志 | id，用户id，操作内容，操作模块，操作IP，操作时间                                                                                            | id     |
| 用户反馈     | id，用户id，反馈类型，反馈内容，图片，处理状态，处理意见                                                                                    | id     |
| 社区         | id，社区名称，省份，城市，区县，详细地址，经度，纬度，服务半径，状态，描述，创建时间，更新时间                                                                        | id     |
| 社区申请     | id，申请人ID，申请人姓名，申请人手机号，社区名称，省份，城市，区县，详细地址，经度，纬度，服务半径，描述，申请理由，审核状态，审核人ID，审核意见，审核时间，创建时间，更新时间 | id     |
| 团实例       | id，团号，活动 id，发起人 id，团长 id，社区 id，成团人数，当前人数，团状态，成团时间，过期时间，创建时间                                    | id     |
| 参团记录     | id，团ID，用户ID，订单ID，是否发起者，商品数量，支付金额，参团时间，状态                                                                           | id     |

通过分析本系统中实体集关系，可得本系统中联系集如下表所示：

**表 5-3 本系统联系集**

| 联系集 | 关系实体           | 构成关系 | 表示码                |
| ------ | ------------------ | -------- | --------------------- |
| 归属   | 用户与社区         | n:1      | community_id          |
| 归属   | 团长团点与社区     | n:1      | community_id          |
| 归属   | 团实例与社区       | n:1      | community_id          |
| 生成   | 社区申请与社区     | 1:1      | approved_community_id |
| 提交   | 用户与社区申请     | 1:n      | applicant_id          |
| 审核   | 用户与社区申请     | 1:n      | auditor_id            |
| 拥有   | 用户与用户地址     | 1:n      | user_id               |
| 拥有   | 用户与用户账户     | 1:1      | user_id               |
| 提交   | 用户与用户反馈     | 1:n      | user_id               |
| 记录   | 用户与系统操作日志 | 1:n      | user_id               |
| 归属   | 商品与商品分类     | n:1      | category_id           |
| 管理   | 用户与团长团点     | 1:1      | leader_id             |
| 依托   | 拼团活动与商品     | n:1      | product_id            |
| 发起   | 拼团活动与团实例   | 1:n      | activity_id           |
| 发起   | 用户与团实例       | 1:n      | launcher_id           |
| 负责   | 用户与团实例       | 1:n      | leader_id             |
| 包含   | 团实例与参团记录   | 1:n      | team_id               |
| 参与   | 用户与参团记录     | 1:n      | user_id               |
| 关联   | 参团记录与订单     | 1:1      | order_id              |
| 存放   | 用户与购物车       | 1:n      | user_id               |
| 选择   | 购物车与商品       | n:1      | product_id            |
| 关联   | 购物车与拼团活动   | n:1      | activity_id           |
| 生成   | 用户与订单         | 1:n      | user_id               |
| 负责   | 用户与订单         | 1:n      | leader_id             |
| 使用   | 订单与用户地址     | n:1      | receive_address_id    |
| 包含   | 订单与订单项       | 1:n      | order_id              |
| 引用   | 订单项与商品       | n:1      | product_id            |
| 引用   | 订单项与拼团活动   | n:1      | activity_id           |
| 配送   | 配送单与订单       | 1:n      | delivery_id           |
| 负责   | 用户与配送单       | 1:n      | leader_id             |
| 支付   | 用户与支付记录     | 1:n      | user_id               |
| 关联   | 订单与支付记录     | 1:1      | order_id              |
| 计算   | 用户与佣金记录     | 1:n      | leader_id             |
| 触发   | 订单与佣金记录     | 1:1      | order_id              |

## 5.2 E-R图

**图 5-1 E-R 图**

## 5.3 数据库逻辑结构设计

根据 E-R 模型转换，将图 5-1 所示的 E-R 图转为逻辑结构如下所示：

社区（社区 ID，社区名称，省份，城市，区县，详细地址，经度，纬度，服务半径，状态，描述，创建时间，更新时间）

社区申请（申请 ID，申请人 ID，申请人姓名，申请人手机号，社区名称，省份，城市，区县，详细地址，经度，纬度，服务半径，描述，申请理由，审核状态，审核人 ID，审核意见，审核时间，创建时间，更新时间）

用户（用户 ID，用户名，密码，角色，真实姓名，手机号，微信 OpenID，头像，社区 ID，状态，创建时间，更新时间）

用户地址（地址 ID，用户 ID，收货人，联系电话，省份，城市，区县，详细地址，经度，纬度，是否默认地址）

用户账户（账户 ID，用户 ID，可用余额，冻结金额，更新时间）

用户反馈（反馈 ID，用户 ID，反馈类型，反馈内容，图片，处理状态，处理意见，处理时间，创建时间，更新时间）

商品分类（分类 ID，父分类 ID，分类名称，排序权重，状态）

商品（商品 ID，分类 ID，商品名称，封面图，商品详情，原价，拼团参考价，库存，状态，创建时间，更新时间）

团长团点（团点 ID，团长 ID，团点名称，省份，城市，区县，详细地址，经度，纬度，社区 ID，最大配送范围，审核状态，审核时间，佣金比例）

拼团活动（活动 ID，商品 ID，拼团价，成团人数，最大参团人数，开始时间，结束时间，状态，二维码 URL，专属链接，创建时间）

团实例（团 ID，团号，活动 ID，发起人 ID，团长 ID，社区 ID，成团人数，当前人数，团状态，成团时间，过期时间，创建时间）

参团记录（参团 ID，团 ID，用户 ID，订单 ID，是否发起者，商品数量，支付金额，参团时间，状态）

购物车（购物车 ID，用户 ID，商品 ID，活动 ID，数量，添加时间，更新时间）

订单主表（订单 ID，用户 ID，团长 ID，订单编号，商品总金额，优惠金额，实付金额，订单状态，支付状态，支付时间，收货地址 ID，分单组，配送单 ID，创建时间，更新时间）

订单项（订单项 ID，订单 ID，商品 ID，活动 ID，商品名称，商品图片，单价，数量，小计金额）

配送单（配送单 ID，团长 ID，分单组，配送模式，仓库 ID，订单 ID 列表，途经点数据，最优路径，配送距离，预估时长，状态，创建人 ID，创建时间，更新时间）

支付记录（支付记录 ID，用户 ID，订单 ID，支付类型，金额，状态，第三方流水号，微信流水号，支付回调信息，加密签名，创建时间）

佣金记录（佣金 ID，团长 ID，订单 ID，订单金额，佣金比例，佣金金额，状态，结算时间，结算批次，备注，创建时间）

系统操作日志（日志 ID，用户 ID，操作人用户名，操作内容，操作模块，操作方法名，请求参数，操作结果，错误信息，执行时长，操作 IP，操作时间）

仓库配置（仓库 ID，仓库名称，地址，经度，纬度，是否默认，状态，联系人，联系电话，描述，创建时间，更新时间）

## 5.4 数据库详细设计

本系统采用微服务架构，共设计7个独立数据库，包含20张数据表。各表分布如下：user_service_db（用户服务数据库，5张表）、product_service_db（商品服务数据库，2张表）、groupbuy_service_db（拼团服务数据库，3张表）、order_service_db（订单服务数据库，3张表）、payment_service_db（支付服务数据库，1张表）、delivery_service_db（配送服务数据库，2张表）、leader_service_db（团长服务数据库，4张表）。各表详细结构如下表5-4至5-23所示：

**表5-4 community（社区表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | community_id | 社区ID | bigint | 主键 | 自增 | 自增主键，唯一标识社区 |
| 2 | community_name | 社区名称 | varchar(100) | | 非空 | 社区显示名称 |
| 3 | province | 省份 | varchar(20) | | 非空 | 社区所在省份 |
| 4 | city | 城市 | varchar(20) | | 非空 | 社区所在城市 |
| 5 | district | 区/县 | varchar(20) | | 非空 | 社区所在区县 |
| 6 | address | 详细地址 | varchar(255) | | 非空 | 社区具体地址 |
| 7 | latitude | 社区中心纬度 | decimal(10,6) | | 非空 | 地理坐标纬度，路径规划使用 |
| 8 | longitude | 社区中心经度 | decimal(10,6) | | 非空 | 地理坐标经度，路径规划使用 |
| 9 | service_radius | 服务半径 | int | | 非空 | 默认3000米，服务范围半径 |
| 10 | status | 状态 | int | | 非空 | 0-待审核；1-正常运营；2-已关闭，默认1 |
| 11 | description | 社区简介 | varchar(500) | | | 可选，社区详细介绍 |
| 12 | created_at | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 13 | updated_at | 更新时间 | datetime | | 非空 | 默认当前时间，更新时自动修改 |

**表5-5 community_application（社区申请表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | application_id | 申请ID | bigint | 主键 | 自增 | 自增主键，唯一标识申请记录 |
| 2 | applicant_id | 申请人ID | bigint | 外键 | 非空 | 团长申请人，跨库关联sys_user表 |
| 3 | applicant_name | 申请人姓名 | varchar(50) | | 冗余 | 从用户表冗余，方便查询 |
| 4 | applicant_phone | 申请人手机号 | varchar(20) | | 冗余 | 从用户表冗余，方便查询 |
| 5 | community_name | 社区名称 | varchar(100) | | 非空 | 申请创建的社区名称 |
| 6 | province | 省份 | varchar(20) | | 非空 | 申请社区所在省份 |
| 7 | city | 城市 | varchar(20) | | 非空 | 申请社区所在城市 |
| 8 | district | 区/县 | varchar(20) | | 非空 | 申请社区所在区县 |
| 9 | address | 详细地址 | varchar(255) | | 非空 | 申请社区具体地址 |
| 10 | latitude | 纬度 | decimal(10,6) | | 非空 | 申请社区纬度坐标 |
| 11 | longitude | 经度 | decimal(10,6) | | 非空 | 申请社区经度坐标 |
| 12 | service_radius | 服务半径 | int | | 非空 | 默认3000米，服务范围半径 |
| 13 | description | 社区简介 | varchar(500) | | | 可选，社区详细介绍 |
| 14 | application_reason | 申请理由 | varchar(500) | | | 可选，申请人提交的理由说明 |
| 15 | status | 审核状态 | int | | 非空 | 0-待审核；1-审核通过；2-审核拒绝，默认0 |
| 16 | reviewer_id | 审核人ID | bigint | 外键 | | 管理员ID，跨库关联sys_user表 |
| 17 | review_comment | 审核意见 | varchar(500) | | | 审核人填写，通过或拒绝理由 |
| 18 | reviewed_at | 审核时间 | datetime | | | 审核完成时间 |
| 19 | created_at | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 20 | updated_at | 更新时间 | datetime | | 非空 | 默认当前时间，更新时自动修改 |

**表5-6 sys_user（用户表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | user_id | 用户ID | bigint | 主键 | 自增 | 自增主键，唯一标识用户 |
| 2 | username | 用户名 | varchar(50) | 唯一 | 非空 | 登录账号，唯一 |
| 3 | password | 密码 | varchar(100) | | 非空 | SHA256加密存储 |
| 4 | role | 角色 | int | | 非空 | 1-普通用户；2-团长；3-管理员 |
| 5 | real_name | 真实姓名 | varchar(50) | | | 可选，用户真实姓名 |
| 6 | phone | 手机号 | varchar(128) | 唯一 | AES加密存储 | 可选，AES加密存储 |
| 7 | wx_openid | 微信OpenID | varchar(100) | 唯一 | | 可选，微信唯一标识 |
| 8 | avatar | 头像URL | varchar(255) | | | 可选，用户头像网络地址 |
| 9 | community_id | 归属社区ID | bigint | 外键 | | 可选，用户所属社区，关联community表 |
| 10 | status | 状态 | int | | 非空 | 0-禁用；1-正常，默认1 |
| 11 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 12 | update_time | 更新时间 | datetime | | | 用户信息最后修改时间 |

**表5-7 user_address（用户地址表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | address_id | 地址ID | bigint | 主键 | 自增 | 自增主键，唯一标识地址 |
| 2 | user_id | 用户ID | bigint | 外键 | 非空 | 地址所属用户，关联sys_user表 |
| 3 | receiver | 收件人 | varchar(50) | | 非空 | 收货人姓名 |
| 4 | phone | 收件人电话 | varchar(128) | | 非空 | AES加密存储 |
| 5 | province | 省份 | varchar(20) | | 非空 | 收货地址省份 |
| 6 | city | 城市 | varchar(20) | | 非空 | 收货地址城市 |
| 7 | district | 区/县 | varchar(20) | | 非空 | 收货地址区县 |
| 8 | detail | 详细地址 | varchar(255) | | 非空 | 收货具体地址 |
| 9 | longitude | 地址经度 | decimal(10,6) | | 非空 | Dijkstra算法输入参数 |
| 10 | latitude | 地址纬度 | decimal(10,6) | | 非空 | Dijkstra算法输入参数 |
| 11 | is_default | 是否默认 | int | | 非空 | 0-否；1-是，默认收货地址标识 |

**表5-8 user_account（用户账户表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | account_id | 账户ID | bigint | 主键 | 自增 | 自增主键，唯一标识账户 |
| 2 | user_id | 用户ID | bigint | 外键 | 非空 | 账户所属用户，关联sys_user表，唯一 |
| 3 | balance | 可用余额 | decimal(10,2) | | 非空 | 默认0.00，可用于支付 |
| 4 | freeze_amount | 冻结金额 | decimal(10,2) | | 非空 | 默认0.00，未结算佣金/退款中等金额 |
| 5 | update_time | 更新时间 | datetime | | 非空 | 默认当前时间，更新时自动修改 |

**表5-9 user_feedback（用户反馈表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | feedback_id | 反馈ID | bigint | 主键 | 自增 | 自增主键，唯一标识反馈记录 |
| 2 | user_id | 用户ID | bigint | 外键 | 非空 | 反馈所属用户，关联sys_user表 |
| 3 | type | 反馈类型 | int | | 非空 | 1-功能问题；2-商品问题；3-配送问题；4-支付问题；5-其他 |
| 4 | content | 反馈内容 | text | | 非空 | 用户反馈详情 |
| 5 | images | 图片URL | text | | | 可选，多张用逗号分隔 |
| 6 | status | 处理状态 | int | | 非空 | 0-待处理；1-处理中；2-已解决；3-已关闭 |
| 7 | reply | 处理意见 | text | | | 可选，管理员回复内容 |
| 8 | reply_time | 处理时间 | datetime | | | 管理员处理完成时间 |
| 9 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 10 | update_time | 更新时间 | datetime | | | 更新时自动修改 |

**表5-10 product_category（商品分类表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | category_id | 分类ID | bigint | 主键 | | 自增 |
| 2 | parent_id | 父分类ID | bigint | | 非空 | 默认0，顶级分类为0 |
| 3 | category_name | 分类名称 | varchar(50) | | 非空 | 商品分类显示名称 |
| 4 | sort | 排序权重 | int | | 非空 | 值越小越靠前，默认0 |
| 5 | status | 状态 | tinyint | | 非空 | 0-禁用；1-启用，默认1 |

**表5-11 product（商品表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | product_id | 商品ID | bigint | 主键 | | 自增 |
| 2 | category_id | 关联分类ID | bigint | 外键 | | 可选，商品所属分类 |
| 3 | product_name | 商品名称 | varchar(100) | | 非空 | 商品显示名称 |
| 4 | cover_img | 封面图URL | varchar(255) | | 非空 | 商品封面图片地址 |
| 5 | detail | 商品详情 | text | | | 富文本 |
| 6 | price | 原价 | decimal(10,2) | | 非空 | 商品原始价格 |
| 7 | group_price | 拼团参考价 | decimal(10,2) | | | 可被活动覆盖 |
| 8 | stock | 库存数量 | int | | 非空 | 默认0 |
| 9 | status | 状态 | tinyint | | 非空 | 0-下架；1-上架，默认1 |
| 10 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 11 | update_time | 更新时间 | datetime | | | 更新时自动修改 |

**表5-12 group_leader_store（团长团点表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | store_id | 团点ID | bigint | 主键 | | 自增 |
| 2 | leader_id | 关联团长用户ID | bigint | 外键 | 非空 | role=2，跨库关联，一个团长只有一个团点 |
| 3 | leader_name | 团长姓名 | varchar(50) | | | 冗余 |
| 4 | leader_phone | 团长手机号 | varchar(20) | | | 冗余 |
| 5 | community_id | 归属社区ID | bigint | 外键 | 非空 | 团长所属社区 |
| 6 | community_name | 社区名称 | varchar(100) | | | 冗余 |
| 7 | store_name | 团点名称 | varchar(100) | | | 可选，团点显示名称 |
| 8 | province | 所在省份 | varchar(20) | | | 可选，团点省份 |
| 9 | city | 所在城市 | varchar(20) | | | 可选，团点城市 |
| 10 | district | 所在区/县 | varchar(20) | | | 可选，团点区县 |
| 11 | address | 团点地址 | varchar(255) | | | 可选，团点详细地址 |
| 12 | detail_address | 详细地址 | varchar(255) | | | 可选，团点具体地址 |
| 13 | longitude | 团点经度 | decimal(10,6) | | | 可选，路径计算起点 |
| 14 | latitude | 团点纬度 | decimal(10,6) | | | 可选，路径计算起点 |
| 15 | max_delivery_range | 最大配送范围 | int | | 非空 | 默认3000米，分单逻辑依据 |
| 16 | description | 团点简介 | varchar(500) | | | 可选，团点详细介绍 |
| 17 | commission_rate | 佣金比例 | decimal(5,2) | | 非空 | 默认10.00% |
| 18 | total_commission | 累计佣金 | decimal(10,2) | | 非空 | 默认0.00 |
| 19 | status | 状态 | int | | 非空 | 0-待审核；1-正常运营；2-已停用 |
| 20 | reviewer_id | 审核人ID | bigint | 外键 | | 跨库关联 |
| 21 | review_comment | 审核意见 | varchar(500) | | | 审核人填写意见 |
| 22 | reviewed_at | 审核时间 | datetime | | | 团点审核完成时间 |
| 23 | created_at | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 24 | updated_at | 更新时间 | datetime | | 非空 | 默认当前时间，更新时自动修改 |

**表5-13 group_buy（拼团活动表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | activity_id | 活动ID | bigint | 主键 | 自增 | 自增主键，唯一标识拼团活动 |
| 2 | product_id | 关联商品ID | bigint | 外键 | 非空 | 拼团商品，跨库关联product表 |
| 3 | group_price | 拼团价 | decimal(10,2) | | 非空 | 拼团活动价格 |
| 4 | required_num | 成团人数 | int | | 非空 | 默认2，最少成团人数 |
| 5 | max_num | 最大参团人数 | int | | | 无限制为NULL，最大允许参团人数 |
| 6 | start_time | 开始时间 | datetime | | 非空 | 拼团活动开始时间 |
| 7 | end_time | 结束时间 | datetime | | 非空 | 拼团活动结束时间 |
| 8 | status | 状态 | tinyint | | 非空 | 0-未开始；1-进行中；2-已结束；3-异常，默认1 |
| 9 | qrcode_url | 二维码URL | varchar(255) | | | 可选，活动推广二维码 |
| 10 | link | 专属链接 | varchar(255) | 唯一 | 非空 | 活动推广链接，唯一 |
| 11 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |

**表5-14 group_buy_team（团实例表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | team_id | 团ID | bigint | 主键 | 自增 | 自增主键，唯一标识团实例 |
| 2 | team_no | 团号 | varchar(32) | 唯一 | 非空 | 格式：T+yyyyMMdd+6位随机数，唯一 |
| 3 | activity_id | 关联活动ID | bigint | 外键 | 非空 | 团实例所属活动，关联group_buy表 |
| 4 | launcher_id | 发起人ID | bigint | 外键 | 非空 | 团发起人，跨库关联sys_user表 |
| 5 | leader_id | 归属团长ID | bigint | 外键 | 非空 | 配送团点，跨库关联group_leader_store表 |
| 6 | community_id | 归属社区ID | bigint | 外键 | | 所属社区，跨库关联community表 |
| 7 | required_num | 成团人数 | int | | 非空 | 从活动复制，最少成团人数 |
| 8 | current_num | 当前参团人数 | int | | 非空 | 默认0，当前已参团人数 |
| 9 | team_status | 团状态 | tinyint | | 非空 | 0-拼团中；1-已成团；2-已失败，默认0 |
| 10 | success_time | 成团时间 | datetime | | | 拼团成功时记录 |
| 11 | expire_time | 过期时间 | datetime | | 非空 | 24小时后自动过期 |
| 12 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |

**表5-15 group_buy_member（参团记录表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | member_id | 参团记录ID | bigint | 主键 | | 自增 |
| 2 | team_id | 关联团实例ID | bigint | 外键 | 非空 | 用户参与的团实例 |
| 3 | user_id | 参团用户ID | bigint | 外键 | 非空 | 跨库关联 |
| 4 | order_id | 关联订单ID | bigint | 外键 | | 跨库关联 |
| 5 | is_launcher | 是否发起人 | tinyint | | 非空 | 0-否；1-是，默认0 |
| 6 | product_quantity | 购买商品数量 | int | | 非空 | 默认1 |
| 7 | pay_amount | 支付金额 | decimal(10,2) | | 非空 | 用户实际支付金额 |
| 8 | join_time | 参团时间 | datetime | | 非空 | 默认当前时间 |
| 9 | status | 状态 | tinyint | | 非空 | 0-待支付；1-已支付；2-已成团；3-已取消，默认0 |

**表5-16 shopping_cart（购物车表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | cart_id | 购物车ID | bigint | 主键 | | 自增 |
| 2 | user_id | 关联用户ID | bigint | 外键 | 非空 | 跨库关联 |
| 3 | product_id | 关联商品ID | bigint | 外键 | 非空 | 跨库关联 |
| 4 | activity_id | 关联活动ID | bigint | 外键 | | 非拼团为NULL，跨库关联 |
| 5 | quantity | 数量 | int | | 非空 | 默认1 |
| 6 | add_time | 添加时间 | datetime | | 非空 | 默认当前时间 |
| 7 | update_time | 更新时间 | datetime | | | 更新时自动修改 |

**表5-17 order_main（订单主表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | order_id | 订单ID | bigint | 主键 | | 自增 |
| 2 | user_id | 下单用户ID | bigint | 外键 | 非空 | 跨库关联 |
| 3 | leader_id | 取货团长ID | bigint | 外键 | 非空 | 跨库关联 |
| 4 | order_sn | 订单编号 | varchar(50) | 唯一 | 非空 | 格式：yyyyMMddHHmmss+6位随机数 |
| 5 | total_amount | 商品总金额 | decimal(10,2) | | 非空 | 订单商品总价 |
| 6 | discount_amount | 优惠金额 | decimal(10,2) | | 非空 | 默认0.00 |
| 7 | pay_amount | 实付金额 | decimal(10,2) | | 非空 | total - discount |
| 8 | order_status | 订单状态 | tinyint | | 非空 | 0-待支付；1-待发货；2-配送中；3-已送达；4-已取消；5-退款中；6-已退款，默认0 |
| 9 | pay_status | 支付状态 | tinyint | | 非空 | 0-未支付；1-已支付，默认0 |
| 10 | pay_time | 支付时间 | datetime | | | 支付成功时记录 |
| 11 | receive_address_id | 收货地址ID | bigint | 外键 | 非空 | 跨库关联 |
| 12 | dispatch_group | 分单组标识 | varchar(50) | | | 可选，同批次配送订单分组 |
| 13 | delivery_id | 关联配送单ID | bigint | 外键 | | 跨库关联 |
| 14 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 15 | update_time | 更新时间 | datetime | | | 更新时自动修改 |

**表5-18 order_item（订单明细表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | item_id | 订单项ID | bigint | 主键 | | 自增 |
| 2 | order_id | 关联订单ID | bigint | 外键 | 非空 | 订单项所属订单 |
| 3 | product_id | 关联商品ID | bigint | 外键 | 非空 | 跨库关联 |
| 4 | activity_id | 关联活动ID | bigint | 外键 | | 非拼团为NULL，跨库关联 |
| 5 | product_name | 商品名称 | varchar(100) | | 非空 | 下单时快照 |
| 6 | product_img | 商品图片 | varchar(255) | | | 下单时快照 |
| 7 | price | 单价 | decimal(10,2) | | 非空 | 拼团价/原价 |
| 8 | quantity | 数量 | int | | 非空 | 该商品购买数量 |
| 9 | total_price | 小计金额 | decimal(10,2) | | 非空 | price×quantity |

**表5-19 delivery（配送单表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | delivery_id | 配送单ID | bigint | 主键 | 自增 | 自增主键，唯一标识配送单 |
| 2 | leader_id | 负责团长ID | bigint | 外键 | 非空 | 配送负责人，跨库关联group_leader_store表 |
| 3 | dispatch_group | 分单组标识 | varchar(50) | | 非空 | 同批次配送订单分组标识 |
| 4 | delivery_mode | 发货方式 | tinyint | | 非空 | 1-团长团点；2-用户地址，默认1 |
| 5 | warehouse_id | 起点仓库ID | bigint | 外键 | | 可选，配送起始仓库，关联warehouse_config表 |
| 6 | end_warehouse_id | 终点仓库ID | bigint | | | 可选，回仓库时使用的终点仓库 |
| 7 | waypoint_count | 途经点数量 | int | | 非空 | 默认0，配送途经点总数 |
| 8 | order_ids | 关联订单ID列表 | text | | 非空 | JSON数组，包含本次配送的所有订单ID |
| 9 | waypoints_data | 途经点详细信息 | text | | | 可选，JSON数组包含坐标和地址信息 |
| 10 | optimal_route | 最优路径 | text | | 非空 | 经纬度序列，Dijkstra算法计算结果 |
| 11 | distance | 总配送距离 | decimal(10,2) | | 非空 | 单位米，总配送距离 |
| 12 | estimated_duration | 预估配送时间 | int | | | 可选，单位分钟，预估配送耗时 |
| 13 | status | 配送状态 | tinyint | | 非空 | 0-待分配；1-配送中；2-已完成，默认0 |
| 14 | route_strategy | 路径策略 | tinyint | | | 可选，0-最短时间；1-最短距离；2-避开拥堵，默认1 |
| 15 | algorithm_used | 使用的算法 | varchar(20) | | | 可选，dijkstra/gaode，默认dijkstra |
| 16 | route_display_data | 前端地图展示数据 | text | | | 可选，JSON格式，前端地图显示使用 |
| 17 | start_time | 配送开始时间 | datetime | | | 可选，配送开始时记录 |
| 18 | end_time | 配送完成时间 | datetime | | | 可选，配送完成时记录 |
| 19 | actual_start_time | 实际开始配送时间 | datetime | | | 可选，实际开始配送时记录 |
| 20 | created_by | 创建人ID | bigint | 外键 | | 管理员ID，跨库关联sys_user表 |
| 21 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 22 | update_time | 更新时间 | datetime | | | 更新时自动修改 |

**表5-20 payment_record（支付记录表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | pay_id | 支付记录ID | bigint | 主键 | 自增 | 自增主键，唯一标识支付记录 |
| 2 | user_id | 关联用户ID | bigint | 外键 | 非空 | 支付用户，跨库关联sys_user表 |
| 3 | order_id | 关联订单ID | bigint | 外键 | | 订单ID，充值时为NULL，跨库关联order_main表 |
| 4 | pay_type | 支付类型 | tinyint | | 非空 | 1-微信；2-支付宝；3-余额 |
| 5 | amount | 金额 | decimal(10,2) | | 非空 | 正数-支付/充值；负数-退款 |
| 6 | pay_status | 支付状态 | tinyint | | 非空 | 0-失败；1-成功，默认0 |
| 7 | transaction_id | 第三方支付流水号 | varchar(100) | | | 支付宝/微信通用流水号 |
| 8 | wx_transaction_id | 微信支付专用流水号 | varchar(100) | | | 可选，微信支付专用流水号 |
| 9 | pay_callback_info | 支付回调信息 | text | | | AES加密存储，第三方回调数据 |
| 10 | encrypt_sign | 数据加密签名 | varchar(255) | | 非空 | SHA256+盐值防篡改 |
| 11 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |

**表5-21 commission_record（佣金记录表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | commission_id | 佣金ID | bigint | 主键 | 自增 | 自增主键，唯一标识佣金记录 |
| 2 | leader_id | 关联团长ID | bigint | 外键 | 非空 | 团长用户ID，跨库关联sys_user表 |
| 3 | leader_name | 团长姓名 | varchar(50) | | 冗余 | 从用户表冗余，方便查询 |
| 4 | order_id | 关联订单ID | bigint | 外键 | 非空 | 关联订单，一个订单只生成一条佣金记录，跨库关联 |
| 5 | order_amount | 订单金额 | decimal(10,2) | | 非空 | 产生佣金的订单总金额 |
| 6 | commission_rate | 佣金比例 | decimal(5,2) | | 非空 | 佣金计算比例，如10.00% |
| 7 | commission_amount | 佣金金额 | decimal(10,2) | | 非空 | 计算出的佣金金额 |
| 8 | status | 状态 | int | | 非空 | 0-待结算；1-已结算；2-结算失败，默认0 |
| 9 | settled_at | 结算时间 | datetime | | | 佣金结算完成时间 |
| 10 | settlement_batch | 结算批次号 | varchar(20) | | | 格式：YYYYMMDD，标识结算批次 |
| 11 | remark | 备注 | varchar(255) | | | 可选，佣金结算备注信息 |
| 12 | created_at | 生成时间 | datetime | | 非空 | 订单完成后自动生成，默认当前时间 |

**表5-22 sys_operation_log（系统操作日志表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | log_id | 日志ID | bigint | 主键 | | 自增 |
| 2 | user_id | 操作人ID | bigint | 外键 | | 管理员/团长 |
| 3 | username | 操作人用户名 | varchar(50) | | | 可选，操作人账号名 |
| 4 | operation | 操作内容 | varchar(255) | | 非空 | 具体操作描述 |
| 5 | module | 操作模块 | varchar(50) | | 非空 | 系统功能模块名称 |
| 6 | method | 方法名 | varchar(500) | | | 可选，后端方法完整路径 |
| 7 | params | 请求参数 | text | | | 可选，JSON格式，敏感数据脱敏 |
| 8 | result | 操作结果 | varchar(20) | | | 可选，SUCCESS/FAIL |
| 9 | error_msg | 错误信息 | text | | | 可选，操作失败时的详细错误 |
| 10 | duration | 执行时长 | int | | | 可选，单位毫秒 |
| 11 | ip | 操作IP地址 | varchar(50) | | | 可选，操作设备IP |
| 12 | create_time | 操作时间 | datetime | | 非空 | 默认当前时间 |

**表5-23 warehouse_config（仓库配置表）**

| 编号 | 英文名 | 中文名 | 数据类型 | 键 | 约束 | 备注 |
|------|--------|--------|----------|----|------|------|
| 1 | id | 仓库ID | bigint | 主键 | 自增 | 自增主键，唯一标识仓库 |
| 2 | warehouse_name | 仓库名称 | varchar(100) | 唯一 | 非空 | 仓库显示名称，唯一 |
| 3 | address | 仓库地址 | varchar(255) | | 非空 | 仓库详细地址 |
| 4 | longitude | 仓库经度 | decimal(10,6) | | 非空 | 路径规划起点坐标 |
| 5 | latitude | 仓库纬度 | decimal(10,6) | | 非空 | 路径规划起点坐标 |
| 6 | is_default | 是否默认仓库 | tinyint | | 非空 | 0-否；1-是，默认0 |
| 7 | status | 状态 | tinyint | | 非空 | 0-禁用；1-启用，默认1 |
| 8 | contact_person | 联系人 | varchar(50) | | | 可选，仓库联系人姓名 |
| 9 | contact_phone | 联系电话 | varchar(20) | | | 可选，仓库联系电话 |
| 10 | description | 描述 | varchar(500) | | | 可选，仓库详细描述 |
| 11 | create_time | 创建时间 | datetime | | 非空 | 默认当前时间 |
| 12 | update_time | 更新时间 | datetime | | | ON UPDATE CURRENT_TIMESTAMP，自动更新 |
