# 5 数据库设计说明

## 5.1 数据库实体与联系

### 5.1.1 外部设计

本系统基于MySQL作为主要的数据库开发平台，采用微服务架构设计原则，按服务拆分数据库，共创建了7个独立的数据库，总共19个表，每个微服务对应一个独立数据库，避免服务间直接访问对方数据库，降低耦合度。

各数据库及其对应的微服务信息如下表所示：

**表5-1 微服务数据库映射关系表**

| 数据库名称          | 对应微服务      | 端口 | 包含表数 | 表名列表                                                                |
| ------------------- | --------------- | ---- | -------- | ----------------------------------------------------------------------- |
| user_service_db     | UserService     | 8061 | 5张      | sys_user、user_address、user_account、user_feedback、sys_operation_log  |
| product_service_db  | ProductService  | 8062 | 2张      | product_category、product                                               |
| groupbuy_service_db | GroupBuyService | 8063 | 3张      | group_buy、group_buy_team、group_buy_member                             |
| order_service_db    | OrderService    | 8065 | 3张      | shopping_cart、order_main、order_item                                   |
| payment_service_db  | PaymentService  | 8066 | 1张      | payment_record                                                          |
| delivery_service_db | DeliveryService | 8067 | 1张      | delivery                                                                |
| leader_service_db   | LeaderService   | 8068 | 4张      | group_leader_store、commission_record、community、community_application |

各数据库采用统一的字符集utf8mb4和排序规则utf8mb4_0900_ai_ci。各微服务通过独立的数据库连接配置访问对应数据库，严格禁止跨库直接访问，服务间数据交互通过HTTP REST API实现。

### 5.1.2 约定

（1）**数据库名规范**

在定义数据库名称的过程中，所有标识符均使用小写字母，并通过下划线连接各个单词，确保名称长度不超过32个字符。名称设计需直观反映其含义，严禁混合使用拼音和英文，确保名称的明确性和规范性。因此数据库名称格式："{服务名}_service_db"，清晰反映数据库与微服务的对应关系。

（2）**数据库表名规范**

数据库表的命名应直接反映其存储内容或用途，并采用下划线连接各个单词以确保名称的清晰度和一致性。表名统一使用小写字母，避免使用复数形式。

（3）**数据库字段名规范**

在为数据库字段命名时，名称应结合字段的含义，并使用下划线来区分名称中的不同部分。字段名统一使用小写字母，避免使用MySQL保留字。

### 5.1.3 结构设计

本系统通过对社区团购业务流程的分析，抽象出以下核心实体。这些实体均是系统运行中需要持久化存储的核心数据对象，并为多个功能模块提供服务。本系统中实体集如下表所示：

**表5-2 本系统实体集**

| 实体集名称   | 内容                                                                                                                                         | 标识码 |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| 社区         | id，社区名称，省份，城市，区县，详细地址，经度，纬度，状态，创建时间                                                                         | id     |
| 社区申请     | id，申请人id，社区名称，省份，城市，区县，详细地址，经度，纬度，申请说明，审核状态，拒绝原因，审核后社区id，审核人id，审核时间，申请时间     | id     |
| 用户         | id，用户名，密码，角色，真实姓名，手机号，微信OpenID，头像，社区id，状态，创建时间，更新时间                                                 | id     |
| 用户地址     | id，用户id，收货人，联系电话，省份，城市，区县，详细地址，经度，纬度，是否默认地址                                                           | id     |
| 用户账户     | id，用户id，余额，冻结金额，更新时间                                                                                                         | id     |
| 用户反馈     | id，用户id，反馈类型，反馈内容，图片，处理状态，处理意见，处理时间，创建时间，更新时间                                                       | id     |
| 商品分类     | id，父分类id，分类名称，排序权重，状态                                                                                                       | id     |
| 商品         | id，分类id，商品名称，封面图，商品详情，原价，拼团参考价，库存数量，状态，创建时间，更新时间                                                 | id     |
| 团长团点     | id，团长id，团点名称，省份，城市，区县，详细地址，经度，纬度，社区id，最大配送范围，审核状态，审核时间，佣金比例                             | id     |
| 拼团活动     | id，商品id，拼团价，成团人数，最大参团人数，开始时间，结束时间，状态，二维码URL，专属链接，创建时间                                          | id     |
| 团实例       | id，团号，活动id，发起人id，团长id，社区id，成团人数，当前人数，团状态，成团时间，过期时间，创建时间                                         | id     |
| 参团记录     | id，团id，用户id，订单id，是否发起者，支付金额，参团时间，状态                                                                               | id     |
| 购物车       | id，用户id，商品id，活动id，数量，添加时间，更新时间                                                                                         | id     |
| 订单主表     | id，用户id，团长id，订单编号，商品总金额，优惠金额，实付金额，订单状态，支付状态，支付时间，收货地址id，分单组，配送单id，创建时间，更新时间 | id     |
| 订单项       | id，订单id，商品id，活动id，商品名称，商品图片，单价，数量，小计金额                                                                         | id     |
| 配送单       | id，团长id，分单组，开始时间，结束时间，最优路径，配送距离，状态                                                                             | id     |
| 支付记录     | id，用户id，订单id，支付类型，金额，状态，第三方流水号，微信流水号，支付回调信息，加密签名，创建时间                                         | id     |
| 佣金记录     | id，团长id，订单id，佣金金额，状态，结算时间，生成时间                                                                                       | id     |
| 系统操作日志 | id，用户id，操作人用户名，操作内容，操作模块，操作方法名，请求参数，操作结果，错误信息，执行时长，操作IP，操作时间                           | id     |

通过分析本系统中实体集关系，可得本系统中联系集如下表所示：

**表5-3 本系统联系集**

| 联系集 | 关系实体         | 构成关系 | 表示码                |
| ------ | ---------------- | -------- | --------------------- |
| 归属   | 用户与社区       | n:1      | community_id          |
| 归属   | 团长团点与社区   | n:1      | community_id          |
| 归属   | 团实例与社区     | n:1      | community_id          |
| 生成   | 社区申请与社区   | 1:1      | approved_community_id |
| 提交   | 用户与社区申请   | 1:n      | applicant_id          |
| 审核   | 用户与社区申请   | 1:n      | auditor_id            |
| 拥有   | 用户与用户地址   | 1:n      | user_id               |
| 拥有   | 用户与用户账户   | 1:1      | user_id               |
| 提交   | 用户与用户反馈   | 1:n      | user_id               |
| 记录   | 用户与操作日志   | 1:n      | user_id               |
| 归属   | 商品与商品分类   | n:1      | category_id           |
| 管理   | 用户与团长团点   | 1:1      | leader_id             |
| 依托   | 拼团活动与商品   | n:1      | product_id            |
| 发起   | 拼团活动与团实例 | 1:n      | activity_id           |
| 发起   | 用户与团实例     | 1:n      | launcher_id           |
| 负责   | 用户与团实例     | 1:n      | leader_id             |
| 包含   | 团实例与参团记录 | 1:n      | team_id               |
| 参与   | 用户与参团记录   | 1:n      | user_id               |
| 关联   | 参团记录与订单   | 1:1      | order_id              |
| 存放   | 用户与购物车     | 1:n      | user_id               |
| 选择   | 购物车与商品     | n:1      | product_id            |
| 关联   | 购物车与拼团活动 | n:1      | activity_id           |
| 生成   | 用户与订单       | 1:n      | user_id               |
| 负责   | 用户与订单       | 1:n      | leader_id             |
| 使用   | 订单与用户地址   | n:1      | receive_address_id    |
| 包含   | 订单与订单项     | 1:n      | order_id              |
| 引用   | 订单项与商品     | n:1      | product_id            |
| 引用   | 订单项与拼团活动 | n:1      | activity_id           |
| 配送   | 配送单与订单     | 1:n      | delivery_id           |
| 负责   | 用户与配送单     | 1:n      | leader_id             |
| 支付   | 用户与支付记录   | 1:n      | user_id               |
| 关联   | 订单与支付记录   | 1:1      | order_id              |
| 计算   | 用户与佣金记录   | 1:n      | leader_id             |
| 触发   | 订单与佣金记录   | 1:1      | order_id              |

## 5.2 E-R图

图5-1 E-R图

*（此处应插入完整的E-R图，包含19个实体及其关系）*

## 5.3 数据库逻辑结构设计

根据E-R模型转换，将图5-1所示的E-R图转为逻辑结构如下所示：

- **社区**（社区ID，社区名称，省份，城市，区县，详细地址，经度，纬度，状态，创建时间）
- **社区申请**（申请ID，申请人ID，社区名称，省份，城市，区县，详细地址，经度，纬度，申请说明，审核状态，拒绝原因，审核后社区ID，审核人ID，审核时间，申请时间）
- **用户**（用户ID，用户名，密码，角色，真实姓名，手机号，微信OpenID，头像，社区ID，状态，创建时间，更新时间）
- **用户地址**（地址ID，用户ID，收货人，联系电话，省份，城市，区县，详细地址，经度，纬度，是否默认地址）
- **用户账户**（账户ID，用户ID，可用余额，冻结金额，更新时间）
- **用户反馈**（反馈ID，用户ID，反馈类型，反馈内容，图片，处理状态，处理意见，处理时间，创建时间，更新时间）
- **商品分类**（分类ID，父分类ID，分类名称，排序权重，状态）
- **商品**（商品ID，分类ID，商品名称，封面图，商品详情，原价，拼团参考价，库存数量，状态，创建时间，更新时间）
- **团长团点**（团点ID，团长ID，团点名称，省份，城市，区县，详细地址，经度，纬度，社区ID，最大配送范围，审核状态，审核时间，佣金比例）
- **拼团活动**（活动ID，商品ID，拼团价，成团人数，最大参团人数，开始时间，结束时间，状态，二维码URL，专属链接，创建时间）
- **团实例**（团ID，团号，活动ID，发起人ID，团长ID，社区ID，成团人数，当前人数，团状态，成团时间，过期时间，创建时间）
- **参团记录**（参团ID，团ID，用户ID，订单ID，是否发起者，支付金额，参团时间，状态）
- **购物车**（购物车ID，用户ID，商品ID，活动ID，数量，添加时间，更新时间）
- **订单主表**（订单ID，用户ID，团长ID，订单编号，商品总金额，优惠金额，实付金额，订单状态，支付状态，支付时间，收货地址ID，分单组，配送单ID，创建时间，更新时间）
- **订单项**（订单项ID，订单ID，商品ID，活动ID，商品名称，商品图片，单价，数量，小计金额）
- **配送单**（配送单ID，团长ID，分单组，开始时间，结束时间，最优路径，配送距离，状态）
- **支付记录**（支付记录ID，用户ID，订单ID，支付类型，金额，状态，第三方流水号，微信流水号，支付回调信息，加密签名，创建时间）
- **佣金记录**（佣金ID，团长ID，订单ID，佣金金额，状态，结算时间，生成时间）
- **系统操作日志**（日志ID，用户ID，操作人用户名，操作内容，操作模块，操作方法名，请求参数，操作结果，错误信息，执行时长，操作IP，操作时间）

## 5.4 数据库详细设计

本系统共有19张表，其中community表存放社区基础数据、community_application表存放社区申请数据、sys_user表存放用户数据及归属社区关联信息、user_address表存放用户地址数据、user_account表存放用户账户、user_feedback表存放用户反馈、product_category表存放商品分类数据、product表存放商品数据、group_leader_store表存放团长信息及归属社区关联信息、group_buy表存放拼团活动模板数据、group_buy_team表存放团实例数据、group_buy_member表存放参团记录数据、shopping_cart表存放购物车数据、order_main表存放订单主数据、order_item表存放订单明细、delivery表存放配送信息、payment_record表存放支付记录、commission_record表存放佣金记录、sys_operation_log表存放系统操作日志。

本系统表结构设计如下表5-4到5-22所示：

**表5-4 社区表**

| 名称           | 类型     | 长度 | 小数点 | 非空 | 主键  | 默认值            | 注释                   |
| -------------- | -------- | ---- | ------ | ---- | ----- | ----------------- | ---------------------- |
| community_id   | bigint   | -    | -      | TRUE | TRUE  | -                 | 社区唯一ID             |
| community_name | varchar  | 100  | -      | TRUE | FALSE | -                 | 社区名称               |
| province       | varchar  | 20   | -      | TRUE | FALSE | -                 | 省份                   |
| city           | varchar  | 20   | -      | TRUE | FALSE | -                 | 城市                   |
| district       | varchar  | 20   | -      | TRUE | FALSE | -                 | 区县                   |
| address        | varchar  | 255  | -      | TRUE | FALSE | -                 | 详细地址               |
| longitude      | decimal  | 10   | 6      | TRUE | FALSE | -                 | 社区中心经度           |
| latitude       | decimal  | 10   | 6      | TRUE | FALSE | -                 | 社区中心纬度           |
| status         | tinyint  | -    | -      | TRUE | FALSE | 1                 | 状态（0-禁用；1-启用） |
| create_time    | datetime | -    | -      | TRUE | FALSE | CURRENT_TIMESTAMP | 创建时间               |

**表5-5 社区申请表**

| 名称                  | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                     |
| --------------------- | -------- | ---- | ------ | ----- | ----- | ----------------- | ---------------------------------------- |
| application_id        | bigint   | -    | -      | TRUE  | TRUE  | -                 | 申请唯一ID                               |
| applicant_id          | bigint   | -    | -      | TRUE  | FALSE | -                 | 申请人ID（团长申请人）                   |
| community_name        | varchar  | 100  | -      | TRUE  | FALSE | -                 | 申请的社区名称                           |
| province              | varchar  | 20   | -      | TRUE  | FALSE | -                 | 省份                                     |
| city                  | varchar  | 20   | -      | TRUE  | FALSE | -                 | 城市                                     |
| district              | varchar  | 20   | -      | TRUE  | FALSE | -                 | 区县                                     |
| address               | varchar  | 255  | -      | TRUE  | FALSE | -                 | 详细地址                                 |
| longitude             | decimal  | 10   | 6      | FALSE | FALSE | NULL              | 经度（管理员审核时填写）                 |
| latitude              | decimal  | 10   | 6      | FALSE | FALSE | NULL              | 纬度（管理员审核时填写）                 |
| description           | text     | -    | -      | FALSE | FALSE | NULL              | 申请说明                                 |
| status                | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 审核状态（0-待审核；1-已通过；2-已拒绝） |
| reject_reason         | varchar  | 255  | -      | FALSE | FALSE | NULL              | 拒绝原因                                 |
| approved_community_id | bigint   | -    | -      | FALSE | FALSE | NULL              | 审核通过后生成的社区ID                   |
| auditor_id            | bigint   | -    | -      | FALSE | FALSE | NULL              | 审核人ID                                 |
| audit_time            | datetime | -    | -      | FALSE | FALSE | NULL              | 审核时间                                 |
| create_time           | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 申请时间                                 |

**表5-6 用户表**

| 名称         | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                 |
| ------------ | -------- | ---- | ------ | ----- | ----- | ----------------- | ------------------------------------ |
| user_id      | bigint   | -    | -      | TRUE  | TRUE  | -                 | 用户唯一ID                           |
| username     | varchar  | 50   | -      | TRUE  | FALSE | -                 | 登录账号                             |
| password     | varchar  | 100  | -      | TRUE  | FALSE | -                 | 加密密码                             |
| role         | tinyint  | -    | -      | TRUE  | FALSE | -                 | 角色（1-普通用户；2-团长；3-管理员） |
| real_name    | varchar  | 50   | -      | FALSE | FALSE | NULL              | 真实姓名                             |
| phone        | varchar  | 128  | -      | FALSE | FALSE | NULL              | 手机号（AES加密）                    |
| wx_openid    | varchar  | 100  | -      | FALSE | FALSE | NULL              | 微信OpenID                           |
| avatar       | varchar  | 255  | -      | FALSE | FALSE | NULL              | 头像URL                              |
| community_id | bigint   | -    | -      | FALSE | FALSE | NULL              | 归属社区ID                           |
| status       | tinyint  | -    | -      | TRUE  | FALSE | 1                 | 状态（0-禁用；1-正常）               |
| create_time  | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间                             |
| update_time  | datetime | -    | -      | FALSE | FALSE | NULL              | 更新时间                             |

**表5-7 用户地址表**

| 名称       | 类型    | 长度 | 小数点 | 非空 | 主键  | 默认值 | 注释                       |
| ---------- | ------- | ---- | ------ | ---- | ----- | ------ | -------------------------- |
| address_id | bigint  | -    | -      | TRUE | TRUE  | -      | 地址ID                     |
| user_id    | bigint  | -    | -      | TRUE | FALSE | -      | 关联用户ID                 |
| receiver   | varchar | 50   | -      | TRUE | FALSE | -      | 收件人                     |
| phone      | varchar | 20   | -      | TRUE | FALSE | -      | 联系电话                   |
| province   | varchar | 20   | -      | TRUE | FALSE | -      | 省份                       |
| city       | varchar | 20   | -      | TRUE | FALSE | -      | 城市                       |
| district   | varchar | 20   | -      | TRUE | FALSE | -      | 区县                       |
| detail     | varchar | 255  | -      | TRUE | FALSE | -      | 详细地址                   |
| longitude  | decimal | 10   | 6      | TRUE | FALSE | -      | 地址经度                   |
| latitude   | decimal | 10   | 6      | TRUE | FALSE | -      | 地址纬度                   |
| is_default | tinyint | -    | -      | TRUE | FALSE | 0      | 是否默认地址（0-否；1-是） |

**表5-8 用户账户表**

| 名称          | 类型     | 长度 | 小数点 | 非空 | 主键  | 默认值            | 注释       |
| ------------- | -------- | ---- | ------ | ---- | ----- | ----------------- | ---------- |
| account_id    | bigint   | -    | -      | TRUE | TRUE  | -                 | 账户ID     |
| user_id       | bigint   | -    | -      | TRUE | FALSE | -                 | 关联用户ID |
| balance       | decimal  | 10   | 2      | TRUE | FALSE | 0.00              | 可用余额   |
| freeze_amount | decimal  | 10   | 2      | TRUE | FALSE | 0.00              | 冻结金额   |
| update_time   | datetime | -    | -      | TRUE | FALSE | CURRENT_TIMESTAMP | 更新时间   |

**表5-9 用户反馈表**

| 名称        | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                               |
| ----------- | -------- | ---- | ------ | ----- | ----- | ----------------- | -------------------------------------------------- |
| feedback_id | bigint   | -    | -      | TRUE  | TRUE  | -                 | 反馈ID                                             |
| user_id     | bigint   | -    | -      | TRUE  | FALSE | -                 | 用户ID                                             |
| type        | tinyint  | -    | -      | TRUE  | FALSE | -                 | 反馈类型                                           |
| content     | text     | -    | -      | TRUE  | FALSE | -                 | 反馈内容                                           |
| images      | text     | -    | -      | FALSE | FALSE | NULL              | 图片URL（多张用逗号分隔）                          |
| status      | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 处理状态（0-待处理；1-处理中；2-已解决；3-已关闭） |
| reply       | text     | -    | -      | FALSE | FALSE | NULL              | 处理意见（管理员回复）                             |
| reply_time  | datetime | -    | -      | FALSE | FALSE | NULL              | 处理时间                                           |
| create_time | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间                                           |
| update_time | datetime | -    | -      | FALSE | FALSE | NULL              | 更新时间                                           |

**表5-10 商品分类表**

| 名称          | 类型    | 长度 | 小数点 | 非空 | 主键  | 默认值 | 注释                   |
| ------------- | ------- | ---- | ------ | ---- | ----- | ------ | ---------------------- |
| category_id   | bigint  | -    | -      | TRUE | TRUE  | -      | 分类ID                 |
| parent_id     | bigint  | -    | -      | TRUE | FALSE | 0      | 父分类ID               |
| category_name | varchar | 50   | -      | TRUE | FALSE | -      | 分类名称               |
| sort          | int     | -    | -      | TRUE | FALSE | 0      | 排序权重               |
| status        | tinyint | -    | -      | TRUE | FALSE | 1      | 状态（0-禁用；1-启用） |

**表5-11 商品表**

| 名称         | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                   |
| ------------ | -------- | ---- | ------ | ----- | ----- | ----------------- | ---------------------- |
| product_id   | bigint   | -    | -      | TRUE  | TRUE  | -                 | 商品ID                 |
| category_id  | bigint   | -    | -      | FALSE | FALSE | NULL              | 关联分类ID             |
| product_name | varchar  | 100  | -      | TRUE  | FALSE | -                 | 商品名称               |
| cover_img    | varchar  | 255  | -      | TRUE  | FALSE | -                 | 封面图URL              |
| detail       | text     | -    | -      | FALSE | FALSE | NULL              | 商品详情               |
| price        | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 原价                   |
| group_price  | decimal  | 10   | 2      | FALSE | FALSE | NULL              | 拼团参考价             |
| stock        | int      | -    | -      | TRUE  | FALSE | 0                 | 库存数量               |
| status       | tinyint  | -    | -      | TRUE  | FALSE | 1                 | 状态（0-下架；1-上架） |
| create_time  | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间               |
| update_time  | datetime | -    | -      | FALSE | FALSE | NULL              | 更新时间               |

**表5-12 团长团点表**

| 名称               | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值 | 注释                                         |
| ------------------ | -------- | ---- | ------ | ----- | ----- | ------ | -------------------------------------------- |
| store_id           | bigint   | -    | -      | TRUE  | TRUE  | -      | 团点ID                                       |
| leader_id          | bigint   | -    | -      | TRUE  | FALSE | -      | 关联团长ID（role=2）                         |
| store_name         | varchar  | 100  | -      | TRUE  | FALSE | -      | 团点名称                                     |
| province           | varchar  | 20   | -      | TRUE  | FALSE | -      | 省份                                         |
| city               | varchar  | 20   | -      | TRUE  | FALSE | -      | 城市                                         |
| district           | varchar  | 20   | -      | TRUE  | FALSE | -      | 区县                                         |
| detail_address     | varchar  | 255  | -      | TRUE  | FALSE | -      | 详细地址                                     |
| longitude          | decimal  | 10   | 6      | TRUE  | FALSE | -      | 团点经度                                     |
| latitude           | decimal  | 10   | 6      | TRUE  | FALSE | -      | 团点纬度                                     |
| community_id       | bigint   | -    | -      | FALSE | FALSE | NULL   | 归属社区ID                                   |
| max_delivery_range | int      | -    | -      | TRUE  | FALSE | 3000   | 最大配送范围（米）                           |
| audit_status       | tinyint  | -    | -      | TRUE  | FALSE | 0      | 审核状态（0-待审核；1-审核通过；2-审核拒绝） |
| audit_time         | datetime | -    | -      | FALSE | FALSE | NULL   | 审核时间                                     |
| commission_rate    | decimal  | 5    | 2      | TRUE  | FALSE | 5.00   | 佣金比例（%）                                |

**表5-13 拼团活动表**

| 名称         | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                         |
| ------------ | -------- | ---- | ------ | ----- | ----- | ----------------- | -------------------------------------------- |
| activity_id  | bigint   | -    | -      | TRUE  | TRUE  | -                 | 活动ID                                       |
| product_id   | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联商品ID                                   |
| group_price  | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 拼团价                                       |
| required_num | int      | -    | -      | TRUE  | FALSE | 2                 | 成团人数                                     |
| max_num      | int      | -    | -      | FALSE | FALSE | NULL              | 最大参团人数                                 |
| start_time   | datetime | -    | -      | TRUE  | FALSE | -                 | 开始时间                                     |
| end_time     | datetime | -    | -      | TRUE  | FALSE | -                 | 结束时间                                     |
| status       | tinyint  | -    | -      | TRUE  | FALSE | 1                 | 状态（0-未开始；1-进行中；2-已结束；3-异常） |
| qrcode_url   | varchar  | 255  | -      | FALSE | FALSE | NULL              | 二维码URL                                    |
| link         | varchar  | 255  | -      | FALSE | FALSE | NULL              | 专属链接                                     |
| create_time  | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间                                     |

**表5-14 团实例表**

| 名称         | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                   |
| ------------ | -------- | ---- | ------ | ----- | ----- | ----------------- | -------------------------------------- |
| team_id      | bigint   | -    | -      | TRUE  | TRUE  | -                 | 团实例唯一ID                           |
| team_no      | varchar  | 32   | -      | TRUE  | FALSE | -                 | 团号（格式：T+日期+随机数）            |
| activity_id  | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联拼团活动ID                         |
| launcher_id  | bigint   | -    | -      | TRUE  | FALSE | -                 | 发起人ID（仅团长可发起）               |
| leader_id    | bigint   | -    | -      | TRUE  | FALSE | -                 | 归属团长ID（与发起人ID一致）           |
| community_id | bigint   | -    | -      | FALSE | FALSE | NULL              | 归属社区ID                             |
| required_num | int      | -    | -      | TRUE  | FALSE | -                 | 成团人数（从拼团活动复制）             |
| current_num  | int      | -    | -      | TRUE  | FALSE | 0                 | 当前参团人数                           |
| team_status  | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 团状态（0-拼团中；1-已成团；2-已失败） |
| success_time | datetime | -    | -      | FALSE | FALSE | NULL              | 成团时间                               |
| expire_time  | datetime | -    | -      | TRUE  | FALSE | -                 | 过期时间（默认活动结束后24小时）       |
| create_time  | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间                               |

**表5-15 参团记录表**

| 名称        | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                           |
| ----------- | -------- | ---- | ------ | ----- | ----- | ----------------- | ---------------------------------------------- |
| member_id   | bigint   | -    | -      | TRUE  | TRUE  | -                 | 参团记录唯一ID                                 |
| team_id     | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联团实例ID                                   |
| user_id     | bigint   | -    | -      | TRUE  | FALSE | -                 | 参团用户ID                                     |
| order_id    | bigint   | -    | -      | FALSE | FALSE | NULL              | 关联订单ID                                     |
| is_launcher | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 是否发起人（0-否；1-是）                       |
| pay_amount  | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 支付金额                                       |
| join_time   | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 参团时间                                       |
| status      | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 状态（0-待支付；1-已支付；2-已成团；3-已取消） |

**表5-16 购物车表**

| 名称        | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                       |
| ----------- | -------- | ---- | ------ | ----- | ----- | ----------------- | -------------------------- |
| cart_id     | bigint   | -    | -      | TRUE  | TRUE  | -                 | 购物车ID                   |
| user_id     | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联用户ID                 |
| product_id  | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联商品ID                 |
| activity_id | bigint   | -    | -      | FALSE | FALSE | NULL              | 关联活动ID（非拼团为NULL） |
| quantity    | int      | -    | -      | TRUE  | FALSE | 1                 | 数量                       |
| add_time    | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 添加时间                   |
| update_time | datetime | -    | -      | FALSE | FALSE | NULL              | 更新时间                   |

**表5-17 订单主表**

| 名称               | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                           |
| ------------------ | -------- | ---- | ------ | ----- | ----- | ----------------- | ------------------------------ |
| order_id           | bigint   | -    | -      | TRUE  | TRUE  | -                 | 订单ID                         |
| user_id            | bigint   | -    | -      | TRUE  | FALSE | -                 | 下单用户ID                     |
| leader_id          | bigint   | -    | -      | TRUE  | FALSE | -                 | 取货团长ID                     |
| order_sn           | varchar  | 50   | -      | TRUE  | FALSE | -                 | 订单编号                       |
| total_amount       | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 商品总金额                     |
| discount_amount    | decimal  | 10   | 2      | TRUE  | FALSE | 0.00              | 优惠金额                       |
| pay_amount         | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 实付金额                       |
| order_status       | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 订单状态                       |
| pay_status         | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 支付状态（0-未支付；1-已支付） |
| pay_time           | datetime | -    | -      | FALSE | FALSE | NULL              | 支付时间                       |
| receive_address_id | bigint   | -    | -      | TRUE  | FALSE | -                 | 收货地址ID                     |
| dispatch_group     | varchar  | 50   | -      | FALSE | FALSE | NULL              | 分单组标识                     |
| delivery_id        | bigint   | -    | -      | FALSE | FALSE | NULL              | 关联配送单ID                   |
| create_time        | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间                       |
| update_time        | datetime | -    | -      | FALSE | FALSE | NULL              | 更新时间                       |

**表5-18 订单项表**

| 名称         | 类型    | 长度 | 小数点 | 非空  | 主键  | 默认值 | 注释                       |
| ------------ | ------- | ---- | ------ | ----- | ----- | ------ | -------------------------- |
| item_id      | bigint  | -    | -      | TRUE  | TRUE  | -      | 订单项ID                   |
| order_id     | bigint  | -    | -      | TRUE  | FALSE | -      | 关联订单ID                 |
| product_id   | bigint  | -    | -      | TRUE  | FALSE | -      | 关联商品ID                 |
| activity_id  | bigint  | -    | -      | FALSE | FALSE | NULL   | 关联活动ID（非拼团为NULL） |
| product_name | varchar | 100  | -      | TRUE  | FALSE | -      | 商品名称（下单时快照）     |
| product_img  | varchar | 255  | -      | FALSE | FALSE | NULL   | 商品图片（下单时快照）     |
| price        | decimal | 10   | 2      | TRUE  | FALSE | -      | 单价                       |
| quantity     | int     | -    | -      | TRUE  | FALSE | -      | 数量                       |
| total_price  | decimal | 10   | 2      | TRUE  | FALSE | -      | 小计金额                   |

**表5-19 配送单表**

| 名称           | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值 | 注释                                     |
| -------------- | -------- | ---- | ------ | ----- | ----- | ------ | ---------------------------------------- |
| delivery_id    | bigint   | -    | -      | TRUE  | TRUE  | -      | 配送单ID                                 |
| leader_id      | bigint   | -    | -      | TRUE  | FALSE | -      | 负责团长ID                               |
| dispatch_group | varchar  | 50   | -      | TRUE  | FALSE | -      | 关联分单组                               |
| start_time     | datetime | -    | -      | FALSE | FALSE | NULL   | 开始时间                                 |
| end_time       | datetime | -    | -      | FALSE | FALSE | NULL   | 完成时间                                 |
| optimal_route  | text     | -    | -      | TRUE  | FALSE | -      | 最优路径（经纬度序列）                   |
| distance       | decimal  | 10   | 2      | TRUE  | FALSE | -      | 配送距离（米）                           |
| status         | tinyint  | -    | -      | TRUE  | FALSE | 0      | 配送状态（0-待分配；1-配送中；2-已完成） |

**表5-20 支付记录表**

| 名称              | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                                             |
| :---------------- | -------- | ---- | ------ | ----- | ----- | ----------------- | ------------------------------------------------ |
| pay_id            | bigint   | -    | -      | TRUE  | TRUE  | -                 | 支付记录ID                                       |
| user_id           | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联用户ID                                       |
| order_id          | bigint   | -    | -      | FALSE | FALSE | NULL              | 关联订单ID（充值时为NULL）                       |
| pay_type          | tinyint  | -    | -      | TRUE  | FALSE | -                 | 支付类型（1-微信支付；2-支付宝支付；3-余额支付） |
| amount            | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 金额                                             |
| pay_status        | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 状态（0-失败；1-成功）                           |
| transaction_id    | varchar  | 100  | -      | FALSE | FALSE | NULL              | 第三方支付流水号                                 |
| wx_transaction_id | varchar  | 100  | -      | FALSE | FALSE | NULL              | 微信支付专用流水号                               |
| pay_callback_info | text     | -    | -      | FALSE | FALSE | NULL              | 支付回调信息（AES加密存储）                      |
| encrypt_sign      | varchar  | 255  | -      | TRUE  | FALSE | -                 | 数据加密签名（防篡改）                           |
| create_time       | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 创建时间                                         |

**表5-21 佣金记录表**

| 名称          | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                       |
| ------------- | -------- | ---- | ------ | ----- | ----- | ----------------- | -------------------------- |
| commission_id | bigint   | -    | -      | TRUE  | TRUE  | -                 | 佣金ID                     |
| leader_id     | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联团长ID                 |
| order_id      | bigint   | -    | -      | TRUE  | FALSE | -                 | 关联订单ID                 |
| amount        | decimal  | 10   | 2      | TRUE  | FALSE | -                 | 佣金金额                   |
| status        | tinyint  | -    | -      | TRUE  | FALSE | 0                 | 状态（0-未结算；1-已结算） |
| settle_time   | datetime | -    | -      | FALSE | FALSE | NULL              | 结算时间                   |
| create_time   | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 生成时间                   |

**表5-22 系统操作日志表**

| 名称        | 类型     | 长度 | 小数点 | 非空  | 主键  | 默认值            | 注释                     |
| ----------- | -------- | ---- | ------ | ----- | ----- | ----------------- | ------------------------ |
| log_id      | bigint   | -    | -      | TRUE  | TRUE  | -                 | 日志ID                   |
| user_id     | bigint   | -    | -      | FALSE | FALSE | NULL              | 操作人ID                 |
| username    | varchar  | 50   | -      | FALSE | FALSE | NULL              | 操作人用户名             |
| operation   | varchar  | 255  | -      | TRUE  | FALSE | -                 | 操作内容                 |
| module      | varchar  | 50   | -      | TRUE  | FALSE | -                 | 操作模块                 |
| method      | varchar  | 500  | -      | FALSE | FALSE | NULL              | 操作方法名               |
| params      | text     | -    | -      | FALSE | FALSE | NULL              | 请求参数（JSON格式）     |
| result      | varchar  | 20   | -      | FALSE | FALSE | NULL              | 操作结果（SUCCESS/FAIL） |
| error_msg   | text     | -    | -      | FALSE | FALSE | NULL              | 错误信息                 |
| duration    | int      | -    | -      | FALSE | FALSE | NULL              | 执行时长（毫秒）         |
| ip          | varchar  | 50   | -      | FALSE | FALSE | NULL              | 操作IP地址               |
| create_time | datetime | -    | -      | TRUE  | FALSE | CURRENT_TIMESTAMP | 操作时间                 |
